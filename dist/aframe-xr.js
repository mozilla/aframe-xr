!function(e){function t(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var i={};t.m=e,t.c=i,t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,i){"use strict";i(1),i(2),i(3),i(4),i(5)},function(e,t){!function(e){function t(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var i={};t.m=e,t.c=i,t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.WebXRUtils=t.WebXRManager=void 0;var r=i(1),o=n(r),a=i(2),s=n(a);i(3),t.WebXRManager=o.default,t.WebXRUtils=s.default},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),THREE.WebXRManager=function(){function e(e){this.sessionActive&&this.session.requestFrame(u);var t=e.getDisplayPose(e.getCoordinateSystem(XRCoordinateSystem.HEAD_MODEL));if(0===t._orientation[0]&&0===t._orientation[1]&&0===t._orientation[2]&&1===t._orientation[3]?this.poseFound&&(this.dispatchEvent({type:"poseLost"}),this.poseFound=!1):this.poseFound||(this.dispatchEvent({type:"poseFound"}),this.poseFound=!0),this.updateScene(a,e),this.renderer.autoClear=!1,this.renderer.setSize(this.session.baseLayer.framebufferWidth,this.session.baseLayer.framebufferHeight,!1),this.renderer.clear(),this.sessionActive)for(var i=0;i<e.views.length;i++){var n=e.views[i];this.camera.projectionMatrix.fromArray(n.projectionMatrix),this.camera.parent&&"Scene"!==this.camera.parent.type?(this.camera.parent.matrixAutoUpdate=!1,this.camera.parent.matrix.fromArray(t.poseModelMatrix),this.camera.parent.updateMatrixWorld(!0)):(this.camera.matrixAutoUpdate=!1,this.camera.matrix.fromArray(t.poseModelMatrix),this.camera.updateMatrixWorld(!0)),this.renderer.clearDepth();var r=n.getViewport(this.session.baseLayer);this.renderer.setViewport(r.x,r.y,r.width,r.height),this.doRender()}else this.camera.parent&&"Scene"!==this.camera.parent.type?(this.camera.parent.matrixAutoUpdate=!1,this.camera.parent.matrix=new THREE.Matrix4,this.camera.parent.updateMatrixWorld(!0)):(this.camera.matrix=new THREE.Matrix4,this.camera.updateMatrixWorld(!0)),this.renderer.clearDepth(),this.renderer.setViewport(0,0,window.innerWidth,window.innerHeight),this.doRender()}var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments[1],n=arguments[2],r=arguments[3],o=arguments[4],a=arguments[5],s={AR_AUTOSTART:!0};this.options=Object.assign({},s,t),this.displays=i,this.renderer=n,this.camera=r,this.scene=o;var u=e.bind(this);this.sessions=[],this.session=null,this.autoStarted=!1,this.poseFound=!1,this.startSession=function(e,t){var i=this,r=!1;"vr"===t&&(r=!0);var o={exclusive:r,type:r?XRSession.REALITY:XRSession.AUGMENTATION};this.sessionActive||(null!==this.session&&(this.session.end(),this.session=null),e.requestSession(o).then(function(e){e.realityType=t,e.depthNear=.05,e.depthFar=1e3,e.addEventListener("focus",function(e){i.handleSessionFocus(e)}),e.addEventListener("blur",function(e){i.handleSessionBlur(e)}),e.addEventListener("end",function(e){i.handleSessionEnded(e)}),n.domElement.style.width="100%",n.domElement.style.height="100%",e.baseLayer=new XRWebGLLayer(e,n.context),e.baseLayer.addEventListener("focus",function(e){i.handleLayerFocus(e)}),e.baseLayer.addEventListener("blur",function(e){i.handleLayerBlur(e)}),e.requestFrame(u),i.sessions.push(e),i.session=e,i.sessionActive=!0,i.dispatchEvent({type:"sessionStarted",session:e})}).catch(function(e){console.error("Error requesting session",e)}))},this.endSession=function(){this.session.end(),this.dispatchEvent({type:"sessionEnded",session:this.session}),this.sessionActive=!1,this.session._display._vrDisplay&&this.session._display.isPresenting&&this.session._display._vrDisplay.exitPresent()},this.handleSessionFocus=function(e){console.log("handleSessionFocus")},this.handleSessionBlur=function(e){console.log("handleSessionBlur")},this.handleSessionEnded=function(e){console.log("handleSessionEnded")},this.handleLayerFocus=function(e){console.log("handleLayerFocus")},this.handleLayerBlur=function(e){console.log("handleLayerBlur")};var l,c=0,d=0;this.totalSupportedDisplays=0;for(var h=0;h<this.displays.length;h++){var f=this.displays[h];f.supportedRealities.vr&&c++,f.supportedRealities.ar&&(l=f,d++)}1===d&&0===c&&this.options.AR_AUTOSTART&&(this.autoStarted=!0,this.startSession(l,"ar")),this.totalSupportedDisplays=d+c,this.updateScene=function(e,t){e(t)},this.doRender=function(){this.renderer.render(this.scene,this.camera)}},THREE.WebXRManager.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.WebXRManager.prototype.constructor=THREE.WebXRManager,t.default=THREE.WebXRManager},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),THREE.WebXRUtils={getDisplays:function(){return new Promise(function(e,t){navigator.XR?navigator.XR.getDisplays().then(function(t){function i(){return void 0!==window.orientation||-1!==navigator.userAgent.indexOf("IEMobile")}if(0===t.length)return console.log("No displays are available"),void e(null);var n={exclusive:!1,type:XRSession.AUGMENTATION},r={exclusive:!0,type:XRSession.REALITY},o={vr:!1,ar:!1},a=!0,s=!1,u=void 0;try{for(var l,c=t[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var d=l.value;o={vr:!1,ar:!1},d.supportsSession(n)&&((d._reality._vrDisplay||!i()||function(){return navigator.userAgent.indexOf("AppleWebKit")&&-1===navigator.userAgent.indexOf("Safari")}())&&i()?o.ar=!0:o.ar=!1),d.supportsSession(r)&&-1===d._displayName.indexOf("polyfill")&&(o.vr=!0),d.supportedRealities=o}}catch(e){s=!0,u=e}finally{try{!a&&c.return&&c.return()}finally{if(s)throw u}}e(t)}).catch(function(t){console.error("Error getting XR displays",t),e(null)}):(console.log("WebXR polyfill is not found"),e(null))})}},t.default=THREE.WebXRUtils},function(e,t,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){function t(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var i={};t.m=e,t.c=i,t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=15)}([function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(1),a=function(e){return e&&e.__esModule?e:{default:e}}(o),s=function(){function e(){n(this,e)}return r(e,null,[{key:"mat4_generateIdentity",value:function(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},{key:"mat4_get_position",value:function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}},{key:"mat4_get_rotation",value:function(e,t){var i=new a.default;return i.setFromRotationMatrix(t),e[0]=i.x,e[1]=i.y,e[2]=i.z,e[3]=i.w,e}},{key:"mat4_eyeView",value:function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Float32Array([0,0,0]);e.mat4_translate(t,i,n),e.mat4_invert(t,t)}},{key:"mat4_perspectiveFromFieldOfView",value:function(t,i,n,r){var o=Math.tan(i.upDegrees*e.PI_OVER_180),a=Math.tan(i.downDegrees*e.PI_OVER_180),s=Math.tan(i.leftDegrees*e.PI_OVER_180),u=Math.tan(i.rightDegrees*e.PI_OVER_180),l=2/(s+u),c=2/(o+a);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(s-u)*l*.5,t[9]=(o-a)*c*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}},{key:"mat4_fromRotationTranslation",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0,1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0],n=t[0],r=t[1],o=t[2],a=t[3],s=n+n,u=r+r,l=o+o,c=n*s,d=n*u,h=n*l,f=r*u,y=r*l,_=o*l,p=a*s,v=a*u,m=a*l;return e[0]=1-(f+_),e[1]=d+m,e[2]=h-v,e[3]=0,e[4]=d-m,e[5]=1-(c+_),e[6]=y+p,e[7]=0,e[8]=h+v,e[9]=y-p,e[10]=1-(c+f),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}},{key:"mat4_translate",value:function(e,t,i){var n=i[0],r=i[1],o=i[2],a=void 0,s=void 0,u=void 0,l=void 0,c=void 0,d=void 0,h=void 0,f=void 0,y=void 0,_=void 0,p=void 0,v=void 0;return t===e?(e[12]=t[0]*n+t[4]*r+t[8]*o+t[12],e[13]=t[1]*n+t[5]*r+t[9]*o+t[13],e[14]=t[2]*n+t[6]*r+t[10]*o+t[14],e[15]=t[3]*n+t[7]*r+t[11]*o+t[15]):(a=t[0],s=t[1],u=t[2],l=t[3],c=t[4],d=t[5],h=t[6],f=t[7],y=t[8],_=t[9],p=t[10],v=t[11],e[0]=a,e[1]=s,e[2]=u,e[3]=l,e[4]=c,e[5]=d,e[6]=h,e[7]=f,e[8]=y,e[9]=_,e[10]=p,e[11]=v,e[12]=a*n+c*r+y*o+t[12],e[13]=s*n+d*r+_*o+t[13],e[14]=u*n+h*r+p*o+t[14],e[15]=l*n+f*r+v*o+t[15]),e}},{key:"mat4_invert",value:function(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7],c=t[8],d=t[9],h=t[10],f=t[11],y=t[12],_=t[13],p=t[14],v=t[15],m=i*s-n*a,w=i*u-r*a,g=i*l-o*a,E=n*u-r*s,b=n*l-o*s,M=r*l-o*u,T=c*_-d*y,x=c*p-h*y,R=c*v-f*y,A=d*p-h*_,N=d*v-f*_,L=h*v-f*p,D=m*L-w*N+g*A+E*R-b*x+M*T;return D?(D=1/D,e[0]=(s*L-u*N+l*A)*D,e[1]=(r*N-n*L-o*A)*D,e[2]=(_*M-p*b+v*E)*D,e[3]=(h*b-d*M-f*E)*D,e[4]=(u*R-a*L-l*x)*D,e[5]=(i*L-r*R+o*x)*D,e[6]=(p*g-y*M-v*w)*D,e[7]=(c*M-h*g+f*w)*D,e[8]=(a*N-s*R+l*T)*D,e[9]=(n*R-i*N-o*T)*D,e[10]=(y*b-_*g+v*m)*D,e[11]=(d*g-c*b-f*m)*D,e[12]=(s*x-a*A-u*T)*D,e[13]=(i*A-n*x+r*T)*D,e[14]=(_*w-y*E-p*m)*D,e[15]=(c*E-d*w+h*m)*D,e):null}},{key:"mat4_multiply",value:function(e,t,i){var n=t[0],r=t[4],o=t[8],a=t[12],s=t[1],u=t[5],l=t[9],c=t[13],d=t[2],h=t[6],f=t[10],y=t[14],_=t[3],p=t[7],v=t[11],m=t[15],w=i[0],g=i[4],E=i[8],b=i[12],M=i[1],T=i[5],x=i[9],R=i[13],A=i[2],N=i[6],L=i[10],D=i[14],O=i[3],I=i[7],j=i[11],k=i[15];return e[0]=n*w+r*M+o*A+a*O,e[4]=n*g+r*T+o*N+a*I,e[8]=n*E+r*x+o*L+a*j,e[12]=n*b+r*R+o*D+a*k,e[1]=s*w+u*M+l*A+c*O,e[5]=s*g+u*T+l*N+c*I,e[9]=s*E+u*x+l*L+c*j,e[13]=s*b+u*R+l*D+c*k,e[2]=d*w+h*M+f*A+y*O,e[6]=d*g+h*T+f*N+y*I,e[10]=d*E+h*x+f*L+y*j,e[14]=d*b+h*R+f*D+y*k,e[3]=_*w+p*M+v*A+m*O,e[7]=_*g+p*T+v*N+m*I,e[11]=_*E+p*x+v*L+m*j,e[15]=_*b+p*R+v*D+m*k,e}}]),e}();t.default=s,s.PI_OVER_180=Math.PI/180},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;n(this,e),this.x=t,this.y=i,this.z=r,this.w=o}return r(e,[{key:"set",value:function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}},{key:"toArray",value:function(){return[this.x,this.y,this.z,this.w]}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:"setFromRotationMatrix",value:function(e){var t=e[0],i=e[4],n=e[8],r=e[1],o=e[5],a=e[9],s=e[2],u=e[6],l=e[10],c=t+o+l;if(c>0){var d=.5/Math.sqrt(c+1);this.w=.25/d,this.x=(u-a)*d,this.y=(n-s)*d,this.z=(r-i)*d}else if(t>o&&t>l){var h=2*Math.sqrt(1+t-o-l);this.w=(u-a)/h,this.x=.25*h,this.y=(i+r)/h,this.z=(n+s)/h}else if(o>l){var f=2*Math.sqrt(1+o-t-l);this.w=(n-s)/f,this.x=(i+r)/f,this.y=.25*f,this.z=(a+u)/f}else{var y=2*Math.sqrt(1+l-t-o);this.w=(r-i)/y,this.x=(n+s)/y,this.y=(a+u)/y,this.z=.25*y}return this}},{key:"setFromEuler",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"XYZ",r=Math.cos,o=Math.sin,a=r(e/2),s=r(t/2),u=r(i/2),l=o(e/2),c=o(t/2),d=o(i/2);"XYZ"===n?(this.x=l*s*u+a*c*d,this.y=a*c*u-l*s*d,this.z=a*s*d+l*c*u,this.w=a*s*u-l*c*d):"YXZ"===n?(this.x=l*s*u+a*c*d,this.y=a*c*u-l*s*d,this.z=a*s*d-l*c*u,this.w=a*s*u+l*c*d):"ZXY"===n?(this.x=l*s*u-a*c*d,this.y=a*c*u+l*s*d,this.z=a*s*d+l*c*u,this.w=a*s*u-l*c*d):"ZYX"===n?(this.x=l*s*u-a*c*d,this.y=a*c*u+l*s*d,this.z=a*s*d-l*c*u,this.w=a*s*u+l*c*d):"YZX"===n?(this.x=l*s*u+a*c*d,this.y=a*c*u+l*s*d,this.z=a*s*d-l*c*u,this.w=a*s*u-l*c*d):"XZY"===n&&(this.x=l*s*u-a*c*d,this.y=a*c*u-l*s*d,this.z=a*s*d+l*c*u,this.w=a*s*u+l*c*d)}},{key:"setFromAxisAngle",value:function(e,t){var i=t/2,n=Math.sin(i);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(i),this}},{key:"multiply",value:function(e){return this.multiplyQuaternions(this,e)}},{key:"multiplyQuaternions",value:function(e,t){var i=e.x,n=e.y,r=e.z,o=e.w,a=t.x,s=t.y,u=t.z,l=t.w;return this.x=i*l+o*a+n*u-r*s,this.y=n*l+o*s+r*a-i*u,this.z=r*l+o*u+i*s-n*a,this.w=o*l-i*a-n*s-r*u,this}},{key:"inverse",value:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this}},{key:"normalize",value:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/e,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var i=this.x,n=this.y,r=this.z,o=this.w,a=o*e.w+i*e.x+n*e.y+r*e.z;if(a<0?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,a=-a):this.copy(e),a>=1)return this.w=o,this.x=i,this.y=n,this.z=r,this;var s=Math.acos(a),u=Math.sqrt(1-a*a);if(Math.abs(u)<.001)return this.w=.5*(o+this.w),this.x=.5*(i+this.x),this.y=.5*(n+this.y),this.z=.5*(r+this.z),this;var l=Math.sin((1-t)*s)/u,c=Math.sin(t*s)/u;return this.w=o*l+this.w*c,this.x=i*l+this.x*c,this.y=n*l+this.y*c,this.z=r*l+this.z*c,this}}]),e}();t.default=o},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(){function e(){n(this,e),this._listeners=new Map}return r(e,[{key:"addEventListener",value:function(e,t){var i=this._listeners.get(e);!1===Array.isArray(i)&&(i=[],this._listeners.set(e,i)),i.push(t)}},{key:"removeEventListener",value:function(e,t){var i=this._listeners.get(e);if(!1!==Array.isArray(i))for(var n=0;n<i.length;n++)if(i[n]===t)return void i.splice(n,1)}},{key:"dispatchEvent",value:function(e){var t=this._listeners.get(e.type);if(!1!==Array.isArray(t)){var i=!0,n=!1,r=void 0;try{for(var o,a=t[Symbol.iterator]();!(i=(o=a.next()).done);i=!0){(0,o.value)(e)}}catch(e){n=!0,r=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw r}}}}}]),e}();t.default=o},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(){function e(t){n(this,e),this._uid=e._generateUID(),this._coordinateSystem=t}return r(e,[{key:"uid",get:function(){return this._uid}},{key:"coordinateSystem",get:function(){return this._coordinateSystem}}],[{key:"_generateUID",value:function(){return"anchor-"+(new Date).getTime()+"-"+Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)}}]),e}();t.default=o},function(e,t,i){function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":n(t))&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":n(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=i(0),c=r(l),d=i(2),h=r(d),f=i(16),y=r(f),_=i(17),p=r(_),v=function(e){function t(e,i,n,r){o(this,t);var s=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));s._xr=e,s._displayName=i,s._isExternal=n,s._reality=r,s._headModelCoordinateSystem=new XRCoordinateSystem(s,XRCoordinateSystem.HEAD_MODEL),s._eyeLevelCoordinateSystem=new XRCoordinateSystem(s,XRCoordinateSystem.EYE_LEVEL),s._trackerCoordinateSystem=new XRCoordinateSystem(s,XRCoordinateSystem.TRACKER),s._headPose=new XRViewPose([0,XRViewPose.SITTING_EYE_HEIGHT,0]),s._eyeLevelPose=new XRViewPose([0,XRViewPose.SITTING_EYE_HEIGHT,0]),s._trackerPoseModelMatrix=c.default.mat4_generateIdentity();return s._fov=new p.default(25,25,25,25),s._depthNear=.1,s._depthFar=1e3,s._views=[],s}return s(t,e),u(t,[{key:"supportsSession",value:function(e){return this._supportedCreationParameters(e)}},{key:"requestSession",value:function(e){var t=this;return new Promise(function(i,n){if(!1===t._supportedCreationParameters(e))return void n();e.type===XRSession.REALITY&&(t._reality=new y.default,t._xr._privateRealities.push(t._reality)),i(t._createSession(e))})}},{key:"_requestAnimationFrame",value:function(e){return window.requestAnimationFrame(e)}},{key:"_cancelAnimationFrame",value:function(e){return window.cancelAnimationFrame(e)}},{key:"_createSession",value:function(e){return new XRSession(this._xr,this,e)}},{key:"_supportedCreationParameters",value:function(e){throw"Should be implemented by extending class"}},{key:"_handleNewFrame",value:function(e){}},{key:"_handleAfterFrame",value:function(e){}},{key:"_handleNewBaseLayer",value:function(e){}},{key:"displayName",get:function(){return this._displayName}},{key:"isExternal",get:function(){return this._isExternal}}]),t}(h.default);t.default=v},function(e,t,i){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":n(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":n(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),u=i(2),l=function(e){return e&&e.__esModule?e:{default:e}}(u),c=function(e){function t(e,i,n,a){r(this,t);var s=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return s._xr=e,s._name=i,s._isShared=n,s._isPassthrough=a,s._anchors=new Map,s}return a(t,e),s(t,[{key:"getCoordinateSystem",value:function(){throw new Error("Not implemented")}},{key:"_start",value:function(){throw new Error("Exending classes should implement _start")}},{key:"_stop",value:function(){throw new Error("Exending classes should implement _stop")}},{key:"_handleNewFrame",value:function(){}},{key:"_addAnchor",value:function(e,t){throw new Error("Exending classes should implement _addAnchor")}},{key:"_findAnchor",value:function(e,t,i){throw new Error("Exending classes should implement _findAnchor")}},{key:"_findFloorAnchor",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=new Float32Array(e._headPose.poseModelMatrix);return new Promise(function(r,o){n[13]=0;var a=new XRCoordinateSystem(e,XRCoordinateSystem.TRACKER);a._relativeMatrix=n;var s=new XRAnchor(a,i);t._addAnchor(s,e),r(new XRAnchorOffset(s.uid))})}},{key:"_getAnchor",value:function(e){return this._anchors.get(e)||null}},{key:"_removeAnchor",value:function(e){throw new Error("Exending classes should implement _removeAnchor")}},{key:"name",get:function(){return this._name}},{key:"isShared",get:function(){return this._isShared}},{key:"isPassthrough",get:function(){return this._isPassthrough}}]),t}(l.default);t.default=c},function(e,t,i){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":n(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":n(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),u=i(2),l=function(e){return e&&e.__esModule?e:{default:e}}(u),c=function(e){function t(e,i,n){r(this,t);var a=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a._xr=e,a._display=i,a._createParameters=n,a._ended=!1,a._baseLayer=null,a._stageBounds=null,a}return a(t,e),s(t,[{key:"requestFrame",value:function(e){var t=this;if(this._ended)return null;if("function"!=typeof e)throw"Invalid callback";return this._display._requestAnimationFrame(function(){var i=t._createPresentationFrame();t._display._reality._handleNewFrame(i),t._display._handleNewFrame(i),e(i),t._display._handleAfterFrame(i)})}},{key:"cancelFrame",value:function(e){return this._display._cancelAnimationFrame(e)}},{key:"end",value:function(){if(!this._ended)return this._ended=!0,this._display._stop(),new Promise(function(e,t){e()})}},{key:"_createPresentationFrame",value:function(){return new XRPresentationFrame(this)}},{key:"_getCoordinateSystem",value:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];var n=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){switch(a.value){case XRCoordinateSystem.HEAD_MODEL:return this._display._headModelCoordinateSystem;case XRCoordinateSystem.EYE_LEVEL:return this._display._eyeLevelCoordinateSystem;case XRCoordinateSystem.TRACKER:return this._display._trackerCoordinateSystem;case XRCoordinateSystem.GEOSPATIAL:default:continue}}}catch(e){r=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw o}}return null}},{key:"display",get:function(){return this._display}},{key:"createParameters",get:function(){return this._parameters}},{key:"realities",get:function(){return this._xr._sharedRealities}},{key:"reality",get:function(){return this._display._reality}},{key:"baseLayer",get:function(){return this._baseLayer},set:function(e){this._baseLayer=e,this._display._handleNewBaseLayer(this._baseLayer)}},{key:"depthNear",get:function(){this._display._depthNear},set:function(e){this._display._depthNear=e}},{key:"depthFar",get:function(){this._display._depthFar},set:function(e){this._display._depthFar=e}},{key:"hasStageBounds",get:function(){this._stageBounds}},{key:"stageBounds",get:function(){return this._stageBounds}}]),t}(l.default);t.default=c,c.REALITY="reality",c.AUGMENTATION="augmentation",c.TYPES=[c.REALITY,c.AUGMENTATION]},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(12),s=n(a),u=i(0),l=n(u),c=function(){function e(t,i,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;r(this,e),this._fov=t,this._depthNear=i,this._depthFar=n,this._eye=o,this._viewport=new s.default(0,0,1,1),this._projectionMatrix=new Float32Array(16),l.default.mat4_perspectiveFromFieldOfView(this._projectionMatrix,this._fov,this._depthNear,this._depthFar)}return o(e,[{key:"setProjectionMatrix",value:function(e){for(var t=0;t<16;t++)this._projectionMatrix[t]=e[t]}},{key:"getViewport",value:function(t){return this._eye===e.LEFT?(this._viewport.x=0,this._viewport.y=0,this._viewport.width=t.framebufferWidth/2,this._viewport.height=t.framebufferHeight):this._eye===e.RIGHT?(this._viewport.x=t.framebufferWidth/2,this._viewport.y=0,this._viewport.width=t.framebufferWidth/2,this._viewport.height=t.framebufferHeight):(this._viewport.x=0,this._viewport.y=0,this._viewport.width=t.framebufferWidth,this._viewport.height=t.framebufferHeight),this._viewport}},{key:"eye",get:function(){return this._eye}},{key:"projectionMatrix",get:function(){return this._projectionMatrix}}]),e}();t.default=c,c.LEFT="left",c.RIGHT="right",c.EYES=[c.LEFT,c.RIGHT]},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(0),s=n(a),u=i(1),l=n(u),c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0,1];r(this,e),this._poseModelMatrix=new Float32Array(16),s.default.mat4_fromRotationTranslation(this._poseModelMatrix,i,t)}return o(e,[{key:"_setPoseModelMatrix",value:function(e){for(var t=0;t<16;t++)this._poseModelMatrix[t]=e[t]}},{key:"_translate",value:function(e){this._poseModelMatrix[12]+=e[0],this._poseModelMatrix[13]+=e[1],this._poseModelMatrix[14]+=e[2]}},{key:"getViewMatrix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null===t&&(t=new Float32Array(16)),s.default.mat4_eyeView(t,this._poseModelMatrix),t}},{key:"poseModelMatrix",get:function(){return this._poseModelMatrix}},{key:"_position",get:function(){return[this._poseModelMatrix[12],this._poseModelMatrix[13],this._poseModelMatrix[14]]},set:function(e){this._poseModelMatrix[12]=e[0],this._poseModelMatrix[13]=e[1],this._poseModelMatrix[14]=e[2]}},{key:"_orientation",get:function(){var e=new l.default;return e.setFromRotationMatrix(this._poseModelMatrix),e.toArray()},set:function(e){s.default.mat4_fromRotationTranslation(this._poseModelMatrix,e,this._position)}}]),e}();t.default=c,c.SITTING_EYE_HEIGHT=1.1},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;n(this,e),this.x=t,this.y=i,this.z=r}return r(e,[{key:"set",value:function(e,t,i){return this.x=e,this.y=t,this.z=i,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"toArray",value:function(){return[this.x,this.y,this.z]}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"add",value:function(e,t,i){this.x+=e,this.y+=t,this.z+=i}},{key:"normalize",value:function(){var e=this.length();return 0!==e?this.multiplyScalar(1/e):(this.x=0,this.y=0,this.z=0),this}},{key:"multiplyScalar",value:function(e){this.x*=e,this.y*=e,this.z*=e}},{key:"applyQuaternion",value:function(e){var t=this.x,i=this.y,n=this.z,r=e.x,o=e.y,a=e.z,s=e.w,u=s*t+o*n-a*i,l=s*i+a*t-r*n,c=s*n+r*i-o*t,d=-r*t-o*i-a*n;return this.x=u*s+d*-r+l*-a-c*-o,this.y=l*s+d*-o+c*-r-u*-a,this.z=c*s+d*-a+u*-o-l*-r,this}},{key:"applyMatrix4",value:function(e){var t=this.x,i=this.y,n=this.z,r=1/(e[3]*t+e[7]*i+e[11]*n+e[15]);return this.x=(e[0]*t+e[4]*i+e[8]*n+e[12])*r,this.y=(e[1]*t+e[5]*i+e[9]*n+e[13])*r,this.z=(e[2]*t+e[6]*i+e[10]*n+e[14])*r,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"crossVectors",value:function(e,t){var i=e.x,n=e.y,r=e.z,o=t.x,a=t.y,s=t.z;return this.x=n*s-r*a,this.y=r*o-i*s,this.z=i*a-n*o,this}}]),e}();t.default=o},function(e,t,i){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":n(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":n(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?function(e){return void 0===e?"undefined":n(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":n(e)},u=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=i(2),c=function(e){return e&&e.__esModule?e:{default:e}}(l),d=function(e){function t(){r(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(!1===t.HasARKit())throw"ARKitWrapper will only work in Mozilla's ARDemo test app";if(void 0!==t.GLOBAL_INSTANCE)throw"ARKitWrapper is a singleton. Use ARKitWrapper.GetOrCreate() to get the global instance.";e._deviceId=null,e._isWatching=!1,e._isInitialized=!1,e._rawARData=null,e._globalCallbacksMap={};for(var i=["onInit","onWatch"],n=0;n<i.length;n++)e._generateGlobalCallback(i[n],n);for(var a=[["arkitStartRecording",t.RECORD_START_EVENT],["arkitStopRecording",t.RECORD_STOP_EVENT],["arkitDidMoveBackground",t.DID_MOVE_BACKGROUND_EVENT],["arkitWillEnterForeground",t.WILL_ENTER_FOREGROUND_EVENT],["arkitInterrupted",t.INTERRUPTED_EVENT],["arkitInterruptionEnded",t.INTERRUPTION_ENDED_EVENT],["arkitShowDebug",t.SHOW_DEBUG_EVENT]],s=0;s<a.length;s++)!function(t){window[a[t][0]]=function(i){i=i||null,e.dispatchEvent(new CustomEvent(a[t][1],{source:e,detail:i}))}}(s);return e}return a(t,e),u(t,[{key:"waitForInit",value:function(){var e=this;return new Promise(function(i,n){if(e._isInitialized)return void i();var r=function n(){e.removeEventListener(t.INIT_EVENT,n,!1),i()};e.addEventListener(t.INIT_EVENT,r,!1)})}},{key:"getData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===e?this._rawARData:this._rawARData&&void 0!==this._rawARData[e]?this._rawARData[e]:null}},{key:"getObject",value:function(e){if(!this._isInitialized)return null;var t=this.getKey("objects");if(null===t)return null;var i=!0,n=!1,r=void 0;try{for(var o,a=t[Symbol.iterator]();!(i=(o=a.next()).done);i=!0){var s=o.value;if(s.uuid===e)return s}}catch(e){n=!0,r=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw r}}return null}},{key:"hitTest",value:function(e,i){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.HIT_TEST_TYPE_ALL;return new Promise(function(t,o){if(!n._isInitialized)return void o(new Error("ARKit is not initialized"));window.webkit.messageHandlers.hitTest.postMessage({x:e,y:i,type:r,callback:n._createPromiseCallback("hitTest",t)})})}},{key:"addAnchor",value:function(e,t){var i=this;return new Promise(function(n,r){if(!i._isInitialized)return void r(new Error("ARKit is not initialized"));window.webkit.messageHandlers.addAnchor.postMessage({uuid:e,transform:t,callback:i._createPromiseCallback("addAnchor",n)})})}},{key:"stop",value:function(){var e=this;return new Promise(function(t,i){if(!e._isWatching)return void t();window.webkit.messageHandlers.stopAR.postMessage({callback:e._createPromiseCallback("stop",t)})})}},{key:"watch",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!this._isInitialized)return!1;if(this._isWatching)return!0;this._isWatching=!0,null===e&&(e={location:!0,camera:!0,objects:!0,light_intensity:!0});var t={options:e,callback:this._globalCallbacksMap.onWatch};return window.webkit.messageHandlers.watchAR.postMessage(t),!0}},{key:"setUIOptions",value:function(e){window.webkit.messageHandlers.setUIOptions.postMessage(e)}},{key:"_sendInit",value:function(e){window.webkit.messageHandlers.initAR.postMessage({options:e,callback:this._globalCallbacksMap.onInit})}},{key:"_onInit",value:function(e){this._deviceId=e,this._isInitialized=!0,this.dispatchEvent(new CustomEvent(t.INIT_EVENT,{source:this}))}},{key:"_onWatch",value:function(e){this._rawARData=e,this.dispatchEvent(new CustomEvent(t.WATCH_EVENT,{source:this,detail:this._rawARData}))}},{key:"_onStop",value:function(){this._isWatching=!1}},{key:"_createPromiseCallback",value:function(e,t){var i=this,n=this._generateCallbackUID(e);return window[n]=function(r){delete window[n];var o="_on"+e[0].toUpperCase()+e.slice(1);"function"==typeof i[o]&&i[o](r),t(r)},n}},{key:"_generateCallbackUID",value:function(e){return"arkitCallback_"+e+"_"+(new Date).getTime()+"_"+Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)}},{key:"_generateGlobalCallback",value:function(e,t){var i="arkitCallback"+t;this._globalCallbacksMap[e]=i;var n=this;window[i]=function(t){n["_"+e](t)}}},{key:"deviceId",get:function(){return this._deviceId}},{key:"isWatching",get:function(){return this._isWatching}},{key:"isInitialized",get:function(){return this._isInitialized}},{key:"hasData",get:function(){return null!==this._rawARData}}],[{key:"GetOrCreate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(void 0===t.GLOBAL_INSTANCE){t.GLOBAL_INSTANCE=new t,e=e&&"object"==(void 0===e?"undefined":s(e))?e:{};var i={browser:!0,points:!0,focus:!1,rec:!0,rec_time:!0,mic:!1,build:!1,plane:!0,warnings:!0,anchors:!1,debug:!0,statistics:!1},n="object"==s(e.ui)?e.ui:{};e.ui=Object.assign(i,n),t.GLOBAL_INSTANCE._sendInit(e)}return t.GLOBAL_INSTANCE}},{key:"HasARKit",value:function(){return void 0!==window.webkit}}]),t}(c.default);t.default=d,d.INIT_EVENT="arkit-init",d.WATCH_EVENT="arkit-watch",d.RECORD_START_EVENT="arkit-record-start",d.RECORD_STOP_EVENT="arkit-record-stop",d.DID_MOVE_BACKGROUND_EVENT="arkit-did-move-background",d.WILL_ENTER_FOREGROUND_EVENT="arkit-will-enter-foreground",d.INTERRUPTED_EVENT="arkit-interrupted",d.INTERRUPTION_ENDED_EVENT="arkit-interruption-ended",d.SHOW_DEBUG_EVENT="arkit-show-debug",d.HIT_TEST_TYPE_FEATURE_POINT=1,d.HIT_TEST_TYPE_EXISTING_PLANE=8,d.HIT_TEST_TYPE_ESTIMATED_HORIZONTAL_PLANE=2,d.HIT_TEST_TYPE_EXISTING_PLANE_USING_EXTENT=16,d.HIT_TEST_TYPE_ALL=d.HIT_TEST_TYPE_FEATURE_POINT|d.HIT_TEST_TYPE_EXISTING_PLANE|d.HIT_TEST_TYPE_ESTIMATED_HORIZONTAL_PLANE|d.HIT_TEST_TYPE_EXISTING_PLANE_USING_EXTENT,d.HIT_TEST_TYPE_EXISTING_PLANES=d.HIT_TEST_TYPE_EXISTING_PLANE|d.HIT_TEST_TYPE_EXISTING_PLANE_USING_EXTENT},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(0),s=n(a),u=i(1),l=n(u),c=i(3),d=(n(c),function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;r(this,e),this._anchorUID=t,this._poseMatrix=i||s.default.mat4_generateIdentity()}return o(e,[{key:"getOffsetTransform",value:function(e){return s.default.mat4_multiply(new Float32Array(16),this._poseMatrix,e._poseModelMatrix)}},{key:"anchorUID",get:function(){return this._anchorUID}},{key:"poseMatrix",get:function(){return this._poseMatrix},set:function(e){for(var t=0;t<16;t++)this._poseMatrix[t]=e[t]}},{key:"position",get:function(){return new Float32Array([this._poseMatrix[12],this._poseMatrix[13],this._poseMatrix[14]])}},{key:"orientation",get:function(){var e=new l.default;return e.setFromRotationMatrix(this._poseMatrix),e.toArray()}}]),e}());t.default=d},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(){function e(t,i,r,o){n(this,e),this._x=t,this._y=i,this._width=r,this._height=o}return r(e,[{key:"x",get:function(){return this._x},set:function(e){this._x=e}},{key:"y",get:function(){return this._y},set:function(e){this._y=e}},{key:"width",get:function(){return this._width},set:function(e){this._width=e}},{key:"height",get:function(){return this._height},set:function(e){this._height=e}}]),e}();t.default=o},function(e,t,i){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":n(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":n(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=i(2),u=function(e){return e&&e.__esModule?e:{default:e}}(s),l=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),t}(u.default);t.default=l},function(e,t,i){function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":n(t))&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":n(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=i(2),c=r(l),d=i(9),h=r(d),f=i(1),y=r(f),_=i(28),p=r(_),v=function(e){function t(){o(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._deviceOrientation=null,e._windowOrientation=0,window.addEventListener("orientationchange",function(){e._windowOrientation=window.orientation||0},!1),window.addEventListener("deviceorientation",function(i){e._deviceOrientation=i,e.dispatchEvent(new CustomEvent(t.ORIENTATION_UPDATE_EVENT,{deviceOrientation:e._deviceOrientation,windowOrientation:e._windowOrientation}))},!1),e}return s(t,e),u(t,[{key:"getOrientation",value:function(e){return null===this._deviceOrientation?(e.set(0,0,0,1),!1):(t.WORKING_EULER.set(this._deviceOrientation.beta*t.DEG_TO_RAD,this._deviceOrientation.alpha*t.DEG_TO_RAD,-1*this._deviceOrientation.gamma*t.DEG_TO_RAD,"YXZ"),e.setFromEuler(t.WORKING_EULER.x,t.WORKING_EULER.y,t.WORKING_EULER.z,t.WORKING_EULER.order),e.multiply(t.HALF_PI_AROUND_X),e.multiply(t.WORKING_QUATERNION.setFromAxisAngle(t.Z_AXIS,-this._windowOrientation*t.DEG_TO_RAD)),!0)}}]),t}(c.default);t.default=v,v.ORIENTATION_UPDATE_EVENT="orientation-update",v.Z_AXIS=new h.default(0,0,1),v.WORKING_EULER=new p.default,v.WORKING_QUATERNION=new y.default,v.HALF_PI_AROUND_X=new y.default(-Math.sqrt(.5),0,0,Math.sqrt(.5)),v.DEG_TO_RAD=Math.PI/180},function(e,t,i){function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":n(t))&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":n(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=i(4),c=r(l),d=i(6),h=r(d),f=i(18),y=r(f),_=i(5),p=r(_),v=i(19),m=r(v),w=i(20),g=r(w),E=i(3),b=r(E),M=i(21),T=r(M),x=i(11),R=r(x),A=i(22),N=r(A),L=i(23),D=r(L),O=i(24),I=r(O),j=i(7),k=r(j),S=i(12),P=r(S),C=i(25),z=r(C),F=i(8),H=r(F),W=i(13),U=r(W),V=i(26),G=r(V),B=i(2),X=r(B),Y=i(27),Q=r(Y),Z=i(29),K=r(Z),J=i(30),q=r(J),$=function(e){function t(){o(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));window.XRDisplay=c.default,window.XRSession=h.default,window.XRSessionCreateParameters=y.default,window.Reality=p.default,window.XRPointCloud=m.default,window.XRLightEstimate=g.default,window.XRAnchor=b.default,window.XRPlaneAnchor=T.default,window.XRAnchorOffset=R.default,window.XRStageBounds=N.default,window.XRStageBoundsPoint=D.default,window.XRPresentationFrame=I.default,window.XRView=k.default,window.XRViewport=P.default,window.XRCoordinateSystem=z.default,window.XRViewPose=H.default,window.XRLayer=U.default,window.XRWebGLLayer=G.default,e._getVRDisplaysFinished=!1,e._sharedRealities=[new q.default(e)],e._privateRealities=[],e._displays=[new Q.default(e,e._sharedRealities[0])],"function"==typeof navigator.getVRDisplays?navigator.getVRDisplays().then(function(t){var i=!0,n=!1,r=void 0;try{for(var o,a=t[Symbol.iterator]();!(i=(o=a.next()).done);i=!0){var s=o.value;null!==s&&(s.capabilities.canPresent&&e._displays.push(new K.default(e,e._sharedRealities[0],s)))}}catch(e){n=!0,r=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw r}}e._getVRDisplaysFinished=!0}):e._getVRDisplaysFinished=!0,e._sessionEls=document.createElement("div"),e._sessionEls.setAttribute("class","webxr-sessions"),e._realityEls=document.createElement("div"),e._realityEls.setAttribute("class","webxr-realities");for(var i=[e._sessionEls,e._realityEls],n=0;n<i.length;n++){var r=i[n];r.style.position="absolute",r.style.width="100%",r.style.height="100%"}return document.addEventListener("DOMContentLoaded",function(){document.body.style.width="100%",document.body.style.height="100%",document.body.prepend(e._sessionEls),document.body.prepend(e._realityEls)}),e}return s(t,e),u(t,[{key:"getDisplays",value:function(){var e=this,t=function t(i){e._getVRDisplaysFinished?i(e._displays):setTimeout(t.bind(e,i),30)};return new Promise(function(e,i){t(e)})}}]),t}(X.default);void 0===navigator.XR&&(navigator.XR=new $)},function(e,t,i){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":n(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":n(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),u=i(5),l=function(e){return e&&e.__esModule?e:{default:e}}(u),c=function(e){function t(e){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Virtual",!1,!1))}return a(t,e),s(t,[{key:"_start",value:function(){}},{key:"_stop",value:function(){}},{key:"_handleNewFrame",value:function(){}},{key:"_addAnchor",value:function(e,t){return this._anchors.set(e.uid,e),e.uid}},{key:"_findAnchor",value:function(e,t,i){return new Promise(function(e,t){e(null)})}},{key:"_removeAnchor",value:function(e){this._anchors.delete(e)}}]),t}(l.default);t.default=c},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(){function e(t,i,r,o){n(this,e),this._upDegrees=t,this._downDegrees=i,this._leftDegrees=r,this._rightDegrees=o}return r(e,[{key:"upDegrees",get:function(){return this._upDegrees}},{key:"downDegrees",get:function(){return this._downDegrees}},{key:"leftDegrees",get:function(){return this._leftDegrees}},{key:"rightDegrees",get:function(){return this._rightDegrees}}]),e}();t.default=o},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(){function e(){n(this,e)}return r(e,[{key:"exclusive",get:function(){throw"Not implemented"}},{key:"type",get:function(){throw"Not implemented"}}]),e}();t.default=o},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(){function e(){n(this,e)}return r(e,[{key:"points",get:function(){throw new Error("Not implemented")}}]),e}();t.default=o},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(){function e(){n(this,e)}return r(e,[{key:"getAmbientColorTemperature",value:function(){throw new Error("Not implemented")}},{key:"ambientIntensity",get:function(){throw new Error("Not implemented")}}]),e}();t.default=o},function(e,t,i){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":n(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":n(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),u=i(3),l=function(e){return e&&e.__esModule?e:{default:e}}(u),c=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),s(t,[{key:"width",get:function(){throw"Not implemented"}},{key:"length",get:function(){throw"Not implemented"}}]),t}(l.default);t.default=c},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(){function e(){n(this,e)}return r(e,[{key:"center",get:function(){throw new Error("Not implemented")}},{key:"geometry",get:function(){throw new Error("Not implemented")}}]),e}();t.default=o},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(){function e(){n(this,e)}return r(e,[{key:"x",get:function(){throw new Error("Not implemented")}},{key:"y",get:function(){throw new Error("Not implemented")}}]),e}();t.default=o},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(3),s=n(a),u=i(0),l=n(u),c=function(){function e(t){r(this,e),this._session=t}return o(e,[{key:"addAnchor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0,1],n=l.default.mat4_fromRotationTranslation(new Float32Array(16),i,t);l.default.mat4_multiply(n,e.getTransformTo(this._session._display._trackerCoordinateSystem),n);var r=new XRCoordinateSystem(this._session._display,XRCoordinateSystem.TRACKER);return r._relativeMatrix=n,this._session.reality._addAnchor(new s.default(r),this._session.display)}},{key:"findAnchor",value:function(e,t){return this._session.reality._findAnchor(e,t,this._session.display)}},{key:"findFloorAnchor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this._session.reality._findFloorAnchor(this._session.display,e)}},{key:"removeAnchor",value:function(e){return this._session.reality._removeAnchor(e)}},{key:"getAnchor",value:function(e){return this._session.reality._getAnchor(e)}},{key:"getCoordinateSystem",value:function(){var e;return(e=this._session)._getCoordinateSystem.apply(e,arguments)}},{key:"getDisplayPose",value:function(e){switch(e._type){case XRCoordinateSystem.HEAD_MODEL:return this._session._display._headPose;case XRCoordinateSystem.EYE_LEVEL:return this._session._display._eyeLevelPose;default:return null}}},{key:"session",get:function(){return this._session}},{key:"views",get:function(){return this._session._display._views}},{key:"hasPointCloud",get:function(){return!1}},{key:"pointCloud",get:function(){return null}},{key:"hasLightEstimate",get:function(){return!1}},{key:"lightEstimate",get:function(){return null}},{key:"anchors",get:function(){var e=[],t=!0,i=!1,n=void 0;try{for(var r,o=this._session.reality._anchors.values()[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a=r.value;e.push(a)}}catch(e){i=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(i)throw n}}return e}}]),e}();t.default=c},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(0),a=function(e){return e&&e.__esModule?e:{default:e}}(o),s=function(){function e(t,i){n(this,e),this._display=t,this._type=i,this.__relativeMatrix=a.default.mat4_generateIdentity(),this._workingMatrix=a.default.mat4_generateIdentity()}return r(e,[{key:"getTransformTo",value:function(e){var t=a.default.mat4_invert(new Float32Array(16),e._poseModelMatrix),i=a.default.mat4_generateIdentity();return a.default.mat4_multiply(i,t,i),a.default.mat4_multiply(i,this._poseModelMatrix,i),i}},{key:"_relativeMatrix",get:function(){return this.__relativeMatrix},set:function(e){for(var t=0;t<16;t++)this.__relativeMatrix[t]=e[t]}},{key:"_poseModelMatrix",get:function(){switch(this._type){case e.HEAD_MODEL:return this._display._headPose.poseModelMatrix;case e.EYE_LEVEL:return this._display._eyeLevelPose.poseModelMatrix;case e.TRACKER:return a.default.mat4_multiply(this._workingMatrix,this.__relativeMatrix,this._display._trackerPoseModelMatrix),this._workingMatrix;default:throw new Error("Unknown coordinate system type: "+this._type)}}}]),e}();t.default=s,s.HEAD_MODEL="headModel",s.EYE_LEVEL="eyeLevel",s.TRACKER="tracker",s.TYPES=[s.HEAD_MODEL,s.EYE_LEVEL,s.TRACKER]},function(e,t,i){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":n(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":n(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),u=i(13),l=function(e){return e&&e.__esModule?e:{default:e}}(u),c=function(e){function t(e,i){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n._session=e,n._context=i,n._width=n._context.canvas.width,n._height=n._context.canvas.height,n._framebuffer=null,n}return a(t,e),s(t,[{key:"requestViewportScaling",value:function(e){throw"Not implemented"}},{key:"context",get:function(){return this._context}},{key:"antialias",get:function(){throw"Not implemented"}},{key:"depth",get:function(){throw"Not implemented"}},{key:"stencil",get:function(){throw"Not implemented"}},{key:"alpha",get:function(){throw"Not implemented"}},{key:"multiview",get:function(){throw"Not implemented"}},{key:"framebuffer",get:function(){return this._framebuffer}},{key:"framebufferWidth",set:function(e){this._width=e,this._context.canvas.width=e},get:function(){return this._width}},{key:"framebufferHeight",set:function(e){this._height=e,this._context.canvas.height=e},get:function(){return this._height}}]),t}(l.default);t.default=c},function(e,t,i){function r(e){return e&&e.__esModule?e:{default:e}}function o(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":n(t))&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":n(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),c=function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(n)},d=i(4),h=r(d),f=i(7),y=r(f),_=i(6),p=r(_),v=i(0),m=r(v),w=i(1),g=r(w),E=i(9),b=r(E),M=i(14),T=r(M),x=i(10),R=r(x),A=function(e){function t(e,i){a(this,t);var n=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Flat",!1,i));return n._started=!1,n._initialized=!1,n._arKitWrapper=null,n._vrFrameData=null,n._deviceOrientationTracker=null,n._deviceOrientation=null,n._devicePosition=null,n._deviceWorldMatrix=null,n._views.push(new y.default(n._fov,n._depthNear,n._depthFar)),n}return u(t,e),l(t,[{key:"_start",value:function(){var e=this;this._reality._vrDisplay?null===this._vrFrameData&&(this._vrFrameData=new VRFrameData,this._views[0]._depthNear=this._reality._vrDisplay.depthNear,this._views[0]._depthFar=this._reality._vrDisplay.depthFar,this._deviceOrientation=new g.default,this._devicePosition=new b.default,this._deviceWorldMatrix=new Float32Array(16)):R.default.HasARKit()?!1===this._initialized?(this._initialized=!0,this._arKitWrapper=R.default.GetOrCreate(),this._arKitWrapper.addEventListener(R.default.INIT_EVENT,this._handleARKitInit.bind(this)),this._arKitWrapper.addEventListener(R.default.WATCH_EVENT,this._handleARKitUpdate.bind(this)),this._arKitWrapper.waitForInit().then(function(){e._arKitWrapper.watch()})):this._arKitWrapper.watch():!1===this._initialized&&(this._initialized=!0,this._deviceOrientation=new g.default,this._devicePosition=new b.default,this._deviceWorldMatrix=new Float32Array(16),this._deviceOrientationTracker=new T.default,this._deviceOrientationTracker.addEventListener(T.default.ORIENTATION_UPDATE_EVENT,this._updateFromDeviceOrientationTracker.bind(this))),this.running=!0,this._reality._start()}},{key:"_stop",value:function(){!1!==this.running&&(this.running=!1,this._reality._stop())}},{key:"_handleNewBaseLayer",value:function(e){e._context.canvas.style.width="100%",e._context.canvas.style.height="100%",e._context.canvas.width=this._xr._sessionEls.clientWidth,e._context.canvas.height=this._xr._sessionEls.clientHeight,window.addEventListener("resize",function(){e.framebufferWidth=e._context.canvas.clientWidth,e.framebufferHeight=e._context.canvas.clientHeight},!1),this._xr._sessionEls.appendChild(e._context.canvas)}},{key:"_handleNewFrame",value:function(e){null!==this._vrFrameData&&this._updateFromVRDevice()}},{key:"_updateFromVRDevice",value:function(){var e,t;this._reality._vrDisplay.getFrameData(this._vrFrameData),this._views[0].setProjectionMatrix(this._vrFrameData.leftProjectionMatrix),(e=this._deviceOrientation).set.apply(e,o(this._vrFrameData.pose.orientation)),(t=this._devicePosition).set.apply(t,o(this._vrFrameData.pose.position)),this._devicePosition.add(0,XRViewPose.SITTING_EYE_HEIGHT,0),m.default.mat4_fromRotationTranslation(this._deviceWorldMatrix,this._deviceOrientation.toArray(),this._devicePosition.toArray()),this._headPose._setPoseModelMatrix(this._deviceWorldMatrix),this._eyeLevelPose._position=this._devicePosition.toArray()}},{key:"_updateFromDeviceOrientationTracker",value:function(){this._deviceOrientationTracker.getOrientation(this._deviceOrientation),this._devicePosition.set(this._headPose.poseModelMatrix[12],this._headPose.poseModelMatrix[13],this._headPose.poseModelMatrix[14]),this._devicePosition.add(0,XRViewPose.SITTING_EYE_HEIGHT,0),m.default.mat4_fromRotationTranslation(this._deviceWorldMatrix,this._deviceOrientation.toArray(),this._devicePosition.toArray()),this._headPose._setPoseModelMatrix(this._deviceWorldMatrix),this._eyeLevelPose._position=this._devicePosition.toArray()}},{key:"_handleARKitUpdate",value:function(){var e=this._arKitWrapper.getData("camera_transform");e?(this._headPose._setPoseModelMatrix(e),this._headPose._poseModelMatrix[13]+=XRViewPose.SITTING_EYE_HEIGHT,this._eyeLevelPose._position=this._headPose._position):console.log("no camera transform",this._arKitWrapper.rawARData);var t=this._arKitWrapper.getData("projection_camera");t?this._views[0].setProjectionMatrix(t):console.log("no projection camera",this._arKitWrapper.rawARData)}},{key:"_handleARKitInit",value:function(e){var t=this;setTimeout(function(){t._arKitWrapper.watch({location:!0,camera:!0,objects:!0,light_intensity:!0})},1e3)}},{key:"_createSession",value:function(e){return this._start(),c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_createSession",this).call(this,e)}},{key:"_supportedCreationParameters",value:function(e){return e.type===p.default.AUGMENTATION&&!1===e.exclusive}}]),t}(h.default);t.default=A},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(){function e(t,i,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.DefaultOrder;n(this,e),this.x=t,this.y=i,this.z=r,this.order=o}return r(e,[{key:"set",value:function(t,i,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.DefaultOrder;this.x=t,this.y=i,this.z=n,this.order=r}},{key:"toArray",value:function(){return[this.x,this.y,this.z]}}]),e}();t.default=o,o.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],o.DefaultOrder="XYZ"},function(e,t,i){function r(e){return e&&e.__esModule?e:{default:e}}function o(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":n(t))&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":n(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),c=i(4),d=r(c),h=i(7),f=r(h),y=i(6),_=r(y),p=i(8),v=(r(p),i(0)),m=r(v),w=i(1),g=r(w),E=i(9),b=r(E),M=i(14),T=(r(M),i(10)),x=(r(T),function(e){function t(e,i,n){a(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n.displayName,n.capabilities.hasExternalDisplay,i));return r._vrDisplay=n,r._vrFrameData=new VRFrameData,r._leftView=new f.default(r._fov,r._depthNear,r._depthFar,f.default.LEFT),r._rightView=new f.default(r._fov,r._depthNear,r._depthFar,f.default.RIGHT),r._views=[r._leftView,r._rightView],r._deviceOrientation=new g.default,r._devicePosition=new b.default,r._deviceWorldMatrix=new Float32Array(16),r}return u(t,e),l(t,[{key:"_requestAnimationFrame",value:function(e){this._vrDisplay.isPresenting?this._vrDisplay.requestAnimationFrame(e):window.requestAnimationFrame(e)}},{key:"_handleNewBaseLayer",value:function(e){var t=this;this._vrDisplay.requestPresent([{source:e._context.canvas}]).then(function(){var i=t._vrDisplay.getEyeParameters("left"),n=t._vrDisplay.getEyeParameters("right");e.framebufferWidth=2*Math.max(i.renderWidth,n.renderWidth),e.framebufferHeight=Math.max(i.renderHeight,n.renderHeight),e._context.canvas.style.position="absolute",e._context.canvas.style.bottom="1px",e._context.canvas.style.right="1px",e._context.canvas.style.width="100%",e._context.canvas.style.height="100%",document.body.appendChild(e._context.canvas)}).catch(function(e){console.error("Unable to init WebVR 1.1 display",e)})}},{key:"_stop",value:function(){!1!==this.running&&(this.running=!1,this._reality._stop())}},{key:"_handleNewFrame",value:function(e){this._vrDisplay.isPresenting&&this._updateFromVRFrameData()}},{key:"_handleAfterFrame",value:function(e){this._vrDisplay.isPresenting&&this._vrDisplay.submitFrame()}},{key:"_supportedCreationParameters",value:function(e){return e.type===_.default.REALITY&&!0===e.exclusive}},{key:"_updateFromVRFrameData",value:function(){if(this._vrDisplay.getFrameData(this._vrFrameData),this._leftView.setProjectionMatrix(this._vrFrameData.leftProjectionMatrix),this._rightView.setProjectionMatrix(this._vrFrameData.rightProjectionMatrix),this._vrFrameData.pose){if(this._vrFrameData.pose.orientation){var e;(e=this._deviceOrientation).set.apply(e,o(this._vrFrameData.pose.orientation))}if(this._vrFrameData.pose.position){var t;(t=this._devicePosition).set.apply(t,o(this._vrFrameData.pose.position))}m.default.mat4_fromRotationTranslation(this._deviceWorldMatrix,this._deviceOrientation.toArray(),this._devicePosition.toArray()),this._vrDisplay.stageParameters&&this._vrDisplay.stageParameters.sittingToStandingTransform&&m.default.mat4_multiply(this._deviceWorldMatrix,this._vrDisplay.stageParameters.sittingToStandingTransform,this._deviceWorldMatrix),this._headPose._setPoseModelMatrix(this._deviceWorldMatrix),this._eyeLevelPose.position=this._devicePosition.toArray()}}}]),t}(d.default));t.default=x},function(e,t,i){function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":n(t))&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":n(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=i(5),c=r(l),d=i(3),h=r(d),f=i(8),y=r(f),_=i(11),p=r(_),v=i(0),m=r(v),w=i(1),g=r(w),E=i(10),b=r(E),M=i(31),T=r(M),x=function(e){function t(e){o(this,t);var i=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Camera",!0,!0));return i._initialized=!1,i._running=!1,i._arKitWrapper=null,i._mediaStream=null,i._videoEl=null,i._arCoreCameraRenderer=null,i._arCoreCanvas=null,i._elContext=null,i._vrDisplay=null,i._vrFrameData=null,"function"==typeof navigator.getVRDisplays&&navigator.getVRDisplays().then(function(e){var t=!0,n=!1,r=void 0;try{for(var o,a=e[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var s=o.value;if(null!==s&&s.capabilities.hasPassThroughCamera){if(i._vrDisplay=s,i._vrFrameData=new VRFrameData,i._arCoreCanvas=document.createElement("canvas"),i._xr._realityEls.appendChild(i._arCoreCanvas),i._arCoreCanvas.width=window.innerWidth,i._arCoreCanvas.height=window.innerHeight,i._elContext=i._arCoreCanvas.getContext("webgl"),null===i._elContext)throw"Could not create CameraReality GL context";break}}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}}),window.addEventListener("resize",function(){i._arCoreCanvas&&(i._arCoreCanvas.width=window.innerWidth,i._arCoreCanvas.height=window.innerHeight)},!1),i}return s(t,e),u(t,[{key:"_handleNewFrame",value:function(e){this._arCoreCameraRenderer&&(this._arCoreCameraRenderer.render(),this._vrDisplay.getFrameData(this._vrFrameData))}},{key:"_start",value:function(){var e=this;this._running||(this._running=!0,null!==this._vrDisplay?(this._arCoreCameraRenderer=new T.default(this._vrDisplay,this._elContext),this._initialized=!0):b.default.HasARKit()?!1===this._initialized?(this._initialized=!0,this._arKitWrapper=b.default.GetOrCreate(),this._arKitWrapper.addEventListener(b.default.WATCH_EVENT,this._handleARKitWatch.bind(this)),this._arKitWrapper.waitForInit().then(function(){e._arKitWrapper.watch()})):this._arKitWrapper.watch():!1===this._initialized?(this._initialized=!0,navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment"}}).then(function(t){e._videoEl=document.createElement("video"),e._xr._realityEls.appendChild(e._videoEl),e._videoEl.setAttribute("class","camera-reality-video"),e._videoEl.setAttribute("playsinline",!0),e._videoEl.style.width="100%",e._videoEl.style.height="100%",e._videoEl.srcObject=t,e._videoEl.play()}).catch(function(t){console.error("Could not set up video stream",t),e._initialized=!1,e._running=!1})):(this._xr._realityEls.appendChild(this._videoEl),this._videoEl.play()))}},{key:"_stop",value:function(){if(!1!==this._running)if(this._running=!1,b.default.HasARKit()){if(null===this._arKitWrapper)return;this._arKitWrapper.stop()}else this._arCoreCanvas?(this._xr._realityEls.removeChild(this._arCoreCanvas),this._arCoreCanvas=null):null!==this._videoEl&&(this._videoEl.pause(),this._xr._realityEls.removeChild(this._videoEl))}},{key:"_handleARKitWatch",value:function(e){if(e.detail&&e.detail.objects){var t=!0,i=!1,n=void 0;try{for(var r,o=e.detail.objects[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a=r.value;this._updateAnchorFromARKitUpdate(a.uuid,a)}}catch(e){i=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(i)throw n}}}}},{key:"_handleARKitAddObject",value:function(e){this._updateAnchorFromARKitUpdate(e.uuid,e)}},{key:"_updateAnchorFromARKitUpdate",value:function(e,t){var i=this._anchors.get(e)||null;if(null===i)return void console.log("unknown anchor",i);i.coordinateSystem._relativeMatrix=t.transform}},{key:"_addAnchor",value:function(e,t){var i=this;return null!==this._arKitWrapper&&this._arKitWrapper.addAnchor(e.uid,e.coordinateSystem._poseModelMatrix).then(function(e){return i._handleARKitAddObject(e)}),this._anchors.set(e.uid,e),e.uid}},{key:"_findAnchor",value:function(e,t,i){var n=this;return new Promise(function(r,o){if(null!==n._arKitWrapper)n._arKitWrapper.hitTest(e,t,b.default.HIT_TEST_TYPE_EXISTING_PLANES).then(function(e){if(0===e.length)return r(null),void console.log("miss");var t=n._pickARKitHit(e);t.anchor_transform[13]+=y.default.SITTING_EYE_HEIGHT,t.world_transform[13]+=y.default.SITTING_EYE_HEIGHT;var o=n._getAnchor(t.uuid);if(null===o){var a=new XRCoordinateSystem(i,XRCoordinateSystem.TRACKER);a._relativeMatrix=t.anchor_transform,o=new h.default(a,t.uuid),n._anchors.set(o.uid,o)}var s=[t.world_transform[12]-t.anchor_transform[12],t.world_transform[13]-t.anchor_transform[13],t.world_transform[14]-t.anchor_transform[14]],u=(new g.default).setFromRotationMatrix(t.world_transform),l=(new g.default).setFromRotationMatrix(t.anchor_transform).inverse(),c=(new g.default).multiplyQuaternions(u,l),d=new p.default(o.uid);d.poseMatrix=m.default.mat4_fromRotationTranslation(new Float32Array(16),c.toArray(),s),r(d)});else if(null!==n._vrDisplay){var a=n._vrDisplay.hitTest(e,t);if(0==a.length)return void r(null);a.sort(function(e,t){return e.distance-t.distance});var s=n._getAnchor(a[0].uuid);if(null===s){var u=new XRCoordinateSystem(i,XRCoordinateSystem.TRACKER);u._relativeMatrix=a[0].modelMatrix,u._relativeMatrix[13]+=y.default.SITTING_EYE_HEIGHT,s=new h.default(u),n._anchors.set(s.uid,s)}r(new p.default(s.uid))}else r(null)})}},{key:"_removeAnchor",value:function(e){this._anchors.delete(e)}},{key:"_pickARKitHit",value:function(e){if(0===e.length)return null;var t=null,i=e.filter(function(e){return e.type!=b.default.HIT_TEST_TYPE_FEATURE_POINT}),n=i.filter(function(e){return e.type==b.default.HIT_TEST_TYPE_EXISTING_PLANE_USING_EXTENT}),r=i.filter(function(e){return e.type==b.default.HIT_TEST_TYPE_EXISTING_PLANE});return n.length?(n=n.sort(function(e,t){return e.distance-t.distance}),t=n[0]):r.length?(r=r.sort(function(e,t){return e.distance-t.distance}),t=r[0]):i.length?(i=i.sort(function(e,t){return e.distance-t.distance}),t=i[0]):t=e[0],t}}]),t}(c.default);t.default=x},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t,i){if("fragment"==i)var n=e.createShader(e.FRAGMENT_SHADER);else{if("vertex"!=i)return null;var n=e.createShader(e.VERTEX_SHADER)}return e.shaderSource(n,t),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)?n:(console.error(e.getShaderInfoLog(n)),null)}function o(e,t,i){var n=r(e,t,"vertex"),o=r(e,i,"fragment");if(!o)return null;var a=e.createProgram();return e.attachShader(a,n),e.attachShader(a,o),e.linkProgram(a),e.getProgramParameter(a,e.LINK_STATUS)||console.error("Could not initialise arview shaders"),a}function a(e,t){var i=0;switch(t){case 90:i=1;break;case 180:i=2;break;case 270:i=3;break;default:i=0}var n=0;switch(e){case 90:n=1;break;case 180:n=2;break;case 270:n=3;break;default:n=0}var r=n-i;return r<0&&(r+=4),r%4}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),u="#extension GL_OES_EGL_image_external : require\n\nprecision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform samplerExternalOES uSampler;\n\nvoid main(void) {\n  gl_FragColor = texture2D(uSampler, vTextureCoord);\n}",l="attribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void) {\n  gl_Position = vec4(aVertexPosition, 1.0);\n  vTextureCoord = aTextureCoord;\n}",c=function(){function e(t,i){n(this,e),this.vrDisplay=t,this.gl=i,this.passThroughCamera=t.getPassThroughCamera(),this.program=o(i,l,u),i.useProgram(this.program),this.vertexPositionAttribute=i.getAttribLocation(this.program,"aVertexPosition"),this.textureCoordAttribute=i.getAttribLocation(this.program,"aTextureCoord"),this.samplerUniform=i.getUniformLocation(this.program,"uSampler"),this.vertexPositionBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.vertexPositionBuffer);var r=[-1,1,0,-1,-1,0,1,1,0,1,-1,0],s=new Float32Array(r);i.bufferData(i.ARRAY_BUFFER,s,i.STATIC_DRAW),this.vertexPositionBuffer.itemSize=3,this.vertexPositionBuffer.numItems=12,this.textureCoordBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.textureCoordBuffer);var c=null;if(this.vrDisplay){var d=this.passThroughCamera.width/this.passThroughCamera.textureWidth,h=this.passThroughCamera.height/this.passThroughCamera.textureHeight;c=[[0,0,0,h,d,0,d,h],[d,0,0,0,d,h,0,h],[d,h,d,0,0,h,0,0],[0,h,d,h,0,0,d,0]]}else c=[[0,0,0,1,1,0,1,1],[1,0,0,0,1,1,0,1],[1,1,1,0,0,1,0,0],[0,1,1,1,0,0,1,0]];this.f32TextureCoords=[];for(var f=0;f<c.length;f++)this.f32TextureCoords.push(new Float32Array(c[f]));this.combinedOrientation=a(screen.orientation.angle,this.passThroughCamera.orientation),i.bufferData(i.ARRAY_BUFFER,this.f32TextureCoords[this.combinedOrientation],i.STATIC_DRAW),this.textureCoordBuffer.itemSize=2,this.textureCoordBuffer.numItems=8,i.bindBuffer(i.ARRAY_BUFFER,null),this.indexBuffer=i.createBuffer(),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var y=[0,1,2,2,1,3],_=new Uint16Array(y);return i.bufferData(i.ELEMENT_ARRAY_BUFFER,_,i.STATIC_DRAW),this.indexBuffer.itemSize=1,this.indexBuffer.numItems=6,i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null),this.texture=i.createTexture(),i.useProgram(null),this.projectionMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.mvMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this}return s(e,[{key:"render",value:function(){var e=this.gl;e.useProgram(this.program),e.bindBuffer(e.ARRAY_BUFFER,this.vertexPositionBuffer),e.enableVertexAttribArray(this.vertexPositionAttribute),e.vertexAttribPointer(this.vertexPositionAttribute,this.vertexPositionBuffer.itemSize,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.textureCoordBuffer);var t=a(screen.orientation.angle,this.passThroughCamera.orientation);t!==this.combinedOrientation&&(this.combinedOrientation=t,e.bufferData(e.ARRAY_BUFFER,this.f32TextureCoords[this.combinedOrientation],e.STATIC_DRAW)),e.enableVertexAttribArray(this.textureCoordAttribute),e.vertexAttribPointer(this.textureCoordAttribute,this.textureCoordBuffer.itemSize,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_EXTERNAL_OES,this.texture),e.texImage2D(e.TEXTURE_EXTERNAL_OES,0,e.RGB,e.RGB,e.UNSIGNED_BYTE,this.passThroughCamera),e.uniform1i(this.samplerUniform,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.drawElements(e.TRIANGLES,this.indexBuffer.numItems,e.UNSIGNED_SHORT,0),e.bindTexture(e.TEXTURE_EXTERNAL_OES,null),e.disableVertexAttribArray(this.vertexPositionAttribute),e.disableVertexAttribArray(this.textureCoordAttribute),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.useProgram(null)}}]),e}(),d=function(){function e(t,i){n(this,e),this.vrDisplay=t,this.gl=i,this.videoRenderer=new c(t,this.gl),this.width=window.innerWidth,this.height=window.innerHeight,window.addEventListener("resize",this.onWindowResize.bind(this),!1)}return s(e,[{key:"onWindowResize",value:function(){this.width=window.innerWidth,this.height=window.innerHeight}},{key:"render",value:function(){var e=this.gl,t=1*this.width,i=1*this.height;e.viewportWidth!==t&&(e.viewportWidth=t),e.viewportHeight!==i&&(e.viewportHeight=i),this.gl.viewport(0,0,e.viewportWidth,e.viewportHeight),this.videoRenderer.render()}}]),e}();t.default=d}])}])},function(e,t,i){"use strict";AFRAME.registerSystem("xr",{schema:{AR_AUTOSTART:{default:!0}},init:function(){this.sceneEl.setAttribute("vr-mode-ui",{enabled:!1}),this.bindMethods(),this.sceneEl.addEventListener("loaded",this.wrapSceneMethods)},bindMethods:function(){this.updateFrame=this.updateFrame.bind(this),this.sessionStarted=this.sessionStarted.bind(this),this.sessionEnded=this.sessionEnded.bind(this),this.poseLost=this.poseLost.bind(this),this.poseFound=this.poseFound.bind(this),this.wrapSceneMethods=this.wrapSceneMethods.bind(this)},wrapSceneMethods:function(){var e=this.sceneEl;e._enterVR=e.enterVR,e._exitVR=e.exitVR,e._resize=e.resize,e._render=e.render;var t=this;e.enterAR=function(){this.renderer.xr.startSession(t.lastARDisplay,"ar")},e.exitAR=function(){this.renderer.xr.endSession()},e.enterVR=function(i){!this.renderer.xr.sessionActive&&t.lastVRDisplay?this.renderer.xr.startSession(t.lastVRDisplay,"vr"):e._enterVR(i)},e.exitVR=function(){this.renderer.xr.sessionActive&&this.renderer.xr.endSession(),e._exitVR()},e.resize=function(){if(this.renderer.xr&&!this.renderer.xr.sessionActive){var e=this.camera,t={width:window.innerWidth,height:window.innerHeight};e.aspect=t.width/t.height,e.updateProjectionMatrix()}},e.render=function(){var e=1e3*this.clock.getDelta(),t=this.renderer;this.time=1e3*this.clock.elapsedTime,this.isPlaying&&this.tick(this.time,e),t.animate(this.render.bind(this)),this.renderer.xr&&(!this.renderer.xr.session||this.renderer.xr.session&&!this.renderer.xr.sessionActive)&&(t.setSize(window.innerWidth,window.innerHeight),t.render(this.object3D,this.camera,this.renderTarget)),this.isPlaying&&this.tock(this.time,e)},this.posePosition=new THREE.Vector3,this.poseQuaternion=new THREE.Quaternion,this.poseEuler=new THREE.Euler(0,0,0,"YXZ"),this.poseRotation=new THREE.Vector3,this.poseIsLost=!0,this.activeRealityType="magicWindow",this.el.camera?this.cameraActivated():this.el.addEventListener("camera-set-active",function(e){t.cameraActivated()})},cameraActivated:function(){this.defaultPosition=new THREE.Vector3(0,1.6,.1),this.el.camera.el.setAttribute("position",this.defaultPosition);var e=this;this.el.emit("realityChanged","magicWindow"),THREE.WebXRUtils.getDisplays().then(e.initXR.bind(e))},initXR:function(e){var t=this.sceneEl;t.renderer.autoClear=!1,this.supportAR=!1;for(var i=0;i<e.length;i++){e[i].supportedRealities.ar&&(this.supportAR=!0)}this.el.emit("xrInitialized"),document.documentElement.style.backgroundColor="transparent",document.body.style.backgroundColor="transparent";var n={AR_AUTOSTART:this.data.AR_AUTOSTART};t.renderer.xr=new THREE.WebXRManager(n,e,t.renderer,t.camera,t.object3D,this.updateFrame),t.renderer.xr.addEventListener("sessionStarted",this.sessionStarted),t.renderer.xr.addEventListener("sessionEnded",this.sessionEnded),t.renderer.xr.addEventListener("poseLost",this.poseLost),t.renderer.xr.addEventListener("poseFound",this.poseFound),0===t.renderer.xr.totalSupportedDisplays?this.sceneEl.setAttribute("vr-mode-ui",{enabled:!0}):t.renderer.xr.autoStarted||this.addEnterButtons(e)},addEnterButtons:function(e){for(var t=0;t<e.length;t++){var i=e[t];i.supportedRealities.vr&&(this.lastVRDisplay=i,this.sceneEl.setAttribute("vr-mode-ui",{enabled:!0})),i.supportedRealities.ar&&(this.lastARDisplay=i,this.sceneEl.setAttribute("ar-mode-ui",{enabled:!0}))}},sessionStarted:function(e){this.activeRealityType=e.session.realityType,this.el.emit("realityChanged",this.activeRealityType)},sessionEnded:function(e){this.activeRealityType="magicWindow",this.el.emit("realityChanged",this.activeRealityType)},poseLost:function(){this.el.emit("poseLost")},poseFound:function(){this.el.emit("poseFound")},updateFrame:function(e){this.el.emit("updateFrame",e)}})},function(e,t,i){"use strict";function n(e){var t;return t=document.createElement("button"),t.className=o,t.setAttribute("title","Enter AR mode."),t.setAttribute("aframe-injected",""),t.addEventListener("click",function(t){document.getElementsByClassName(o)[0].style.display="none",document.getElementsByClassName(a)[0].style.display="inline-block",e()}),t}function r(e){var t;return t=document.createElement("button"),t.className=a,t.setAttribute("title","Exit AR mode."),t.setAttribute("aframe-injected",""),t.addEventListener("click",function(t){document.getElementsByClassName(o)[0].style.display="inline-block",document.getElementsByClassName(a)[0].style.display="none",e()}),t}var o="a-enter-ar-button",a="a-exit-ar-button";AFRAME.registerComponent("ar-mode-ui",{dependencies:["canvas"],schema:{enabled:{default:!0}},init:function(){var e=this,t=this.el;if("false"!==AFRAME.utils.getUrlParameter("ui")){var i=document.createElement("style");i.innerHTML=".a-enter-vr {text-align: center;right: 10px;}",i.innerHTML+=".a-enter-vr-button {background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkNhcGFfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHdpZHRoPSIyMDQ4cHgiIGhlaWdodD0iMjA0OHB4IiB2aWV3Qm94PSIwIDAgMjA0OCAyMDQ4IiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAyMDQ4IDIwNDgiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPHRpdGxlPm1hc2s8L3RpdGxlPg0KPGc+DQoJPHJlY3QgeD0iMTQ0LjIzMiIgeT0iNTg3LjI3NiIgZmlsbD0ibm9uZSIgd2lkdGg9IjE4NjYuMTg3IiBoZWlnaHQ9IjEzNDEuMTM0Ii8+DQoJPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTc4MS42NjksNTg2LjU4OWgxOTguNzk3bC0zMTQuMTI1LDkyMUg0ODUuNzAxbC0zMTEuODEyLTkyMWgyMDUuNjU2bDIwMC4xODgsNjk5LjE4OEw3ODEuNjY5LDU4Ni41ODl6Ii8+DQoJPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTE2ODYuMjc5LDYxMC4zMjRjMzMuOTM4LDE0LjU3OCw2Mi43MDMsMzYuMDMxLDg2LjI4MSw2NC4zNDRjMTkuNTE2LDIzLjMyOCwzNC45NjksNDkuMTU2LDQ2LjM0NCw3Ny40NjkNCgkJczE3LjA3OCw2MC41OTQsMTcuMDc4LDk2LjgxMmMwLDQzLjcxOS0xMS4wNDcsODYuNzE5LTMzLjE0MSwxMjguOTg0Yy0yMi4wOTQsNDIuMjgxLTU4LjU0Nyw3Mi4xNTctMTA5LjM5MSw4OS42NDENCgkJYzQyLjM3NSwxNy4xMjUsNzIuMzkxLDQxLjQzOCw5MC4wNDcsNzIuOTUzYzE3LjY1NiwzMS41MzEsMjYuNDg0LDc5LjU2MiwyNi40ODQsMTQ0LjA5NHY2MS44MjgNCgkJYzAsNDIuMDYyLDEuNzAzLDcwLjU3OCw1LjEyNSw4NS41NjJjNS4xMjUsMjMuNzUsMTcuMDc4LDQxLjIzNCwzNS44NzUsNTIuNDY5djIzLjEwOWgtMjEyLjMyOA0KCQljLTUuNzgxLTIwLjQwNi05LjkwNi0zNi44NDQtMTIuMzc1LTQ5LjM0NGMtNC45NjktMjUuODEyLTcuNjU2LTUyLjI1LTguMDYyLTc5LjMxMmwtMS4yMzQtODUuNTc4DQoJCWMtMC43OTctNTguNzAzLTEwLjk2OS05Ny44NDQtMzAuNTMxLTExNy40MDZzLTU2LjIxOS0yOS4zNTktMTA5Ljk1My0yOS4zNTloLTE4OC41MTZ2MzYxaC0xODh2LTkyMWg0NDAuODc1DQoJCUMxNjAzLjg1Nyw1ODcuODM5LDE2NTIuMzQyLDU5NS43NjEsMTY4Ni4yNzksNjEwLjMyNHogTTEyODcuOTgyLDc0NS41ODl2MjQ4aDIwNy41MzFjNDEuMjE5LDAsNzIuMTQxLTUsOTIuNzY2LTE1LjAzMQ0KCQljMzYuNDY5LTE3LjUzMSw1NC43MDMtNTIuMTcyLDU0LjcwMy0xMDMuOTUzYzAtNTUuOTM4LTE3LjY0MS05My41MTYtNTIuOTIyLTExMi43MzRjLTE5LjgyOC0xMC44NDQtNDkuNTYyLTE2LjI4MS04OS4yMDMtMTYuMjgxDQoJCUgxMjg3Ljk4MnoiLz4NCjwvZz4NCjwvc3ZnPg0K) 50% 50%/70% 70% no-repeat rgba(0,0,0,.35);",i.innerHTML+="position: relative;",i.innerHTML+="margin-right: 10px;",i.innerHTML+="}",i.innerHTML+=".a-enter-ar-button {background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkNhcGFfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHdpZHRoPSIyMDQ4cHgiIGhlaWdodD0iMjA0OHB4IiB2aWV3Qm94PSIwIDAgMjA0OCAyMDQ4IiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAyMDQ4IDIwNDgiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPHRpdGxlPm1hc2s8L3RpdGxlPg0KPGc+DQoJPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTQzOS45NzIsNTg0LjgzNWgyMTcuNjI1bDMyNS4zNDUsOTIxaC0yMDguNzJsLTYwLjU3Ny0xODloLTMzOS4yNWwtNjIuNDIzLDE4OWgtMjAxLjExTDQzOS45NzIsNTg0LjgzNXoNCgkJIE00MjYuODc4LDExNTcuODM1aDIzNS44MTJMNTQ2LjU1LDc5NS4zOTZMNDI2Ljg3OCwxMTU3LjgzNXoiLz4NCgk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMTY5MC43MjMsNjA4LjU2OWMzMy45MzgsMTQuNTc3LDYyLjcwMiwzNi4wMyw4Ni4yOCw2NC4zNDRjMTkuNTE3LDIzLjMyOCwzNC45Nyw0OS4xNTYsNDYuMzQ1LDc3LjQ2OQ0KCQljMTEuMzc1LDI4LjMxMywxNy4wNzcsNjAuNTk0LDE3LjA3Nyw5Ni44MTJjMCw0My43MTktMTEuMDQ3LDg2LjcxOS0zMy4xNDEsMTI4Ljk4M2MtMjIuMDk1LDQyLjI4MS01OC41NDcsNzIuMTU2LTEwOS4zOTIsODkuNjQyDQoJCWM0Mi4zNzUsMTcuMTI1LDcyLjM5Miw0MS40MzgsOTAuMDQ3LDcyLjk1MmMxNy42NTYsMzEuNTMxLDI2LjQ4NCw3OS41NjIsMjYuNDg0LDE0NC4wOTV2NjEuODI4DQoJCWMwLDQyLjA2MiwxLjcwMyw3MC41NzcsNS4xMjUsODUuNTYyYzUuMTI1LDIzLjc1LDE3LjA3OCw0MS4yMzQsMzUuODc1LDUyLjQ2OXYyMy4xMDloLTIxMi4zMjgNCgkJYy01Ljc4MS0yMC40MDYtOS45MDYtMzYuODQ0LTEyLjM3NS00OS4zNDRjLTQuOTY5LTI1LjgxMi03LjY1Ni01Mi4yNS04LjA2Mi03OS4zMTJsLTEuMjM0LTg1LjU3OA0KCQljLTAuNzk3LTU4LjcwMy0xMC45NjktOTcuODQ0LTMwLjUzLTExNy40MDVjLTE5LjU2Mi0xOS41NjItNTYuMjItMjkuMzU5LTEwOS45NTMtMjkuMzU5aC0xODguNTE3djM2MWgtMTg4di05MjFIMTU0NS4zDQoJCUMxNjA4LjMsNTg2LjA4NSwxNjU2Ljc4NCw1OTQuMDA3LDE2OTAuNzIzLDYwOC41Njl6IE0xMjkyLjQyNSw3NDMuODM1djI0OGgyMDcuNTMxYzQxLjIxOSwwLDcyLjE0Mi01LDkyLjc2Ny0xNS4wMzENCgkJYzM2LjQ2OS0xNy41Myw1NC43MDItNTIuMTcyLDU0LjcwMi0xMDMuOTUzYzAtNTUuOTM4LTE3LjY0MS05My41MTYtNTIuOTIyLTExMi43MzNjLTE5LjgyOC0xMC44NDQtNDkuNTYyLTE2LjI4MS04OS4yMDMtMTYuMjgxDQoJCUwxMjkyLjQyNSw3NDMuODM1TDEyOTIuNDI1LDc0My44MzV6Ii8+DQo8L2c+DQo8L3N2Zz4NCg==) 50% 50%/70% 70% no-repeat rgba(0,0,0,.35);",i.innerHTML+="border: 0;",i.innerHTML+="bottom: 0;",i.innerHTML+="cursor: pointer;",i.innerHTML+="min-width: 50px;",i.innerHTML+="min-height: 30px;",i.innerHTML+="padding-right: 5%;",i.innerHTML+="padding-top: 4%;",i.innerHTML+="transition: background-color .05s ease;",i.innerHTML+="-webkit-transition: background-color .05s ease;",i.innerHTML+="z-index: 9999;",i.innerHTML+="margin-right: 10px;}",i.innerHTML+=".a-enter-ar-button:active,.a-enter-ar-button:hover { background-color: #666;",i.innerHTML+="}",i.innerHTML+=".a-exit-ar-button {background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkNhcGFfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHdpZHRoPSIyMDQ4cHgiIGhlaWdodD0iMjA0OHB4IiB2aWV3Qm94PSIwIDAgMjA0OCAyMDQ4IiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAyMDQ4IDIwNDgiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPHRpdGxlPm1hc2s8L3RpdGxlPg0KPHJlY3QgeD0iNTYxLjI3MyIgeT0iNTg0LjgzNiIgZmlsbD0ibm9uZSIgd2lkdGg9IjEzODMuMTM5IiBoZWlnaHQ9IjEzODMuMTM5Ii8+DQo8ZyBlbmFibGUtYmFja2dyb3VuZD0ibmV3ICAgICI+DQoJPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTgwNi41MDgsMTUwNS4xNDhINTgyLjc3NGwyOTYuMDE2LTQ2OS4yNWwtMjgyLjAxNi00NTEuNzVoMjMwLjA0N2wxNjQuNDM4LDMwMC4wMTZsMTY4Ljk2OC0zMDAuMDE2DQoJCWgyMjIuNTQ3bC0yODIuMDE2LDQ0NC4yNWwzMDAuMDE2LDQ3Ni43NWgtMjMzLjg5MWwtMTc1LjUzMS0zMTQuMTU2TDgwNi41MDgsMTUwNS4xNDh6Ii8+DQo8L2c+DQo8L3N2Zz4NCg==) 50% 50%/70% 70% no-repeat rgba(0,0,0,.35);",i.innerHTML+="border: 0;",i.innerHTML+="bottom: 0;",i.innerHTML+="cursor: pointer;",i.innerHTML+="min-width: 30px;",i.innerHTML+="min-height: 30px;",i.innerHTML+="padding-right: 5%;",i.innerHTML+="padding-top: 4%;",i.innerHTML+="transition: background-color .05s ease;",i.innerHTML+="-webkit-transition: background-color .05s ease;",i.innerHTML+="z-index: 9999;",i.innerHTML+="display: none;",i.innerHTML+="margin-right: 10px;}",i.innerHTML+=".a-exit-ar-button:active,.a-exit-ar-button:hover { background-color: #666;",i.innerHTML+="}",document.body.appendChild(i),this.enterAR=t.enterAR.bind(t),this.exitAR=t.exitAR.bind(t),this.insideLoader=!1,this.enterAREl=null,t.addEventListener("enter-vr",this.updateEnterARInterface.bind(this)),t.addEventListener("exit-vr",this.updateEnterARInterface.bind(this)),window.addEventListener("message",function(t){"loaderReady"===t.data.type&&(e.insideLoader=!0,e.remove())})}},update:function(){var e=this.el;if(!this.data.enabled||this.insideLoader||"false"===AFRAME.utils.getUrlParameter("ui"))return this.remove();if(!this.enterAREl){if(this.enterAREl=n(this.enterAR),this.exitAREl=r(this.exitAR),!document.getElementsByClassName("a-enter-vr")[0]){var t=document.createElement("div");t.classList.add("a-enter-vr"),t.setAttribute("aframe-injected",""),e.appendChild(t)}document.getElementsByClassName("a-enter-vr")[0].appendChild(this.enterAREl),document.getElementsByClassName("a-enter-vr")[0].appendChild(this.exitAREl),this.updateEnterARInterface()}},remove:function(){[this.enterAREl].forEach(function(e){e&&e.parentNode.removeChild(e)})},updateEnterARInterface:function(){this.toggleEnterARButtonIfNeeded()},toggleEnterARButtonIfNeeded:function(){var e=this.el;this.enterAREl&&(e.is("vr-mode")?(this.enterAREl.classList.add("a-hidden"),this.exitAREl.classList.add("a-hidden")):(this.enterAREl.classList.remove("a-hidden"),this.exitAREl.classList.remove("a-hidden")))}})},function(e,t,i){"use strict";AFRAME.registerComponent("xr",{schema:{vr:{default:!0},ar:{default:!0},magicWindow:{default:!0}},init:function(){this.realityChanged=this.realityChanged.bind(this),this.el.sceneEl.addEventListener("realityChanged",this.realityChanged),this.originalVisibility=this.el.getAttribute("visible")},update:function(){this.originalVisibility=this.el.getAttribute("visible"),this.el.setAttribute("visible",this.newVisibility)},realityChanged:function(e){void 0!==this.data[e.detail]&&(this.data[e.detail]?this.newVisibility=this.originalVisibility:this.newVisibility=!1,this.el.setAttribute("visible",this.newVisibility))}})},function(e,t,i){"use strict";AFRAME.registerComponent("xranchor",{init:function(){this.anchorMatrix=new THREE.Matrix4,this.positionVec3=new THREE.Vector3,this.rotationQuat=new THREE.Quaternion,this.rotationVec3=new THREE.Vector3,this.el.sceneEl.addEventListener("updateFrame",this.updateFrame.bind(this))},updateFrame:function(e){var t=e.detail,i=this.anchorOffset;if(i){var n=t.getAnchor(i.anchorUID);if(null!==n){var r=this.anchorMatrix.fromArray(i.getOffsetTransform(n.coordinateSystem)),o=this.positionVec3.setFromMatrixPosition(r);this.el.setAttribute("position",{x:o.x,y:o.y,z:o.z});var a=this.rotationQuat.setFromRotationMatrix(r),s=this.rotationVec3.applyQuaternion(a);this.el.setAttribute("rotation",{x:s.x,y:s.y,z:s.z})}}}})}]);