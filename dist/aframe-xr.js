!function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,n){"use strict";n(1),n(2),n(3),n(4),n(5),n(6)},function(t,e){!function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.WebXRUtils=e.WebXRManager=void 0;var i=n(1),a=r(i),o=n(2),s=r(o);n(3),e.WebXRManager=a.default,e.WebXRUtils=s.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),THREE.WebXRManager=function(){function t(t){this.sessionActive&&this.session.requestFrame(u);var e=t.getDisplayPose(t.getCoordinateSystem(XRCoordinateSystem.HEAD_MODEL));if(0===e._orientation[0]&&0===e._orientation[1]&&0===e._orientation[2]&&1===e._orientation[3]?this.poseFound&&(this.dispatchEvent({type:"poseLost"}),this.poseFound=!1):this.poseFound||(this.dispatchEvent({type:"poseFound"}),this.poseFound=!0),this.updateScene(o,t),this.renderer.autoClear=!1,this.renderer.setSize(this.session.baseLayer.framebufferWidth,this.session.baseLayer.framebufferHeight,!1),this.renderer.clear(),this.sessionActive)for(var n=0;n<t.views.length;n++){var r=t.views[n];this.camera.projectionMatrix.fromArray(r.projectionMatrix),this.camera.parent&&"Scene"!==this.camera.parent.type?(this.camera.parent.matrixAutoUpdate=!1,this.camera.parent.matrix.fromArray(e.poseModelMatrix),this.camera.parent.updateMatrixWorld(!0)):(this.camera.matrixAutoUpdate=!1,this.camera.matrix.fromArray(e.poseModelMatrix),this.camera.updateMatrixWorld(!0)),this.renderer.clearDepth();var i=r.getViewport(this.session.baseLayer);this.renderer.setViewport(i.x,i.y,i.width,i.height),this.doRender()}else this.camera.parent&&"Scene"!==this.camera.parent.type?(this.camera.parent.matrixAutoUpdate=!1,this.camera.parent.matrix=new THREE.Matrix4,this.camera.parent.updateMatrixWorld(!0)):(this.camera.matrix=new THREE.Matrix4,this.camera.updateMatrixWorld(!0)),this.renderer.clearDepth(),this.renderer.setViewport(0,0,window.innerWidth,window.innerHeight),this.doRender()}var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1],r=arguments[2],i=arguments[3],a=arguments[4],o=arguments[5],s={AR_AUTOSTART:!0};this.options=Object.assign({},s,e),this.displays=n,this.renderer=r,this.camera=i,this.scene=a;var u=t.bind(this);this.sessions=[],this.session=null,this.autoStarted=!1,this.poseFound=!1,this.startSession=function(t,e){var n=this,i=!1;"vr"===e&&(i=!0);var a={exclusive:i,type:i?XRSession.REALITY:XRSession.AUGMENTATION};this.sessionActive||(null!==this.session&&(this.session.end(),this.session=null),t.requestSession(a).then(function(t){t.realityType=e,t.depthNear=.05,t.depthFar=1e3,t.addEventListener("focus",function(t){n.handleSessionFocus(t)}),t.addEventListener("blur",function(t){n.handleSessionBlur(t)}),t.addEventListener("end",function(t){n.handleSessionEnded(t)}),r.domElement.style.width="100%",r.domElement.style.height="100%",t.baseLayer=new XRWebGLLayer(t,r.context),t.baseLayer.addEventListener("focus",function(t){n.handleLayerFocus(t)}),t.baseLayer.addEventListener("blur",function(t){n.handleLayerBlur(t)}),t.requestFrame(u),n.sessions.push(t),n.session=t,n.sessionActive=!0,n.dispatchEvent({type:"sessionStarted",session:t})}).catch(function(t){console.error("Error requesting session",t)}))},this.endSession=function(){this.session.end(),this.dispatchEvent({type:"sessionEnded",session:this.session}),this.sessionActive=!1,this.session._display._vrDisplay&&this.session._display.isPresenting&&this.session._display._vrDisplay.exitPresent()},this.handleSessionFocus=function(t){console.log("handleSessionFocus")},this.handleSessionBlur=function(t){console.log("handleSessionBlur")},this.handleSessionEnded=function(t){console.log("handleSessionEnded")},this.handleLayerFocus=function(t){console.log("handleLayerFocus")},this.handleLayerBlur=function(t){console.log("handleLayerBlur")};var l,c=0,h=0;this.totalSupportedDisplays=0;for(var d=0;d<this.displays.length;d++){var f=this.displays[d];f.supportedRealities.vr&&c++,f.supportedRealities.ar&&(l=f,h++)}1===h&&0===c&&this.options.AR_AUTOSTART&&(this.autoStarted=!0,this.startSession(l,"ar")),this.totalSupportedDisplays=h+c,this.updateScene=function(t,e){t(e)},this.doRender=function(){this.renderer.render(this.scene,this.camera)}},THREE.WebXRManager.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.WebXRManager.prototype.constructor=THREE.WebXRManager,e.default=THREE.WebXRManager},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),THREE.WebXRUtils={getDisplays:function(){return new Promise(function(t,e){navigator.XR?navigator.XR.getDisplays().then(function(e){function n(){return void 0!==window.orientation||-1!==navigator.userAgent.indexOf("IEMobile")}if(0===e.length)return console.log("No displays are available"),void t(null);var r={exclusive:!1,type:XRSession.AUGMENTATION},i={exclusive:!0,type:XRSession.REALITY},a={vr:!1,ar:!1},o=!0,s=!1,u=void 0;try{for(var l,c=e[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var h=l.value;a={vr:!1,ar:!1},h.supportsSession(r)&&((h._reality._vrDisplay||!n()||function(){return navigator.userAgent.indexOf("AppleWebKit")&&-1===navigator.userAgent.indexOf("Safari")}())&&n()?a.ar=!0:a.ar=!1),h.supportsSession(i)&&-1===h._displayName.indexOf("polyfill")&&(a.vr=!0),h.supportedRealities=a}}catch(t){s=!0,u=t}finally{try{!o&&c.return&&c.return()}finally{if(s)throw u}}t(e)}).catch(function(e){console.error("Error getting XR displays",e),t(null)}):(console.log("WebXR polyfill is not found"),t(null))})}},e.default=THREE.WebXRUtils},function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=17)}([function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=n(1),o=function(t){return t&&t.__esModule?t:{default:t}}(a),s=function(){function t(){r(this,t)}return i(t,null,[{key:"mat4_generateIdentity",value:function(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},{key:"mat4_get_position",value:function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}},{key:"mat4_get_rotation",value:function(t,e){var n=new o.default;return n.setFromRotationMatrix(e),t[0]=n.x,t[1]=n.y,t[2]=n.z,t[3]=n.w,t}},{key:"mat4_eyeView",value:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Float32Array([0,0,0]);t.mat4_translate(e,n,r),t.mat4_invert(e,e)}},{key:"mat4_perspectiveFromFieldOfView",value:function(e,n,r,i){var a=Math.tan(n.upDegrees*t.PI_OVER_180),o=Math.tan(n.downDegrees*t.PI_OVER_180),s=Math.tan(n.leftDegrees*t.PI_OVER_180),u=Math.tan(n.rightDegrees*t.PI_OVER_180),l=2/(s+u),c=2/(a+o);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(s-u)*l*.5,e[9]=(a-o)*c*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e}},{key:"mat4_fromRotationTranslation",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0,1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0],r=e[0],i=e[1],a=e[2],o=e[3],s=r+r,u=i+i,l=a+a,c=r*s,h=r*u,d=r*l,f=i*u,_=i*l,y=a*l,p=o*s,v=o*u,M=o*l;return t[0]=1-(f+y),t[1]=h+M,t[2]=d-v,t[3]=0,t[4]=h-M,t[5]=1-(c+y),t[6]=_+p,t[7]=0,t[8]=d+v,t[9]=_-p,t[10]=1-(c+f),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}},{key:"mat4_translate",value:function(t,e,n){var r=n[0],i=n[1],a=n[2],o=void 0,s=void 0,u=void 0,l=void 0,c=void 0,h=void 0,d=void 0,f=void 0,_=void 0,y=void 0,p=void 0,v=void 0;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*a+e[12],t[13]=e[1]*r+e[5]*i+e[9]*a+e[13],t[14]=e[2]*r+e[6]*i+e[10]*a+e[14],t[15]=e[3]*r+e[7]*i+e[11]*a+e[15]):(o=e[0],s=e[1],u=e[2],l=e[3],c=e[4],h=e[5],d=e[6],f=e[7],_=e[8],y=e[9],p=e[10],v=e[11],t[0]=o,t[1]=s,t[2]=u,t[3]=l,t[4]=c,t[5]=h,t[6]=d,t[7]=f,t[8]=_,t[9]=y,t[10]=p,t[11]=v,t[12]=o*r+c*i+_*a+e[12],t[13]=s*r+h*i+y*a+e[13],t[14]=u*r+d*i+p*a+e[14],t[15]=l*r+f*i+v*a+e[15]),t}},{key:"mat4_invert",value:function(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],d=e[10],f=e[11],_=e[12],y=e[13],p=e[14],v=e[15],M=n*s-r*o,m=n*u-i*o,b=n*l-a*o,w=r*u-i*s,E=r*l-a*s,g=i*l-a*u,T=c*y-h*_,x=c*p-d*_,R=c*v-f*_,A=h*p-d*y,N=h*v-f*y,O=d*v-f*p,L=M*O-m*N+b*A+w*R-E*x+g*T;return L?(L=1/L,t[0]=(s*O-u*N+l*A)*L,t[1]=(i*N-r*O-a*A)*L,t[2]=(y*g-p*E+v*w)*L,t[3]=(d*E-h*g-f*w)*L,t[4]=(u*R-o*O-l*x)*L,t[5]=(n*O-i*R+a*x)*L,t[6]=(p*b-_*g-v*m)*L,t[7]=(c*g-d*b+f*m)*L,t[8]=(o*N-s*R+l*T)*L,t[9]=(r*R-n*N-a*T)*L,t[10]=(_*E-y*b+v*M)*L,t[11]=(h*b-c*E-f*M)*L,t[12]=(s*x-o*A-u*T)*L,t[13]=(n*A-r*x+i*T)*L,t[14]=(y*m-_*w-p*M)*L,t[15]=(c*w-h*m+d*M)*L,t):null}},{key:"mat4_multiply",value:function(t,e,n){var r=e[0],i=e[4],a=e[8],o=e[12],s=e[1],u=e[5],l=e[9],c=e[13],h=e[2],d=e[6],f=e[10],_=e[14],y=e[3],p=e[7],v=e[11],M=e[15],m=n[0],b=n[4],w=n[8],E=n[12],g=n[1],T=n[5],x=n[9],R=n[13],A=n[2],N=n[6],O=n[10],L=n[14],I=n[3],D=n[7],P=n[11],j=n[15];return t[0]=r*m+i*g+a*A+o*I,t[4]=r*b+i*T+a*N+o*D,t[8]=r*w+i*x+a*O+o*P,t[12]=r*E+i*R+a*L+o*j,t[1]=s*m+u*g+l*A+c*I,t[5]=s*b+u*T+l*N+c*D,t[9]=s*w+u*x+l*O+c*P,t[13]=s*E+u*R+l*L+c*j,t[2]=h*m+d*g+f*A+_*I,t[6]=h*b+d*T+f*N+_*D,t[10]=h*w+d*x+f*O+_*P,t[14]=h*E+d*R+f*L+_*j,t[3]=y*m+p*g+v*A+M*I,t[7]=y*b+p*T+v*N+M*D,t[11]=y*w+p*x+v*O+M*P,t[15]=y*E+p*R+v*L+M*j,t}}]),t}();e.default=s,s.PI_OVER_180=Math.PI/180},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;r(this,t),this.x=e,this.y=n,this.z=i,this.w=a}return i(t,[{key:"set",value:function(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this}},{key:"toArray",value:function(){return[this.x,this.y,this.z,this.w]}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}},{key:"setFromRotationMatrix",value:function(t){var e=t[0],n=t[4],r=t[8],i=t[1],a=t[5],o=t[9],s=t[2],u=t[6],l=t[10],c=e+a+l;if(c>0){var h=.5/Math.sqrt(c+1);this.w=.25/h,this.x=(u-o)*h,this.y=(r-s)*h,this.z=(i-n)*h}else if(e>a&&e>l){var d=2*Math.sqrt(1+e-a-l);this.w=(u-o)/d,this.x=.25*d,this.y=(n+i)/d,this.z=(r+s)/d}else if(a>l){var f=2*Math.sqrt(1+a-e-l);this.w=(r-s)/f,this.x=(n+i)/f,this.y=.25*f,this.z=(o+u)/f}else{var _=2*Math.sqrt(1+l-e-a);this.w=(i-n)/_,this.x=(r+s)/_,this.y=(o+u)/_,this.z=.25*_}return this}},{key:"setFromEuler",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"XYZ",i=Math.cos,a=Math.sin,o=i(t/2),s=i(e/2),u=i(n/2),l=a(t/2),c=a(e/2),h=a(n/2);"XYZ"===r?(this.x=l*s*u+o*c*h,this.y=o*c*u-l*s*h,this.z=o*s*h+l*c*u,this.w=o*s*u-l*c*h):"YXZ"===r?(this.x=l*s*u+o*c*h,this.y=o*c*u-l*s*h,this.z=o*s*h-l*c*u,this.w=o*s*u+l*c*h):"ZXY"===r?(this.x=l*s*u-o*c*h,this.y=o*c*u+l*s*h,this.z=o*s*h+l*c*u,this.w=o*s*u-l*c*h):"ZYX"===r?(this.x=l*s*u-o*c*h,this.y=o*c*u+l*s*h,this.z=o*s*h-l*c*u,this.w=o*s*u+l*c*h):"YZX"===r?(this.x=l*s*u+o*c*h,this.y=o*c*u+l*s*h,this.z=o*s*h-l*c*u,this.w=o*s*u-l*c*h):"XZY"===r&&(this.x=l*s*u-o*c*h,this.y=o*c*u-l*s*h,this.z=o*s*h+l*c*u,this.w=o*s*u+l*c*h)}},{key:"setFromAxisAngle",value:function(t,e){var n=e/2,r=Math.sin(n);return this.x=t.x*r,this.y=t.y*r,this.z=t.z*r,this.w=Math.cos(n),this}},{key:"multiply",value:function(t){return this.multiplyQuaternions(this,t)}},{key:"multiplyQuaternions",value:function(t,e){var n=t.x,r=t.y,i=t.z,a=t.w,o=e.x,s=e.y,u=e.z,l=e.w;return this.x=n*l+a*o+r*u-i*s,this.y=r*l+a*s+i*o-n*u,this.z=i*l+a*u+n*s-r*o,this.w=a*l-n*o-r*s-i*u,this}},{key:"inverse",value:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this}},{key:"normalize",value:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===t?(this.x=0,this.y=0,this.z=0,this.w=1):(t=1/t,this.x=this.x*t,this.y=this.y*t,this.z=this.z*t,this.w=this.w*t),this}},{key:"slerp",value:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var n=this.x,r=this.y,i=this.z,a=this.w,o=a*t.w+n*t.x+r*t.y+i*t.z;if(o<0?(this.w=-t.w,this.x=-t.x,this.y=-t.y,this.z=-t.z,o=-o):this.copy(t),o>=1)return this.w=a,this.x=n,this.y=r,this.z=i,this;var s=Math.acos(o),u=Math.sqrt(1-o*o);if(Math.abs(u)<.001)return this.w=.5*(a+this.w),this.x=.5*(n+this.x),this.y=.5*(r+this.y),this.z=.5*(i+this.z),this;var l=Math.sin((1-e)*s)/u,c=Math.sin(e*s)/u;return this.w=a*l+this.w*c,this.x=n*l+this.x*c,this.y=r*l+this.y*c,this.z=i*l+this.z*c,this}}]),t}();e.default=a},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(){r(this,t),this._listeners=new Map}return i(t,[{key:"addEventListener",value:function(t,e){var n=this._listeners.get(t);!1===Array.isArray(n)&&(n=[],this._listeners.set(t,n)),n.push(e)}},{key:"removeEventListener",value:function(t,e){var n=this._listeners.get(t);if(!1!==Array.isArray(n))for(var r=0;r<n.length;r++)if(n[r]===e)return void n.splice(r,1)}},{key:"dispatchEvent",value:function(t){var e=this._listeners.get(t.type);if(!1!==Array.isArray(e)){var n=!0,r=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0)(0,a.value)(t)}catch(t){r=!0,i=t}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}}}}]),t}();e.default=a},function(t,e,n){function r(t){e.ARRAY_TYPE=s=t}function i(t){return t*u}function a(t,e){return Math.abs(t-e)<=o*Math.max(1,Math.abs(t),Math.abs(e))}Object.defineProperty(e,"__esModule",{value:!0}),e.setMatrixArrayType=r,e.toRadian=i,e.equals=a;var o=e.EPSILON=1e-6,s=e.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,u=(e.RANDOM=Math.random,Math.PI/180)},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(e){r(this,t),this._uid=t._generateUID(),this._coordinateSystem=e}return i(t,[{key:"uid",get:function(){return this._uid}},{key:"coordinateSystem",get:function(){return this._coordinateSystem}}],[{key:"_generateUID",value:function(){return"anchor-"+(new Date).getTime()+"-"+Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)}}]),t}();e.default=a},function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":r(e))&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":r(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),l=n(0),c=i(l),h=n(2),d=i(h),f=n(18),_=i(f),y=n(19),p=i(y),v=function(t){function e(t,n,r,i){a(this,e);var s=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return s._xr=t,s._displayName=n,s._isExternal=r,s._reality=i,s._headModelCoordinateSystem=new XRCoordinateSystem(s,XRCoordinateSystem.HEAD_MODEL),s._eyeLevelCoordinateSystem=new XRCoordinateSystem(s,XRCoordinateSystem.EYE_LEVEL),s._trackerCoordinateSystem=new XRCoordinateSystem(s,XRCoordinateSystem.TRACKER),s._headPose=new XRViewPose([0,XRViewPose.SITTING_EYE_HEIGHT,0]),s._eyeLevelPose=new XRViewPose([0,XRViewPose.SITTING_EYE_HEIGHT,0]),s._trackerPoseModelMatrix=c.default.mat4_generateIdentity(),s._fov=new p.default(25,25,25,25),s._depthNear=.1,s._depthFar=1e3,s._views=[],s}return s(e,t),u(e,[{key:"supportsSession",value:function(t){return this._supportedCreationParameters(t)}},{key:"requestSession",value:function(t){var e=this;return new Promise(function(n,r){if(!1===e._supportedCreationParameters(t))return void r();t.type===XRSession.REALITY&&(e._reality=new _.default,e._xr._privateRealities.push(e._reality)),n(e._createSession(t))})}},{key:"_requestAnimationFrame",value:function(t){return window.requestAnimationFrame(t)}},{key:"_cancelAnimationFrame",value:function(t){return window.cancelAnimationFrame(t)}},{key:"_createSession",value:function(t){return new XRSession(this._xr,this,t)}},{key:"_supportedCreationParameters",value:function(t){throw"Should be implemented by extending class"}},{key:"_handleNewFrame",value:function(t){}},{key:"_handleAfterFrame",value:function(t){}},{key:"_handleNewBaseLayer",value:function(t){}},{key:"displayName",get:function(){return this._displayName}},{key:"isExternal",get:function(){return this._isExternal}}]),e}(d.default);e.default=v},function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":r(e))&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":r(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=n(2),l=function(t){return t&&t.__esModule?t:{default:t}}(u),c=function(t){function e(t,n,r,o){i(this,e);var s=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return s._xr=t,s._name=n,s._isShared=r,s._isPassthrough=o,s._anchors=new Map,s}return o(e,t),s(e,[{key:"getCoordinateSystem",value:function(){throw new Error("Not implemented")}},{key:"_start",value:function(){throw new Error("Exending classes should implement _start")}},{key:"_stop",value:function(){throw new Error("Exending classes should implement _stop")}},{key:"_handleNewFrame",value:function(){}},{key:"_addAnchor",value:function(t,e){throw new Error("Exending classes should implement _addAnchor")}},{key:"_findAnchor",value:function(t,e,n){throw new Error("Exending classes should implement _findAnchor")}},{key:"_findFloorAnchor",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=new Float32Array(t._headPose.poseModelMatrix);return new Promise(function(i,a){r[13]=0;var o=new XRCoordinateSystem(t,XRCoordinateSystem.TRACKER);o._relativeMatrix=r;var s=new XRAnchor(o,n);e._addAnchor(s,t),i(new XRAnchorOffset(s.uid))})}},{key:"_getAnchor",value:function(t){return this._anchors.get(t)||null}},{key:"_removeAnchor",value:function(t){throw new Error("Exending classes should implement _removeAnchor")}},{key:"_hitTestNoAnchor",value:function(t,e,n){throw new Error("Exending classes should implement _hitTestNoAnchor")}},{key:"name",get:function(){return this._name}},{key:"isShared",get:function(){return this._isShared}},{key:"isPassthrough",get:function(){return this._isPassthrough}}]),e}(l.default);e.default=c},function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":r(e))&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":r(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=n(2),l=function(t){return t&&t.__esModule?t:{default:t}}(u),c=function(t){function e(t,n,r){i(this,e);var o=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return o._xr=t,o._display=n,o._createParameters=r,o._ended=!1,o._baseLayer=null,o._stageBounds=null,o}return o(e,t),s(e,[{key:"requestFrame",value:function(t){var e=this;if(this._ended)return null;if("function"!=typeof t)throw"Invalid callback";return this._display._requestAnimationFrame(function(){var n=e._createPresentationFrame();e._display._reality._handleNewFrame(n),e._display._handleNewFrame(n),t(n),e._display._handleAfterFrame(n)})}},{key:"cancelFrame",value:function(t){return this._display._cancelAnimationFrame(t)}},{key:"end",value:function(){if(!this._ended)return this._ended=!0,this._display._stop(),new Promise(function(t,e){t()})}},{key:"_createPresentationFrame",value:function(){return new XRPresentationFrame(this)}},{key:"_getCoordinateSystem",value:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0)switch(o.value){case XRCoordinateSystem.HEAD_MODEL:return this._display._headModelCoordinateSystem;case XRCoordinateSystem.EYE_LEVEL:return this._display._eyeLevelCoordinateSystem;case XRCoordinateSystem.TRACKER:return this._display._trackerCoordinateSystem;case XRCoordinateSystem.GEOSPATIAL:default:continue}}catch(t){i=!0,a=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return null}},{key:"display",get:function(){return this._display}},{key:"createParameters",get:function(){return this._parameters}},{key:"realities",get:function(){return this._xr._sharedRealities}},{key:"reality",get:function(){return this._display._reality}},{key:"baseLayer",get:function(){return this._baseLayer},set:function(t){this._baseLayer=t,this._display._handleNewBaseLayer(this._baseLayer)}},{key:"depthNear",get:function(){this._display._depthNear},set:function(t){this._display._depthNear=t}},{key:"depthFar",get:function(){this._display._depthFar},set:function(t){this._display._depthFar=t}},{key:"hasStageBounds",get:function(){this._stageBounds}},{key:"stageBounds",get:function(){return this._stageBounds}}]),e}(l.default);e.default=c,c.REALITY="reality",c.AUGMENTATION="augmentation",c.TYPES=[c.REALITY,c.AUGMENTATION]},function(t,e,n){function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(13),s=r(o),u=n(0),l=r(u),c=function(){function t(e,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;i(this,t),this._fov=e,this._depthNear=n,this._depthFar=r,this._eye=a,this._viewport=new s.default(0,0,1,1),this._projectionMatrix=new Float32Array(16),l.default.mat4_perspectiveFromFieldOfView(this._projectionMatrix,this._fov,this._depthNear,this._depthFar)}return a(t,[{key:"setProjectionMatrix",value:function(t){for(var e=0;e<16;e++)this._projectionMatrix[e]=t[e]}},{key:"getViewport",value:function(e){return this._eye===t.LEFT?(this._viewport.x=0,this._viewport.y=0,this._viewport.width=e.framebufferWidth/2,this._viewport.height=e.framebufferHeight):this._eye===t.RIGHT?(this._viewport.x=e.framebufferWidth/2,this._viewport.y=0,this._viewport.width=e.framebufferWidth/2,this._viewport.height=e.framebufferHeight):(this._viewport.x=0,this._viewport.y=0,this._viewport.width=e.framebufferWidth,this._viewport.height=e.framebufferHeight),this._viewport}},{key:"eye",get:function(){return this._eye}},{key:"projectionMatrix",get:function(){return this._projectionMatrix}}]),t}();e.default=c,c.LEFT="left",c.RIGHT="right",c.EYES=[c.LEFT,c.RIGHT]},function(t,e,n){function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(0),s=r(o),u=n(1),l=r(u),c=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0,1];i(this,t),this._poseModelMatrix=new Float32Array(16),s.default.mat4_fromRotationTranslation(this._poseModelMatrix,n,e)}return a(t,[{key:"_setPoseModelMatrix",value:function(t){for(var e=0;e<16;e++)this._poseModelMatrix[e]=t[e]}},{key:"_translate",value:function(t){this._poseModelMatrix[12]+=t[0],this._poseModelMatrix[13]+=t[1],this._poseModelMatrix[14]+=t[2]}},{key:"getViewMatrix",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null===e&&(e=new Float32Array(16)),s.default.mat4_eyeView(e,this._poseModelMatrix),e}},{key:"poseModelMatrix",get:function(){return this._poseModelMatrix}},{key:"_position",get:function(){return[this._poseModelMatrix[12],this._poseModelMatrix[13],this._poseModelMatrix[14]]},set:function(t){this._poseModelMatrix[12]=t[0],this._poseModelMatrix[13]=t[1],this._poseModelMatrix[14]=t[2]}},{key:"_orientation",get:function(){var t=new l.default;return t.setFromRotationMatrix(this._poseModelMatrix),t.toArray()},set:function(t){s.default.mat4_fromRotationTranslation(this._poseModelMatrix,t,this._position)}}]),t}();e.default=c,c.SITTING_EYE_HEIGHT=1.1},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;r(this,t),this.x=e,this.y=n,this.z=i}return i(t,[{key:"set",value:function(t,e,n){return this.x=t,this.y=e,this.z=n,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"toArray",value:function(){return[this.x,this.y,this.z]}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"add",value:function(t,e,n){this.x+=t,this.y+=e,this.z+=n}},{key:"normalize",value:function(){var t=this.length();return 0!==t?this.multiplyScalar(1/t):(this.x=0,this.y=0,this.z=0),this}},{key:"multiplyScalar",value:function(t){this.x*=t,this.y*=t,this.z*=t}},{key:"applyQuaternion",value:function(t){var e=this.x,n=this.y,r=this.z,i=t.x,a=t.y,o=t.z,s=t.w,u=s*e+a*r-o*n,l=s*n+o*e-i*r,c=s*r+i*n-a*e,h=-i*e-a*n-o*r;return this.x=u*s+h*-i+l*-o-c*-a,this.y=l*s+h*-a+c*-i-u*-o,this.z=c*s+h*-o+u*-a-l*-i,this}},{key:"applyMatrix4",value:function(t){var e=this.x,n=this.y,r=this.z,i=1/(t[3]*e+t[7]*n+t[11]*r+t[15]);return this.x=(t[0]*e+t[4]*n+t[8]*r+t[12])*i,this.y=(t[1]*e+t[5]*n+t[9]*r+t[13])*i,this.z=(t[2]*e+t[6]*n+t[10]*r+t[14])*i,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"crossVectors",value:function(t,e){var n=t.x,r=t.y,i=t.z,a=e.x,o=e.y,s=e.z;return this.x=r*s-i*o,this.y=i*a-n*s,this.z=n*o-r*a,this}}]),t}();e.default=a},function(t,e,n){function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":r(e))&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":r(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(t){return void 0===t?"undefined":r(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":void 0===t?"undefined":r(t)},l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=n(2),h=function(t){return t&&t.__esModule?t:{default:t}}(c),d=n(3),f=(i(d),n(31)),_=i(f),y=n(32),p=i(y),v=n(16),M=i(v),m=function(t){function e(){function t(){return this.modelMatrix=new Float32Array(16),this}a(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(!1===e.HasARKit())throw"ARKitWrapper will only work in Mozilla's ARDemo test app";if(void 0!==e.GLOBAL_INSTANCE)throw"ARKitWrapper is a singleton. Use ARKitWrapper.GetOrCreate() to get the global instance.";n._deviceId=null,n._isWatching=!1,n._isInitialized=!1,n._rawARData=null,n.projectionMatrix_=new Float32Array(16),n.viewMatrix_=new Float32Array(16),n.planes_=new Map,n.anchors_=new Map,n._globalCallbacksMap={};for(var r=["onInit","onWatch"],i=0;i<r.length;i++)n._generateGlobalCallback(r[i],i);for(var s=[["arkitStartRecording",e.RECORD_START_EVENT],["arkitStopRecording",e.RECORD_STOP_EVENT],["arkitDidMoveBackground",e.DID_MOVE_BACKGROUND_EVENT],["arkitWillEnterForeground",e.WILL_ENTER_FOREGROUND_EVENT],["arkitInterrupted",e.INTERRUPTED_EVENT],["arkitInterruptionEnded",e.INTERRUPTION_ENDED_EVENT],["arkitShowDebug",e.SHOW_DEBUG_EVENT],["arkitWindowResize",e.WINDOW_RESIZE_EVENT]],u=0;u<s.length;u++)!function(t){window[s[t][0]]=function(e){e=e||null,n.dispatchEvent(new CustomEvent(s[t][1],{source:n,detail:e}))}}(u);var l=n;return n.getPlanes=function(){return Array.from(this.planes_.values())},n.hitTestNoAnchor=function(){var e={rayStart:M.create(),rayEnd:M.create(),cameraPosition:M.create(),cameraQuaternion:p.create(),modelViewMatrix:_.create(),projectionMatrix:_.create(),projViewMatrix:_.create(),worldRayStart:M.create(),worldRayEnd:M.create(),worldRayDir:M.create(),planeMatrix:_.create(),planeExtent:M.create(),planePosition:M.create(),planeCenter:M.create(),planeNormal:M.create(),planeIntersection:M.create(),planeIntersectionLocal:M.create(),planeHit:_.create()},n=function(t,e){_.set(t,e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},r=function(){var t=M.create();return function(e,n,r,i){var a=M.dot(e,i);return M.subtract(t,n,r),M.dot(t,e)/a}}(),i=function(t,r){n(e.planeMatrix,t.modelMatrix),_.getTranslation(e.planeIntersection,e.planeMatrix);var i=M.distance(e.planeIntersection,e.cameraPosition);return n(e.planeMatrix,r.modelMatrix),_.getTranslation(e.planeIntersection,e.planeMatrix),i<M.distance(e.planeIntersection,e.cameraPosition)?-1:1};return function(a,o){if(a<0||a>1||o<0||o>1)throw new Error("hitTest - x and y values must be normalized [0,1]!");var s=[],u=this.getPlanes();if(!u||0==u.length)return s;M.set(e.rayStart,2*a-1,2*(1-o)-1,0),M.set(e.rayEnd,2*a-1,2*(1-o)-1,1),n(e.projectionMatrix,l.projectionMatrix_),n(e.modelViewMatrix,l.viewMatrix_),_.multiply(e.projViewMatrix,e.projectionMatrix,e.modelViewMatrix),_.invert(e.projViewMatrix,e.projViewMatrix),M.transformMat4(e.worldRayStart,e.rayStart,e.projViewMatrix),M.transformMat4(e.worldRayEnd,e.rayEnd,e.projViewMatrix),M.subtract(e.worldRayDir,e.worldRayEnd,e.worldRayStart),M.normalize(e.worldRayDir,e.worldRayDir);for(var c=0;c<u.length;c++){var h=u[c];n(e.planeMatrix,h.modelMatrix),M.set(e.planeCenter,0,0,0),M.transformMat4(e.planePosition,e.planeCenter,e.planeMatrix),M.set(e.planeNormal,0,1,0);var d=r(e.planeNormal,e.planePosition,e.worldRayStart,e.worldRayDir);if(!(d<0||(M.scale(e.planeIntersection,e.worldRayDir,d),M.add(e.planeIntersection,e.worldRayStart,e.planeIntersection),M.set(e.planeExtent,h.extent[0],0,h.extent[1]),_.invert(e.planeMatrix,e.planeMatrix),M.transformMat4(e.planeIntersectionLocal,e.planeIntersection,e.planeMatrix),Math.abs(e.planeIntersectionLocal[0])>e.planeExtent[0]/2+.0075||Math.abs(e.planeIntersectionLocal[2])>e.planeExtent[2]/2+.0075))){_.fromTranslation(e.planeHit,e.planeIntersection);for(var f=new t,y=0;y<16;y++)f.modelMatrix[y]=e.planeHit[y];f.i=c,s.push(f)}}return s.sort(i),s}}(),n}return s(e,t),l(e,[{key:"waitForInit",value:function(){var t=this;return new Promise(function(n,r){if(t._isInitialized)return void n();var i=function r(){t.removeEventListener(e.INIT_EVENT,r,!1),n()};t.addEventListener(e.INIT_EVENT,i,!1)})}},{key:"getData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===t?this._rawARData:this._rawARData&&void 0!==this._rawARData[t]?this._rawARData[t]:null}},{key:"getObject",value:function(t){if(!this._isInitialized)return null;var e=this.getKey("objects");if(null===e)return null;var n=!0,r=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;if(s.uuid===t)return s}}catch(t){r=!0,i=t}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}return null}},{key:"hitTest",value:function(t,n){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.HIT_TEST_TYPE_ALL;return new Promise(function(e,a){if(!r._isInitialized)return void a(new Error("ARKit is not initialized"));window.webkit.messageHandlers.hitTest.postMessage({x:t,y:n,type:i,callback:r._createPromiseCallback("hitTest",e)})})}},{key:"addAnchor",value:function(t,e){var n=this;return new Promise(function(r,i){if(!n._isInitialized)return void i(new Error("ARKit is not initialized"));window.webkit.messageHandlers.addAnchor.postMessage({uuid:t,transform:e,callback:n._createPromiseCallback("addAnchor",r)})})}},{key:"stop",value:function(){var t=this;return new Promise(function(e,n){if(!t._isWatching)return void e();window.webkit.messageHandlers.stopAR.postMessage({callback:t._createPromiseCallback("stop",e)})})}},{key:"watch",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!this._isInitialized)return!1;if(this._isWatching)return!0;this._isWatching=!0,null===t&&(t={location:!0,camera:!0,objects:!0,light_intensity:!0});var e={options:t,callback:this._globalCallbacksMap.onWatch};return window.webkit.messageHandlers.watchAR.postMessage(e),!0}},{key:"setUIOptions",value:function(t){window.webkit.messageHandlers.setUIOptions.postMessage(t)}},{key:"_sendInit",value:function(t){window.webkit.messageHandlers.initAR.postMessage({options:t,callback:this._globalCallbacksMap.onInit})}},{key:"_onInit",value:function(t){this._deviceId=t,this._isInitialized=!0,this.dispatchEvent(new CustomEvent(e.INIT_EVENT,{source:this}))}},{key:"_onWatch",value:function(t){if(this._rawARData=t,this.dispatchEvent(new CustomEvent(e.WATCH_EVENT,{source:this,detail:this._rawARData})),this.viewMatrix_=t.camera_view,this.projectionMatrix_=t.projection_camera,t.newObjects.length)for(var n=0;n<t.newObjects.length;n++){var r=t.newObjects[n];r.h_plane_center?this.planes_.set(r.uuid,{id:r.uuid,center:r.h_plane_center,extent:[r.h_plane_extent.x,r.h_plane_extent.z],modelMatrix:r.transform}):this.anchors_.set(r.uuid,{id:r.uuid,modelMatrix:r.transform})}if(t.removedObjects.length)for(var i=0;i<t.removedObjects.length;i++){var a=t.removedObjects[i];a.h_plane_center?this.planes_.delete(a.uuid):this.anchors_.delete(a.uuid)}if(t.objects.length)for(var o=0;o<t.objects.length;o++){var s=t.objects[o];if(s.h_plane_center){var u=this.planes_.get(s.uuid);u?(u.center=s.h_plane_center,u.extent=[s.h_plane_extent.x,s.h_plane_extent.z],u.transform=s.transform):this.planes_.set(s.uuid,{id:s.uuid,center:s.h_plane_center,extent:[s.h_plane_extent.x,s.h_plane_extent.z],transform:s.transform})}else{var l=this.anchors_.get(s.uuid);l?l.transform=s.transform:this.anchors_.set(s.uuid,{id:s.uuid,transform:s.transform})}}}},{key:"_onStop",value:function(){this._isWatching=!1}},{key:"_createPromiseCallback",value:function(t,e){var n=this,r=this._generateCallbackUID(t);return window[r]=function(i){delete window[r];var a="_on"+t[0].toUpperCase()+t.slice(1);"function"==typeof n[a]&&n[a](i),e(i)},r}},{key:"_generateCallbackUID",value:function(t){return"arkitCallback_"+t+"_"+(new Date).getTime()+"_"+Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)}},{key:"_generateGlobalCallback",value:function(t,e){var n="arkitCallback"+e;this._globalCallbacksMap[t]=n;var r=this;window[n]=function(e){r["_"+t](e)}}},{key:"deviceId",get:function(){return this._deviceId}},{key:"isWatching",get:function(){return this._isWatching}},{key:"isInitialized",get:function(){return this._isInitialized}},{key:"hasData",get:function(){return null!==this._rawARData}}],[{key:"GetOrCreate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(void 0===e.GLOBAL_INSTANCE){e.GLOBAL_INSTANCE=new e,t=t&&"object"==(void 0===t?"undefined":u(t))?t:{};var n={browser:!0,points:!0,focus:!1,rec:!0,rec_time:!0,mic:!1,build:!1,plane:!0,warnings:!0,anchors:!1,debug:!0,statistics:!1},r="object"==u(t.ui)?t.ui:{};t.ui=Object.assign(n,r),e.GLOBAL_INSTANCE._sendInit(t)}return e.GLOBAL_INSTANCE}},{key:"HasARKit",value:function(){return void 0!==window.webkit}}]),e}(h.default);e.default=m,m.INIT_EVENT="arkit-init",m.WATCH_EVENT="arkit-watch",m.RECORD_START_EVENT="arkit-record-start",m.RECORD_STOP_EVENT="arkit-record-stop",m.DID_MOVE_BACKGROUND_EVENT="arkit-did-move-background",m.WILL_ENTER_FOREGROUND_EVENT="arkit-will-enter-foreground",m.INTERRUPTED_EVENT="arkit-interrupted",m.INTERRUPTION_ENDED_EVENT="arkit-interruption-ended",m.SHOW_DEBUG_EVENT="arkit-show-debug",m.WINDOW_RESIZE_EVENT="arkit-window-resize",m.HIT_TEST_TYPE_FEATURE_POINT=1,m.HIT_TEST_TYPE_EXISTING_PLANE=8,m.HIT_TEST_TYPE_ESTIMATED_HORIZONTAL_PLANE=2,m.HIT_TEST_TYPE_EXISTING_PLANE_USING_EXTENT=16,m.HIT_TEST_TYPE_ALL=m.HIT_TEST_TYPE_FEATURE_POINT|m.HIT_TEST_TYPE_EXISTING_PLANE|m.HIT_TEST_TYPE_ESTIMATED_HORIZONTAL_PLANE|m.HIT_TEST_TYPE_EXISTING_PLANE_USING_EXTENT,m.HIT_TEST_TYPE_EXISTING_PLANES=m.HIT_TEST_TYPE_EXISTING_PLANE|m.HIT_TEST_TYPE_EXISTING_PLANE_USING_EXTENT},function(t,e,n){function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(0),s=r(o),u=n(1),l=r(u),c=n(4),h=(r(c),function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;i(this,t),this._anchorUID=e,this._poseMatrix=n||s.default.mat4_generateIdentity()}return a(t,[{key:"getOffsetTransform",value:function(t){return s.default.mat4_multiply(new Float32Array(16),this._poseMatrix,t._poseModelMatrix)}},{key:"anchorUID",get:function(){return this._anchorUID}},{key:"poseMatrix",get:function(){return this._poseMatrix},set:function(t){for(var e=0;e<16;e++)this._poseMatrix[e]=t[e]}},{key:"position",get:function(){return new Float32Array([this._poseMatrix[12],this._poseMatrix[13],this._poseMatrix[14]])}},{key:"orientation",get:function(){var t=new l.default;return t.setFromRotationMatrix(this._poseMatrix),t.toArray()}}]),t}());e.default=h},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(e,n,i,a){r(this,t),this._x=e,this._y=n,this._width=i,this._height=a}return i(t,[{key:"x",get:function(){return this._x},set:function(t){this._x=t}},{key:"y",get:function(){return this._y},set:function(t){this._y=t}},{key:"width",get:function(){return this._width},set:function(t){this._width=t}},{key:"height",get:function(){return this._height},set:function(t){this._height=t}}]),t}();e.default=a},function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":r(e))&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":r(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=n(2),u=function(t){return t&&t.__esModule?t:{default:t}}(s),l=function(t){function e(){return i(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return o(e,t),e}(u.default);e.default=l},function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":r(e))&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":r(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),l=n(2),c=i(l),h=n(10),d=i(h),f=n(1),_=i(f),y=n(30),p=i(y),v=function(t){function e(){a(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._deviceOrientation=null,t._windowOrientation=0,window.addEventListener("orientationchange",function(){t._windowOrientation=window.orientation||0},!1),window.addEventListener("deviceorientation",function(n){t._deviceOrientation=n,t.dispatchEvent(new CustomEvent(e.ORIENTATION_UPDATE_EVENT,{deviceOrientation:t._deviceOrientation,windowOrientation:t._windowOrientation}))},!1),t}return s(e,t),u(e,[{key:"getOrientation",value:function(t){return null===this._deviceOrientation?(t.set(0,0,0,1),!1):(e.WORKING_EULER.set(this._deviceOrientation.beta*e.DEG_TO_RAD,this._deviceOrientation.alpha*e.DEG_TO_RAD,-1*this._deviceOrientation.gamma*e.DEG_TO_RAD,"YXZ"),t.setFromEuler(e.WORKING_EULER.x,e.WORKING_EULER.y,e.WORKING_EULER.z,e.WORKING_EULER.order),t.multiply(e.HALF_PI_AROUND_X),t.multiply(e.WORKING_QUATERNION.setFromAxisAngle(e.Z_AXIS,-this._windowOrientation*e.DEG_TO_RAD)),!0)}}]),e}(c.default);e.default=v,v.ORIENTATION_UPDATE_EVENT="orientation-update",v.Z_AXIS=new d.default(0,0,1),v.WORKING_EULER=new p.default,v.WORKING_QUATERNION=new _.default,v.HALF_PI_AROUND_X=new _.default(-Math.sqrt(.5),0,0,Math.sqrt(.5)),v.DEG_TO_RAD=Math.PI/180},function(t,e,n){function r(){var t=new Y.ARRAY_TYPE(3);return t[0]=0,t[1]=0,t[2]=0,t}function i(t){var e=new Y.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function a(t){var e=t[0],n=t[1],r=t[2];return Math.sqrt(e*e+n*n+r*r)}function o(t,e,n){var r=new Y.ARRAY_TYPE(3);return r[0]=t,r[1]=e,r[2]=n,r}function s(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function u(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function l(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function c(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function h(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function d(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function f(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function _(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function y(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function p(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function v(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function M(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function m(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function b(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(n*n+r*r+i*i)}function w(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i}function E(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function g(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function T(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function x(t,e){var n=e[0],r=e[1],i=e[2],a=n*n+r*r+i*i;return a>0&&(a=1/Math.sqrt(a),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a),t}function R(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function A(t,e,n){var r=e[0],i=e[1],a=e[2],o=n[0],s=n[1],u=n[2];return t[0]=i*u-a*s,t[1]=a*o-r*u,t[2]=r*s-i*o,t}function N(t,e,n,r){var i=e[0],a=e[1],o=e[2];return t[0]=i+r*(n[0]-i),t[1]=a+r*(n[1]-a),t[2]=o+r*(n[2]-o),t}function O(t,e,n,r,i,a){var o=a*a,s=o*(2*a-3)+1,u=o*(a-2)+a,l=o*(a-1),c=o*(3-2*a);return t[0]=e[0]*s+n[0]*u+r[0]*l+i[0]*c,t[1]=e[1]*s+n[1]*u+r[1]*l+i[1]*c,t[2]=e[2]*s+n[2]*u+r[2]*l+i[2]*c,t}function L(t,e,n,r,i,a){var o=1-a,s=o*o,u=a*a,l=s*o,c=3*a*s,h=3*u*o,d=u*a;return t[0]=e[0]*l+n[0]*c+r[0]*h+i[0]*d,t[1]=e[1]*l+n[1]*c+r[1]*h+i[1]*d,t[2]=e[2]*l+n[2]*c+r[2]*h+i[2]*d,t}function I(t,e){e=e||1;var n=2*Y.RANDOM()*Math.PI,r=2*Y.RANDOM()-1,i=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*i,t[1]=Math.sin(n)*i,t[2]=r*e,t}function D(t,e,n){var r=e[0],i=e[1],a=e[2],o=n[3]*r+n[7]*i+n[11]*a+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*a+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*a+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*a+n[14])/o,t}function P(t,e,n){var r=e[0],i=e[1],a=e[2];return t[0]=r*n[0]+i*n[3]+a*n[6],t[1]=r*n[1]+i*n[4]+a*n[7],t[2]=r*n[2]+i*n[5]+a*n[8],t}function j(t,e,n){var r=e[0],i=e[1],a=e[2],o=n[0],s=n[1],u=n[2],l=n[3],c=l*r+s*a-u*i,h=l*i+u*r-o*a,d=l*a+o*i-s*r,f=-o*r-s*i-u*a;return t[0]=c*l+f*-o+h*-u-d*-s,t[1]=h*l+f*-s+d*-o-c*-u,t[2]=d*l+f*-u+c*-s-h*-o,t}function S(t,e,n,r){var i=[],a=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],a[0]=i[0],a[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),a[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t}function k(t,e,n,r){var i=[],a=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],a[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),a[1]=i[1],a[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t}function C(t,e,n,r){var i=[],a=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],a[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),a[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),a[2]=i[2],t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t}function z(t,e){var n=o(t[0],t[1],t[2]),r=o(e[0],e[1],e[2]);x(n,n),x(r,r);var i=R(n,r);return i>1?0:i<-1?Math.PI:Math.acos(i)}function F(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function H(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function W(t,e){var n=t[0],r=t[1],i=t[2],a=e[0],o=e[1],s=e[2];return Math.abs(n-a)<=Y.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-o)<=Y.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-s)<=Y.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))}Object.defineProperty(e,"__esModule",{value:!0}),e.forEach=e.sqrLen=e.len=e.sqrDist=e.dist=e.div=e.mul=e.sub=void 0,e.create=r,e.clone=i,e.length=a,e.fromValues=o,e.copy=s,e.set=u,e.add=l,e.subtract=c,e.multiply=h,e.divide=d,e.ceil=f,e.floor=_,e.min=y,e.max=p,e.round=v,e.scale=M,e.scaleAndAdd=m,e.distance=b,e.squaredDistance=w,e.squaredLength=E,e.negate=g,e.inverse=T,e.normalize=x,e.dot=R,e.cross=A,e.lerp=N,e.hermite=O,e.bezier=L,e.random=I,e.transformMat4=D,e.transformMat3=P,e.transformQuat=j,e.rotateX=S,e.rotateY=k,e.rotateZ=C,e.angle=z,e.str=F,e.exactEquals=H,e.equals=W;var V=n(3),Y=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(V);e.sub=c,e.mul=h,e.div=d,e.dist=b,e.sqrDist=w,e.len=a,e.sqrLen=E,e.forEach=function(){var t=r();return function(e,n,r,i,a,o){var s=void 0,u=void 0;for(n||(n=3),r||(r=0),u=i?Math.min(i*n+r,e.length):e.length,s=r;s<u;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}}()},function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":r(e))&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":r(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),l=n(5),c=i(l),h=n(7),d=i(h),f=n(20),_=i(f),y=n(6),p=i(y),v=n(21),M=i(v),m=n(22),b=i(m),w=n(4),E=i(w),g=n(23),T=i(g),x=n(12),R=i(x),A=n(24),N=i(A),O=n(25),L=i(O),I=n(26),D=i(I),P=n(8),j=i(P),S=n(13),k=i(S),C=n(27),z=i(C),F=n(9),H=i(F),W=n(14),V=i(W),Y=n(28),U=i(Y),G=n(2),X=i(G),B=n(29),Q=i(B),Z=n(35),K=i(Z),q=n(36),J=i(q),$=function(t){function e(){a(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));window.XRDisplay=c.default,window.XRSession=d.default,window.XRSessionCreateParameters=_.default,window.Reality=p.default,window.XRPointCloud=M.default,window.XRLightEstimate=b.default,window.XRAnchor=E.default,window.XRPlaneAnchor=T.default,window.XRAnchorOffset=R.default,window.XRStageBounds=N.default,window.XRStageBoundsPoint=L.default,window.XRPresentationFrame=D.default,window.XRView=j.default,window.XRViewport=k.default,window.XRCoordinateSystem=z.default,window.XRViewPose=H.default,window.XRLayer=V.default,window.XRWebGLLayer=U.default,t._getVRDisplaysFinished=!1,t._sharedRealities=[new J.default(t)],t._privateRealities=[],t._displays=[new Q.default(t,t._sharedRealities[0])],"function"==typeof navigator.getVRDisplays?navigator.getVRDisplays().then(function(e){var n=!0,r=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;null!==s&&s.capabilities.canPresent&&t._displays.push(new K.default(t,t._sharedRealities[0],s))}}catch(t){r=!0,i=t}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}t._getVRDisplaysFinished=!0}):t._getVRDisplaysFinished=!0,t._sessionEls=document.createElement("div"),t._sessionEls.setAttribute("class","webxr-sessions"),t._realityEls=document.createElement("div"),t._realityEls.setAttribute("class","webxr-realities");for(var n=[t._sessionEls,t._realityEls],r=0;r<n.length;r++){var i=n[r];i.style.position="absolute",i.style.width="100%",i.style.height="100%"}return document.addEventListener("DOMContentLoaded",function(){document.body.style.width="100%",document.body.style.height="100%",document.body.prepend(t._sessionEls),document.body.prepend(t._realityEls)}),t}return s(e,t),u(e,[{key:"getDisplays",value:function(){var t=this,e=function e(n){t._getVRDisplaysFinished?n(t._displays):setTimeout(e.bind(t,n),30)};return new Promise(function(t,n){e(t)})}}]),e}(X.default);void 0===navigator.XR&&(navigator.XR=new $)},function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":r(e))&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":r(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=n(6),l=function(t){return t&&t.__esModule?t:{default:t}}(u),c=function(t){function e(t){return i(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,"Virtual",!1,!1))}return o(e,t),s(e,[{key:"_start",value:function(){}},{key:"_stop",value:function(){}},{key:"_handleNewFrame",value:function(){}},{key:"_addAnchor",value:function(t,e){return this._anchors.set(t.uid,t),t.uid}},{key:"_findAnchor",value:function(t,e,n){return new Promise(function(t,e){t(null)})}},{key:"_removeAnchor",value:function(t){this._anchors.delete(t)}},{key:"_hitTestNoAnchor",value:function(t,e,n){return null}}]),e}(l.default);e.default=c},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(e,n,i,a){r(this,t),this._upDegrees=e,this._downDegrees=n,this._leftDegrees=i,this._rightDegrees=a}return i(t,[{key:"upDegrees",get:function(){return this._upDegrees}},{key:"downDegrees",get:function(){return this._downDegrees}},{key:"leftDegrees",get:function(){return this._leftDegrees}},{key:"rightDegrees",get:function(){return this._rightDegrees}}]),t}();e.default=a},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(){r(this,t)}return i(t,[{key:"exclusive",get:function(){throw"Not implemented"}},{key:"type",get:function(){throw"Not implemented"}}]),t}();e.default=a},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(){r(this,t)}return i(t,[{key:"points",get:function(){throw new Error("Not implemented")}}]),t}();e.default=a},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(){r(this,t)}return i(t,[{key:"getAmbientColorTemperature",value:function(){throw new Error("Not implemented")}},{key:"ambientIntensity",get:function(){throw new Error("Not implemented")}}]),t}();e.default=a},function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":r(e))&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":r(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=n(4),l=function(t){return t&&t.__esModule?t:{default:t}}(u),c=function(t){function e(){return i(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return o(e,t),s(e,[{key:"width",get:function(){throw"Not implemented"}},{key:"length",get:function(){throw"Not implemented"}}]),e}(l.default);e.default=c},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(){r(this,t)}return i(t,[{key:"center",get:function(){throw new Error("Not implemented")}},{key:"geometry",get:function(){throw new Error("Not implemented")}}]),t}();e.default=a},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(){r(this,t)}return i(t,[{key:"x",get:function(){throw new Error("Not implemented")}},{key:"y",get:function(){throw new Error("Not implemented")}}]),t}();e.default=a},function(t,e,n){function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(4),s=r(o),u=n(0),l=r(u),c=function(){function t(e){i(this,t),this._session=e}return a(t,[{key:"addAnchor",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0,1],r=l.default.mat4_fromRotationTranslation(new Float32Array(16),n,e);l.default.mat4_multiply(r,t.getTransformTo(this._session._display._trackerCoordinateSystem),r);var i=new XRCoordinateSystem(this._session._display,XRCoordinateSystem.TRACKER);return i._relativeMatrix=r,this._session.reality._addAnchor(new s.default(i),this._session.display)}},{key:"findAnchor",value:function(t,e){return this._session.reality._findAnchor(t,e,this._session.display)}},{key:"hitTestNoAnchor",value:function(t,e){return this._session.reality._hitTestNoAnchor(t,e,this._session.display)}},{key:"findFloorAnchor",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this._session.reality._findFloorAnchor(this._session.display,t)}},{key:"removeAnchor",value:function(t){return this._session.reality._removeAnchor(t)}},{key:"getAnchor",value:function(t){return this._session.reality._getAnchor(t)}},{key:"getCoordinateSystem",value:function(){var t;return(t=this._session)._getCoordinateSystem.apply(t,arguments)}},{key:"getDisplayPose",value:function(t){switch(t._type){case XRCoordinateSystem.HEAD_MODEL:return this._session._display._headPose;case XRCoordinateSystem.EYE_LEVEL:return this._session._display._eyeLevelPose;default:return null}}},{key:"session",get:function(){return this._session}},{key:"views",get:function(){return this._session._display._views}},{key:"hasPointCloud",get:function(){return!1}},{key:"pointCloud",get:function(){return null}},{key:"hasLightEstimate",get:function(){return!1}},{key:"lightEstimate",get:function(){return null}},{key:"anchors",get:function(){var t=[],e=!0,n=!1,r=void 0;try{for(var i,a=this._session.reality._anchors.values()[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value;t.push(o)}}catch(t){n=!0,r=t}finally{try{!e&&a.return&&a.return()}finally{if(n)throw r}}return t}}]),t}();e.default=c},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=n(0),o=function(t){return t&&t.__esModule?t:{default:t}}(a),s=function(){function t(e,n){r(this,t),this._display=e,this._type=n,this.__relativeMatrix=o.default.mat4_generateIdentity(),this._workingMatrix=o.default.mat4_generateIdentity()}return i(t,[{key:"getTransformTo",value:function(t){var e=o.default.mat4_invert(new Float32Array(16),t._poseModelMatrix),n=o.default.mat4_generateIdentity();return o.default.mat4_multiply(n,e,n),o.default.mat4_multiply(n,this._poseModelMatrix,n),n}},{key:"_relativeMatrix",get:function(){return this.__relativeMatrix},set:function(t){for(var e=0;e<16;e++)this.__relativeMatrix[e]=t[e]}},{key:"_poseModelMatrix",get:function(){switch(this._type){case t.HEAD_MODEL:return this._display._headPose.poseModelMatrix;case t.EYE_LEVEL:return this._display._eyeLevelPose.poseModelMatrix;case t.TRACKER:return o.default.mat4_multiply(this._workingMatrix,this.__relativeMatrix,this._display._trackerPoseModelMatrix),this._workingMatrix;default:throw new Error("Unknown coordinate system type: "+this._type)}}}]),t}();e.default=s,s.HEAD_MODEL="headModel",s.EYE_LEVEL="eyeLevel",s.TRACKER="tracker",s.TYPES=[s.HEAD_MODEL,s.EYE_LEVEL,s.TRACKER]},function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":r(e))&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":r(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=n(14),l=function(t){return t&&t.__esModule?t:{default:t}}(u),c=function(t){function e(t,n){i(this,e);var r=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r._session=t,r._context=n,r._width=r._context.canvas.width,r._height=r._context.canvas.height,r._framebuffer=null,r}return o(e,t),s(e,[{key:"requestViewportScaling",value:function(t){throw"Not implemented"}},{key:"context",get:function(){return this._context}},{key:"antialias",get:function(){throw"Not implemented"}},{key:"depth",get:function(){throw"Not implemented"}},{key:"stencil",get:function(){throw"Not implemented"}},{key:"alpha",get:function(){throw"Not implemented"}},{key:"multiview",get:function(){throw"Not implemented"}},{key:"framebuffer",get:function(){return this._framebuffer}},{key:"framebufferWidth",set:function(t){this._width=t,this._context.canvas.width=t},get:function(){return this._width}},{key:"framebufferHeight",set:function(t){this._height=t,this._context.canvas.height=t},get:function(){return this._height}}]),e}(l.default);e.default=c},function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function a(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":r(e))&&"function"!=typeof e?t:e}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":r(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=function t(e,n,r){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,n);if(void 0===i){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,n,r)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(r):void 0},h=n(5),d=i(h),f=n(8),_=i(f),y=n(7),p=i(y),v=n(0),M=i(v),m=n(1),b=i(m),w=n(10),E=i(w),g=n(15),T=i(g),x=n(11),R=i(x),A=function(t){function e(t,n){o(this,e);var r=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,"Flat",!1,n));return r._started=!1,r._initialized=!1,r._arKitWrapper=null,r._vrFrameData=null,r._deviceOrientationTracker=null,r._deviceOrientation=null,r._devicePosition=null,r._deviceWorldMatrix=null,r._views.push(new _.default(r._fov,r._depthNear,r._depthFar)),r}return u(e,t),l(e,[{key:"_start",value:function(){var t=this;this._reality._vrDisplay?null===this._vrFrameData&&(this._vrFrameData=new VRFrameData,this._views[0]._depthNear=this._reality._vrDisplay.depthNear,this._views[0]._depthFar=this._reality._vrDisplay.depthFar,this._deviceOrientation=new b.default,this._devicePosition=new E.default,this._deviceWorldMatrix=new Float32Array(16)):R.default.HasARKit()?!1===this._initialized?(this._initialized=!0,this._arKitWrapper=R.default.GetOrCreate(),this._arKitWrapper.addEventListener(R.default.INIT_EVENT,this._handleARKitInit.bind(this)),this._arKitWrapper.addEventListener(R.default.WATCH_EVENT,this._handleARKitUpdate.bind(this)),this._arKitWrapper.addEventListener(R.default.WINDOW_RESIZE_EVENT,this._handleARKitWindowResize.bind(this)),this._arKitWrapper.waitForInit().then(function(){t._arKitWrapper.watch()})):this._arKitWrapper.watch():!1===this._initialized&&(this._initialized=!0,this._deviceOrientation=new b.default,this._devicePosition=new E.default,this._deviceWorldMatrix=new Float32Array(16),this._deviceOrientationTracker=new T.default,this._deviceOrientationTracker.addEventListener(T.default.ORIENTATION_UPDATE_EVENT,this._updateFromDeviceOrientationTracker.bind(this))),this.running=!0,this._reality._start()}},{key:"_stop",value:function(){!1!==this.running&&(this.running=!1,this._reality._stop())}},{key:"_handleNewBaseLayer",value:function(t){this.baseLayer=t,t._context.canvas.style.width="100%",t._context.canvas.style.height="100%",t.framebufferWidth=this._xr._sessionEls.clientWidth,t.framebufferHeight=this._xr._sessionEls.clientHeight,null===this._arKitWrapper&&window.addEventListener("resize",function(){t.framebufferWidth=t._context.canvas.clientWidth,t.framebufferHeight=t._context.canvas.clientHeight},!1),this._xr._sessionEls.appendChild(t._context.canvas)}},{key:"_handleNewFrame",value:function(t){null!==this._vrFrameData&&this._updateFromVRDevice()}},{key:"_updateFromVRDevice",value:function(){var t,e;this._reality._vrDisplay.getFrameData(this._vrFrameData),this._views[0].setProjectionMatrix(this._vrFrameData.leftProjectionMatrix),(t=this._deviceOrientation).set.apply(t,a(this._vrFrameData.pose.orientation)),(e=this._devicePosition).set.apply(e,a(this._vrFrameData.pose.position)),this._devicePosition.add(0,XRViewPose.SITTING_EYE_HEIGHT,0),M.default.mat4_fromRotationTranslation(this._deviceWorldMatrix,this._deviceOrientation.toArray(),this._devicePosition.toArray()),this._headPose._setPoseModelMatrix(this._deviceWorldMatrix),this._eyeLevelPose._position=this._devicePosition.toArray()}},{key:"_updateFromDeviceOrientationTracker",value:function(){this._deviceOrientationTracker.getOrientation(this._deviceOrientation),this._devicePosition.set(this._headPose.poseModelMatrix[12],this._headPose.poseModelMatrix[13],this._headPose.poseModelMatrix[14]),this._devicePosition.add(0,XRViewPose.SITTING_EYE_HEIGHT,0),M.default.mat4_fromRotationTranslation(this._deviceWorldMatrix,this._deviceOrientation.toArray(),this._devicePosition.toArray()),this._headPose._setPoseModelMatrix(this._deviceWorldMatrix),this._eyeLevelPose._position=this._devicePosition.toArray()}},{key:"_handleARKitUpdate",value:function(){var t=this._arKitWrapper.getData("camera_transform");t?(this._headPose._setPoseModelMatrix(t),this._headPose._poseModelMatrix[13]+=XRViewPose.SITTING_EYE_HEIGHT,this._eyeLevelPose._position=this._headPose._position):console.log("no camera transform",this._arKitWrapper.rawARData);var e=this._arKitWrapper.getData("projection_camera");e?this._views[0].setProjectionMatrix(e):console.log("no projection camera",this._arKitWrapper.rawARData)}},{key:"_handleARKitInit",value:function(t){var e=this;setTimeout(function(){e._arKitWrapper.watch({location:!0,camera:!0,objects:!0,light_intensity:!0})},1e3)}},{key:"_handleARKitWindowResize",value:function(t){this.baseLayer.framebufferWidth=t.detail.width,this.baseLayer.framebufferHeight=t.detail.height}},{key:"_createSession",value:function(t){return this._start(),c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_createSession",this).call(this,t)}},{key:"_supportedCreationParameters",value:function(t){return t.type===p.default.AUGMENTATION&&!1===t.exclusive}}]),e}(d.default);e.default=A},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(e,n,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.DefaultOrder;r(this,t),this.x=e,this.y=n,this.z=i,this.order=a}return i(t,[{key:"set",value:function(e,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.DefaultOrder;this.x=e,this.y=n,this.z=r,this.order=i}},{key:"toArray",value:function(){return[this.x,this.y,this.z]}}]),t}();e.default=a,a.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],a.DefaultOrder="XYZ"},function(t,e,n){function r(){var t=new Q.ARRAY_TYPE(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function i(t){var e=new Q.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function a(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function o(t,e,n,r,i,a,o,s,u,l,c,h,d,f,_,y){var p=new Q.ARRAY_TYPE(16);return p[0]=t,p[1]=e,p[2]=n,p[3]=r,p[4]=i,p[5]=a,p[6]=o,p[7]=s,p[8]=u,p[9]=l,p[10]=c,p[11]=h,p[12]=d,p[13]=f,p[14]=_,p[15]=y,p}function s(t,e,n,r,i,a,o,s,u,l,c,h,d,f,_,y,p){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=a,t[5]=o,t[6]=s,t[7]=u,t[8]=l,t[9]=c,t[10]=h,t[11]=d,t[12]=f,t[13]=_,t[14]=y,t[15]=p,t}function u(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function l(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],a=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=a,t[11]=e[14],t[12]=i,t[13]=o,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function c(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],d=e[10],f=e[11],_=e[12],y=e[13],p=e[14],v=e[15],M=n*s-r*o,m=n*u-i*o,b=n*l-a*o,w=r*u-i*s,E=r*l-a*s,g=i*l-a*u,T=c*y-h*_,x=c*p-d*_,R=c*v-f*_,A=h*p-d*y,N=h*v-f*y,O=d*v-f*p,L=M*O-m*N+b*A+w*R-E*x+g*T;return L?(L=1/L,t[0]=(s*O-u*N+l*A)*L,t[1]=(i*N-r*O-a*A)*L,t[2]=(y*g-p*E+v*w)*L,t[3]=(d*E-h*g-f*w)*L,t[4]=(u*R-o*O-l*x)*L,t[5]=(n*O-i*R+a*x)*L,t[6]=(p*b-_*g-v*m)*L,t[7]=(c*g-d*b+f*m)*L,t[8]=(o*N-s*R+l*T)*L,t[9]=(r*R-n*N-a*T)*L,t[10]=(_*E-y*b+v*M)*L,t[11]=(h*b-c*E-f*M)*L,t[12]=(s*x-o*A-u*T)*L,t[13]=(n*A-r*x+i*T)*L,t[14]=(y*m-_*w-p*M)*L,t[15]=(c*w-h*m+d*M)*L,t):null}function h(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],d=e[10],f=e[11],_=e[12],y=e[13],p=e[14],v=e[15];return t[0]=s*(d*v-f*p)-h*(u*v-l*p)+y*(u*f-l*d),t[1]=-(r*(d*v-f*p)-h*(i*v-a*p)+y*(i*f-a*d)),t[2]=r*(u*v-l*p)-s*(i*v-a*p)+y*(i*l-a*u),t[3]=-(r*(u*f-l*d)-s*(i*f-a*d)+h*(i*l-a*u)),t[4]=-(o*(d*v-f*p)-c*(u*v-l*p)+_*(u*f-l*d)),t[5]=n*(d*v-f*p)-c*(i*v-a*p)+_*(i*f-a*d),t[6]=-(n*(u*v-l*p)-o*(i*v-a*p)+_*(i*l-a*u)),t[7]=n*(u*f-l*d)-o*(i*f-a*d)+c*(i*l-a*u),t[8]=o*(h*v-f*y)-c*(s*v-l*y)+_*(s*f-l*h),t[9]=-(n*(h*v-f*y)-c*(r*v-a*y)+_*(r*f-a*h)),t[10]=n*(s*v-l*y)-o*(r*v-a*y)+_*(r*l-a*s),t[11]=-(n*(s*f-l*h)-o*(r*f-a*h)+c*(r*l-a*s)),t[12]=-(o*(h*p-d*y)-c*(s*p-u*y)+_*(s*d-u*h)),t[13]=n*(h*p-d*y)-c*(r*p-i*y)+_*(r*d-i*h),t[14]=-(n*(s*p-u*y)-o*(r*p-i*y)+_*(r*u-i*s)),t[15]=n*(s*d-u*h)-o*(r*d-i*h)+c*(r*u-i*s),t}function d(t){var e=t[0],n=t[1],r=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],l=t[8],c=t[9],h=t[10],d=t[11],f=t[12],_=t[13],y=t[14],p=t[15];return(e*o-n*a)*(h*p-d*y)-(e*s-r*a)*(c*p-d*_)+(e*u-i*a)*(c*y-h*_)+(n*s-r*o)*(l*p-d*f)-(n*u-i*o)*(l*y-h*f)+(r*u-i*s)*(l*_-c*f)}function f(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],d=e[9],f=e[10],_=e[11],y=e[12],p=e[13],v=e[14],M=e[15],m=n[0],b=n[1],w=n[2],E=n[3];return t[0]=m*r+b*s+w*h+E*y,t[1]=m*i+b*u+w*d+E*p,t[2]=m*a+b*l+w*f+E*v,t[3]=m*o+b*c+w*_+E*M,m=n[4],b=n[5],w=n[6],E=n[7],t[4]=m*r+b*s+w*h+E*y,t[5]=m*i+b*u+w*d+E*p,t[6]=m*a+b*l+w*f+E*v,t[7]=m*o+b*c+w*_+E*M,m=n[8],b=n[9],w=n[10],E=n[11],t[8]=m*r+b*s+w*h+E*y,t[9]=m*i+b*u+w*d+E*p,t[10]=m*a+b*l+w*f+E*v,t[11]=m*o+b*c+w*_+E*M,m=n[12],b=n[13],w=n[14],E=n[15],t[12]=m*r+b*s+w*h+E*y,t[13]=m*i+b*u+w*d+E*p,t[14]=m*a+b*l+w*f+E*v,t[15]=m*o+b*c+w*_+E*M,t}function _(t,e,n){var r=n[0],i=n[1],a=n[2],o=void 0,s=void 0,u=void 0,l=void 0,c=void 0,h=void 0,d=void 0,f=void 0,_=void 0,y=void 0,p=void 0,v=void 0;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*a+e[12],t[13]=e[1]*r+e[5]*i+e[9]*a+e[13],t[14]=e[2]*r+e[6]*i+e[10]*a+e[14],t[15]=e[3]*r+e[7]*i+e[11]*a+e[15]):(o=e[0],s=e[1],u=e[2],l=e[3],c=e[4],h=e[5],d=e[6],f=e[7],_=e[8],y=e[9],p=e[10],v=e[11],t[0]=o,t[1]=s,t[2]=u,t[3]=l,t[4]=c,t[5]=h,t[6]=d,t[7]=f,t[8]=_,t[9]=y,t[10]=p,t[11]=v,t[12]=o*r+c*i+_*a+e[12],t[13]=s*r+h*i+y*a+e[13],t[14]=u*r+d*i+p*a+e[14],t[15]=l*r+f*i+v*a+e[15]),t}function y(t,e,n){var r=n[0],i=n[1],a=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function p(t,e,n,r){var i=r[0],a=r[1],o=r[2],s=Math.sqrt(i*i+a*a+o*o),u=void 0,l=void 0,c=void 0,h=void 0,d=void 0,f=void 0,_=void 0,y=void 0,p=void 0,v=void 0,M=void 0,m=void 0,b=void 0,w=void 0,E=void 0,g=void 0,T=void 0,x=void 0,R=void 0,A=void 0,N=void 0,O=void 0,L=void 0,I=void 0;return Math.abs(s)<Q.EPSILON?null:(s=1/s,i*=s,a*=s,o*=s,u=Math.sin(n),l=Math.cos(n),c=1-l,h=e[0],d=e[1],f=e[2],_=e[3],y=e[4],p=e[5],v=e[6],M=e[7],m=e[8],b=e[9],w=e[10],E=e[11],g=i*i*c+l,T=a*i*c+o*u,x=o*i*c-a*u,R=i*a*c-o*u,A=a*a*c+l,N=o*a*c+i*u,O=i*o*c+a*u,L=a*o*c-i*u,I=o*o*c+l,t[0]=h*g+y*T+m*x,t[1]=d*g+p*T+b*x,t[2]=f*g+v*T+w*x,t[3]=_*g+M*T+E*x,t[4]=h*R+y*A+m*N,t[5]=d*R+p*A+b*N,t[6]=f*R+v*A+w*N,t[7]=_*R+M*A+E*N,t[8]=h*O+y*L+m*I,t[9]=d*O+p*L+b*I,t[10]=f*O+v*L+w*I,t[11]=_*O+M*L+E*I,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function v(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*i+l*r,t[5]=o*i+c*r,t[6]=s*i+h*r,t[7]=u*i+d*r,t[8]=l*i-a*r,t[9]=c*i-o*r,t[10]=h*i-s*r,t[11]=d*i-u*r,t}function M(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[0],o=e[1],s=e[2],u=e[3],l=e[8],c=e[9],h=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i-l*r,t[1]=o*i-c*r,t[2]=s*i-h*r,t[3]=u*i-d*r,t[8]=a*r+l*i,t[9]=o*r+c*i,t[10]=s*r+h*i,t[11]=u*r+d*i,t}function m(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[0],o=e[1],s=e[2],u=e[3],l=e[4],c=e[5],h=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i+l*r,t[1]=o*i+c*r,t[2]=s*i+h*r,t[3]=u*i+d*r,t[4]=l*i-a*r,t[5]=c*i-o*r,t[6]=h*i-s*r,t[7]=d*i-u*r,t}function b(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function w(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function E(t,e,n){var r=n[0],i=n[1],a=n[2],o=Math.sqrt(r*r+i*i+a*a),s=void 0,u=void 0,l=void 0;return Math.abs(o)<Q.EPSILON?null:(o=1/o,r*=o,i*=o,a*=o,s=Math.sin(e),u=Math.cos(e),l=1-u,t[0]=r*r*l+u,t[1]=i*r*l+a*s,t[2]=a*r*l-i*s,t[3]=0,t[4]=r*i*l-a*s,t[5]=i*i*l+u,t[6]=a*i*l+r*s,t[7]=0,t[8]=r*a*l+i*s,t[9]=i*a*l-r*s,t[10]=a*a*l+u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function g(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function T(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function x(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function R(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=r+r,u=i+i,l=a+a,c=r*s,h=r*u,d=r*l,f=i*u,_=i*l,y=a*l,p=o*s,v=o*u,M=o*l;return t[0]=1-(f+y),t[1]=h+M,t[2]=d-v,t[3]=0,t[4]=h-M,t[5]=1-(c+y),t[6]=_+p,t[7]=0,t[8]=d+v,t[9]=_-p,t[10]=1-(c+f),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function A(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function N(t,e){var n=e[0],r=e[1],i=e[2],a=e[4],o=e[5],s=e[6],u=e[8],l=e[9],c=e[10];return t[0]=Math.sqrt(n*n+r*r+i*i),t[1]=Math.sqrt(a*a+o*o+s*s),t[2]=Math.sqrt(u*u+l*l+c*c),t}function O(t,e){var n=e[0]+e[5]+e[10],r=0;return n>0?(r=2*Math.sqrt(n+1),t[3]=.25*r,t[0]=(e[6]-e[9])/r,t[1]=(e[8]-e[2])/r,t[2]=(e[1]-e[4])/r):e[0]>e[5]&e[0]>e[10]?(r=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/r,t[0]=.25*r,t[1]=(e[1]+e[4])/r,t[2]=(e[8]+e[2])/r):e[5]>e[10]?(r=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/r,t[0]=(e[1]+e[4])/r,t[1]=.25*r,t[2]=(e[6]+e[9])/r):(r=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/r,t[0]=(e[8]+e[2])/r,t[1]=(e[6]+e[9])/r,t[2]=.25*r),t}function L(t,e,n,r){var i=e[0],a=e[1],o=e[2],s=e[3],u=i+i,l=a+a,c=o+o,h=i*u,d=i*l,f=i*c,_=a*l,y=a*c,p=o*c,v=s*u,M=s*l,m=s*c,b=r[0],w=r[1],E=r[2];return t[0]=(1-(_+p))*b,t[1]=(d+m)*b,t[2]=(f-M)*b,t[3]=0,t[4]=(d-m)*w,t[5]=(1-(h+p))*w,t[6]=(y+v)*w,t[7]=0,t[8]=(f+M)*E,t[9]=(y-v)*E,t[10]=(1-(h+_))*E,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function I(t,e,n,r,i){var a=e[0],o=e[1],s=e[2],u=e[3],l=a+a,c=o+o,h=s+s,d=a*l,f=a*c,_=a*h,y=o*c,p=o*h,v=s*h,M=u*l,m=u*c,b=u*h,w=r[0],E=r[1],g=r[2],T=i[0],x=i[1],R=i[2];return t[0]=(1-(y+v))*w,t[1]=(f+b)*w,t[2]=(_-m)*w,t[3]=0,t[4]=(f-b)*E,t[5]=(1-(d+v))*E,t[6]=(p+M)*E,t[7]=0,t[8]=(_+m)*g,t[9]=(p-M)*g,t[10]=(1-(d+y))*g,t[11]=0,t[12]=n[0]+T-(t[0]*T+t[4]*x+t[8]*R),t[13]=n[1]+x-(t[1]*T+t[5]*x+t[9]*R),t[14]=n[2]+R-(t[2]*T+t[6]*x+t[10]*R),t[15]=1,t}function D(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n+n,s=r+r,u=i+i,l=n*o,c=r*o,h=r*s,d=i*o,f=i*s,_=i*u,y=a*o,p=a*s,v=a*u;return t[0]=1-h-_,t[1]=c+v,t[2]=d-p,t[3]=0,t[4]=c-v,t[5]=1-l-_,t[6]=f+y,t[7]=0,t[8]=d+p,t[9]=f-y,t[10]=1-l-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function P(t,e,n,r,i,a,o){var s=1/(n-e),u=1/(i-r),l=1/(a-o);return t[0]=2*a*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*u,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(i+r)*u,t[10]=(o+a)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*a*2*l,t[15]=0,t}function j(t,e,n,r,i){var a=1/Math.tan(e/2),o=1/(r-i);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+r)*o,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*r*o,t[15]=0,t}function S(t,e,n,r){var i=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),u=2/(o+s),l=2/(i+a);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=-(o-s)*u*.5,t[9]=(i-a)*l*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function k(t,e,n,r,i,a,o){var s=1/(e-n),u=1/(r-i),l=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=(o+a)*l,t[15]=1,t}function C(t,e,n,r){var i=void 0,a=void 0,o=void 0,s=void 0,l=void 0,c=void 0,h=void 0,d=void 0,f=void 0,_=void 0,y=e[0],p=e[1],v=e[2],M=r[0],m=r[1],b=r[2],w=n[0],E=n[1],g=n[2];return Math.abs(y-w)<Q.EPSILON&&Math.abs(p-E)<Q.EPSILON&&Math.abs(v-g)<Q.EPSILON?u(t):(h=y-w,d=p-E,f=v-g,_=1/Math.sqrt(h*h+d*d+f*f),h*=_,d*=_,f*=_,i=m*f-b*d,a=b*h-M*f,o=M*d-m*h,_=Math.sqrt(i*i+a*a+o*o),_?(_=1/_,i*=_,a*=_,o*=_):(i=0,a=0,o=0),s=d*o-f*a,l=f*i-h*o,c=h*a-d*i,_=Math.sqrt(s*s+l*l+c*c),_?(_=1/_,s*=_,l*=_,c*=_):(s=0,l=0,c=0),t[0]=i,t[1]=s,t[2]=h,t[3]=0,t[4]=a,t[5]=l,t[6]=d,t[7]=0,t[8]=o,t[9]=c,t[10]=f,t[11]=0,t[12]=-(i*y+a*p+o*v),t[13]=-(s*y+l*p+c*v),t[14]=-(h*y+d*p+f*v),t[15]=1,t)}function z(t,e,n,r){var i=e[0],a=e[1],o=e[2],s=r[0],u=r[1],l=r[2],c=i-n[0],h=a-n[1],d=o-n[2],f=c*c+h*h+d*d;f>0&&(f=1/Math.sqrt(f),c*=f,h*=f,d*=f);var _=u*d-l*h,y=l*c-s*d,p=s*h-u*c;return t[0]=_,t[1]=y,t[2]=p,t[3]=0,t[4]=h*p-d*y,t[5]=d*_-c*p,t[6]=c*y-h*_,t[7]=0,t[8]=c,t[9]=h,t[10]=d,t[11]=0,t[12]=i,t[13]=a,t[14]=o,t[15]=1,t}function F(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function H(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))}function W(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function V(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function Y(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function U(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function G(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function X(t,e){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],d=t[10],f=t[11],_=t[12],y=t[13],p=t[14],v=t[15],M=e[0],m=e[1],b=e[2],w=e[3],E=e[4],g=e[5],T=e[6],x=e[7],R=e[8],A=e[9],N=e[10],O=e[11],L=e[12],I=e[13],D=e[14],P=e[15];return Math.abs(n-M)<=Q.EPSILON*Math.max(1,Math.abs(n),Math.abs(M))&&Math.abs(r-m)<=Q.EPSILON*Math.max(1,Math.abs(r),Math.abs(m))&&Math.abs(i-b)<=Q.EPSILON*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(a-w)<=Q.EPSILON*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(o-E)<=Q.EPSILON*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(s-g)<=Q.EPSILON*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(u-T)<=Q.EPSILON*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(l-x)<=Q.EPSILON*Math.max(1,Math.abs(l),Math.abs(x))&&Math.abs(c-R)<=Q.EPSILON*Math.max(1,Math.abs(c),Math.abs(R))&&Math.abs(h-A)<=Q.EPSILON*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(d-N)<=Q.EPSILON*Math.max(1,Math.abs(d),Math.abs(N))&&Math.abs(f-O)<=Q.EPSILON*Math.max(1,Math.abs(f),Math.abs(O))&&Math.abs(_-L)<=Q.EPSILON*Math.max(1,Math.abs(_),Math.abs(L))&&Math.abs(y-I)<=Q.EPSILON*Math.max(1,Math.abs(y),Math.abs(I))&&Math.abs(p-D)<=Q.EPSILON*Math.max(1,Math.abs(p),Math.abs(D))&&Math.abs(v-P)<=Q.EPSILON*Math.max(1,Math.abs(v),Math.abs(P))}Object.defineProperty(e,"__esModule",{value:!0}),e.sub=e.mul=void 0,e.create=r,e.clone=i,e.copy=a,e.fromValues=o,e.set=s,e.identity=u,e.transpose=l,e.invert=c,e.adjoint=h,e.determinant=d,e.multiply=f,e.translate=_,e.scale=y,e.rotate=p,e.rotateX=v,e.rotateY=M,e.rotateZ=m,e.fromTranslation=b,e.fromScaling=w,e.fromRotation=E,e.fromXRotation=g,e.fromYRotation=T,e.fromZRotation=x,e.fromRotationTranslation=R,e.getTranslation=A,e.getScaling=N,e.getRotation=O,e.fromRotationTranslationScale=L,e.fromRotationTranslationScaleOrigin=I,e.fromQuat=D,e.frustum=P,e.perspective=j,e.perspectiveFromFieldOfView=S,e.ortho=k,e.lookAt=C,e.targetTo=z,e.str=F,e.frob=H,e.add=W,e.subtract=V,e.multiplyScalar=Y,e.multiplyScalarAndAdd=U,e.exactEquals=G,e.equals=X;var B=n(3),Q=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(B);e.mul=f,e.sub=V},function(t,e,n){function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function i(){var t=new b.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function a(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function o(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function s(t,e){var n=2*Math.acos(e[3]),r=Math.sin(n/2);return 0!=r?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n}function u(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=n[0],u=n[1],l=n[2],c=n[3];return t[0]=r*c+o*s+i*l-a*u,t[1]=i*c+o*u+a*s-r*l,t[2]=a*c+o*l+r*u-i*s,t[3]=o*c-r*s-i*u-a*l,t}function l(t,e,n){n*=.5;var r=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+o*s,t[1]=i*u+a*s,t[2]=a*u-i*s,t[3]=o*u-r*s,t}function c(t,e,n){n*=.5;var r=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u-a*s,t[1]=i*u+o*s,t[2]=a*u+r*s,t[3]=o*u-i*s,t}function h(t,e,n){n*=.5;var r=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+i*s,t[1]=i*u-r*s,t[2]=a*u+o*s,t[3]=o*u-a*s,t}function d(t,e){var n=e[0],r=e[1],i=e[2];return t[0]=n,t[1]=r,t[2]=i,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),t}function f(t,e,n,r){var i=e[0],a=e[1],o=e[2],s=e[3],u=n[0],l=n[1],c=n[2],h=n[3],d=void 0,f=void 0,_=void 0,y=void 0,p=void 0;return f=i*u+a*l+o*c+s*h,f<0&&(f=-f,u=-u,l=-l,c=-c,h=-h),1-f>1e-6?(d=Math.acos(f),_=Math.sin(d),y=Math.sin((1-r)*d)/_,p=Math.sin(r*d)/_):(y=1-r,p=r),t[0]=y*i+p*u,t[1]=y*a+p*l,t[2]=y*o+p*c,t[3]=y*s+p*h,t}function _(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n*n+r*r+i*i+a*a,s=o?1/o:0;return t[0]=-n*s,t[1]=-r*s,t[2]=-i*s,t[3]=a*s,t}function y(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function p(t,e){var n=e[0]+e[4]+e[8],r=void 0;if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var a=(i+1)%3,o=(i+2)%3;r=Math.sqrt(e[3*i+i]-e[3*a+a]-e[3*o+o]+1),t[i]=.5*r,r=.5/r,t[3]=(e[3*a+o]-e[3*o+a])*r,t[a]=(e[3*a+i]+e[3*i+a])*r,t[o]=(e[3*o+i]+e[3*i+o])*r}return t}function v(t,e,n,r){var i=.5*Math.PI/180;e*=i,n*=i,r*=i;var a=Math.sin(e),o=Math.cos(e),s=Math.sin(n),u=Math.cos(n),l=Math.sin(r),c=Math.cos(r);return t[0]=a*u*c-o*s*l,t[1]=o*s*c+a*u*l,t[2]=o*u*l-a*s*c,t[3]=o*u*c+a*s*l,t}function M(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}Object.defineProperty(e,"__esModule",{value:!0}),e.setAxes=e.sqlerp=e.rotationTo=e.equals=e.exactEquals=e.normalize=e.sqrLen=e.squaredLength=e.len=e.length=e.lerp=e.dot=e.scale=e.mul=e.add=e.set=e.copy=e.fromValues=e.clone=void 0,e.create=i,e.identity=a,e.setAxisAngle=o,e.getAxisAngle=s,e.multiply=u,e.rotateX=l,e.rotateY=c,e.rotateZ=h,e.calculateW=d,e.slerp=f,e.invert=_,e.conjugate=y,e.fromMat3=p,e.fromEuler=v,e.str=M;var m=n(3),b=r(m),w=n(33),E=r(w),g=n(16),T=r(g),x=n(34),R=r(x),A=(e.clone=R.clone,e.fromValues=R.fromValues,e.copy=R.copy,e.set=R.set,e.add=R.add,e.mul=u,e.scale=R.scale,e.dot=R.dot,e.lerp=R.lerp,e.length=R.length),N=(e.len=A,e.squaredLength=R.squaredLength),O=(e.sqrLen=N,e.normalize=R.normalize);e.exactEquals=R.exactEquals,e.equals=R.equals,e.rotationTo=function(){var t=T.create(),e=T.fromValues(1,0,0),n=T.fromValues(0,1,0);return function(r,i,a){var s=T.dot(i,a);return s<-.999999?(T.cross(t,e,i),T.len(t)<1e-6&&T.cross(t,n,i),T.normalize(t,t),o(r,t,Math.PI),r):s>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(T.cross(t,i,a),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+s,O(r,r))}}(),e.sqlerp=function(){var t=i(),e=i();return function(n,r,i,a,o,s){return f(t,r,o,s),f(e,i,a,s),f(n,t,e,2*s*(1-s)),n}}(),e.setAxes=function(){var t=E.create();return function(e,n,r,i){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],O(e,p(e,t))}}()},function(t,e,n){function r(){var t=new j.ARRAY_TYPE(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function i(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function a(t){var e=new j.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function o(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function s(t,e,n,r,i,a,o,s,u){var l=new j.ARRAY_TYPE(9);return l[0]=t,l[1]=e,l[2]=n,l[3]=r,l[4]=i,l[5]=a,l[6]=o,l[7]=s,l[8]=u,l}function u(t,e,n,r,i,a,o,s,u,l){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=a,t[5]=o,t[6]=s,t[7]=u,t[8]=l,t}function l(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function c(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function h(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=c*o-s*l,d=-c*a+s*u,f=l*a-o*u,_=n*h+r*d+i*f;return _?(_=1/_,t[0]=h*_,t[1]=(-c*r+i*l)*_,t[2]=(s*r-i*o)*_,t[3]=d*_,t[4]=(c*n-i*u)*_,t[5]=(-s*n+i*a)*_,t[6]=f*_,t[7]=(-l*n+r*u)*_,t[8]=(o*n-r*a)*_,t):null}function d(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8];return t[0]=o*c-s*l,t[1]=i*l-r*c,t[2]=r*s-i*o,t[3]=s*u-a*c,t[4]=n*c-i*u,t[5]=i*a-n*s,t[6]=a*l-o*u,t[7]=r*u-n*l,t[8]=n*o-r*a,t}function f(t){var e=t[0],n=t[1],r=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],l=t[8];return e*(l*a-o*u)+n*(-l*i+o*s)+r*(u*i-a*s)}function _(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],d=n[0],f=n[1],_=n[2],y=n[3],p=n[4],v=n[5],M=n[6],m=n[7],b=n[8];return t[0]=d*r+f*o+_*l,t[1]=d*i+f*s+_*c,t[2]=d*a+f*u+_*h,t[3]=y*r+p*o+v*l,t[4]=y*i+p*s+v*c,t[5]=y*a+p*u+v*h,t[6]=M*r+m*o+b*l,t[7]=M*i+m*s+b*c,t[8]=M*a+m*u+b*h,t}function y(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],d=n[0],f=n[1];return t[0]=r,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=d*r+f*o+l,t[7]=d*i+f*s+c,t[8]=d*a+f*u+h,t}function p(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],d=Math.sin(n),f=Math.cos(n);return t[0]=f*r+d*o,t[1]=f*i+d*s,t[2]=f*a+d*u,t[3]=f*o-d*r,t[4]=f*s-d*i,t[5]=f*u-d*a,t[6]=l,t[7]=c,t[8]=h,t}function v(t,e,n){var r=n[0],i=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function M(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function m(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function b(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function w(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function E(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n+n,s=r+r,u=i+i,l=n*o,c=r*o,h=r*s,d=i*o,f=i*s,_=i*u,y=a*o,p=a*s,v=a*u;return t[0]=1-h-_,t[3]=c-v,t[6]=d+p,t[1]=c+v,t[4]=1-l-_,t[7]=f-y,t[2]=d-p,t[5]=f+y,t[8]=1-l-h,t}function g(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],d=e[10],f=e[11],_=e[12],y=e[13],p=e[14],v=e[15],M=n*s-r*o,m=n*u-i*o,b=n*l-a*o,w=r*u-i*s,E=r*l-a*s,g=i*l-a*u,T=c*y-h*_,x=c*p-d*_,R=c*v-f*_,A=h*p-d*y,N=h*v-f*y,O=d*v-f*p,L=M*O-m*N+b*A+w*R-E*x+g*T;return L?(L=1/L,t[0]=(s*O-u*N+l*A)*L,t[1]=(u*R-o*O-l*x)*L,t[2]=(o*N-s*R+l*T)*L,t[3]=(i*N-r*O-a*A)*L,t[4]=(n*O-i*R+a*x)*L,t[5]=(r*R-n*N-a*T)*L,t[6]=(y*g-p*E+v*w)*L,t[7]=(p*b-_*g-v*m)*L,t[8]=(_*E-y*b+v*M)*L,t):null}function T(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function x(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function R(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))}function A(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t}function N(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}function O(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t}function L(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t}function I(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function D(t,e){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=e[0],d=e[1],f=e[2],_=e[3],y=e[4],p=e[5],v=e[6],M=e[7],m=e[8];return Math.abs(n-h)<=j.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(r-d)<=j.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(i-f)<=j.EPSILON*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(a-_)<=j.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(o-y)<=j.EPSILON*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(s-p)<=j.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(u-v)<=j.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(l-M)<=j.EPSILON*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(c-m)<=j.EPSILON*Math.max(1,Math.abs(c),Math.abs(m))}Object.defineProperty(e,"__esModule",{value:!0}),e.sub=e.mul=void 0,e.create=r,e.fromMat4=i,e.clone=a,e.copy=o,e.fromValues=s,e.set=u,e.identity=l,e.transpose=c,e.invert=h,e.adjoint=d,e.determinant=f,e.multiply=_,e.translate=y,e.rotate=p,e.scale=v,e.fromTranslation=M,e.fromRotation=m,e.fromScaling=b,e.fromMat2d=w,e.fromQuat=E,e.normalFromMat4=g,e.projection=T,e.str=x,e.frob=R,e.add=A,e.subtract=N,e.multiplyScalar=O,e.multiplyScalarAndAdd=L,e.exactEquals=I,e.equals=D;var P=n(3),j=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(P);e.mul=_,e.sub=N},function(t,e,n){function r(){var t=new S.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function i(t){var e=new S.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function a(t,e,n,r){var i=new S.ARRAY_TYPE(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function o(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function s(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}function u(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function l(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function c(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function h(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function d(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function f(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function _(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t}function y(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t}function p(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function v(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function M(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t}function m(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],a=e[3]-t[3];return Math.sqrt(n*n+r*r+i*i+a*a)}function b(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],a=e[3]-t[3];return n*n+r*r+i*i+a*a}function w(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.sqrt(e*e+n*n+r*r+i*i)}function E(t){var e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}function g(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function T(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function x(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n*n+r*r+i*i+a*a;return o>0&&(o=1/Math.sqrt(o),t[0]=n*o,t[1]=r*o,t[2]=i*o,t[3]=a*o),t}function R(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function A(t,e,n,r){var i=e[0],a=e[1],o=e[2],s=e[3];return t[0]=i+r*(n[0]-i),t[1]=a+r*(n[1]-a),t[2]=o+r*(n[2]-o),t[3]=s+r*(n[3]-s),t}function N(t,e){return e=e||1,t[0]=S.RANDOM(),t[1]=S.RANDOM(),t[2]=S.RANDOM(),t[3]=S.RANDOM(),x(t,t),v(t,t,e),t}function O(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*a+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*a+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*a+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*a+n[15]*o,t}function L(t,e,n){var r=e[0],i=e[1],a=e[2],o=n[0],s=n[1],u=n[2],l=n[3],c=l*r+s*a-u*i,h=l*i+u*r-o*a,d=l*a+o*i-s*r,f=-o*r-s*i-u*a;return t[0]=c*l+f*-o+h*-u-d*-s,t[1]=h*l+f*-s+d*-o-c*-u,t[2]=d*l+f*-u+c*-s-h*-o,t[3]=e[3],t}function I(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function D(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function P(t,e){var n=t[0],r=t[1],i=t[2],a=t[3],o=e[0],s=e[1],u=e[2],l=e[3];return Math.abs(n-o)<=S.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-s)<=S.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-u)<=S.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(a-l)<=S.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))}Object.defineProperty(e,"__esModule",{value:!0}),e.forEach=e.sqrLen=e.len=e.sqrDist=e.dist=e.div=e.mul=e.sub=void 0,e.create=r,e.clone=i,e.fromValues=a,e.copy=o,e.set=s,e.add=u,e.subtract=l,e.multiply=c,e.divide=h,e.ceil=d,e.floor=f,e.min=_,e.max=y,e.round=p,e.scale=v,e.scaleAndAdd=M,e.distance=m,e.squaredDistance=b,e.length=w,e.squaredLength=E,e.negate=g,e.inverse=T,e.normalize=x,e.dot=R,e.lerp=A,e.random=N,e.transformMat4=O,e.transformQuat=L,e.str=I,e.exactEquals=D,e.equals=P;var j=n(3),S=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(j);e.sub=l,e.mul=c,e.div=h,e.dist=m,e.sqrDist=b,e.len=w,e.sqrLen=E,e.forEach=function(){var t=r();return function(e,n,r,i,a,o){var s=void 0,u=void 0;for(n||(n=4),r||(r=0),u=i?Math.min(i*n+r,e.length):e.length,s=r;s<u;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}()},function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function a(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":r(e))&&"function"!=typeof e?t:e}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":r(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=n(5),h=i(c),d=n(8),f=i(d),_=n(7),y=i(_),p=n(9),v=(i(p),n(0)),M=i(v),m=n(1),b=i(m),w=n(10),E=i(w),g=n(15),T=(i(g),n(11)),x=(i(T),function(t){function e(t,n,r){o(this,e);var i=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r.displayName,r.capabilities.hasExternalDisplay,n));return i._vrDisplay=r,i._vrFrameData=new VRFrameData,i._leftView=new f.default(i._fov,i._depthNear,i._depthFar,f.default.LEFT),i._rightView=new f.default(i._fov,i._depthNear,i._depthFar,f.default.RIGHT),i._views=[i._leftView,i._rightView],i._deviceOrientation=new b.default,i._devicePosition=new E.default,i._deviceWorldMatrix=new Float32Array(16),i}return u(e,t),l(e,[{key:"_requestAnimationFrame",value:function(t){this._vrDisplay.isPresenting?this._vrDisplay.requestAnimationFrame(t):window.requestAnimationFrame(t)}},{key:"_handleNewBaseLayer",value:function(t){var e=this;this._vrDisplay.requestPresent([{source:t._context.canvas}]).then(function(){var n=e._vrDisplay.getEyeParameters("left"),r=e._vrDisplay.getEyeParameters("right");t.framebufferWidth=2*Math.max(n.renderWidth,r.renderWidth),t.framebufferHeight=Math.max(n.renderHeight,r.renderHeight),t._context.canvas.style.position="absolute",t._context.canvas.style.bottom="1px",t._context.canvas.style.right="1px",t._context.canvas.style.width="100%",t._context.canvas.style.height="100%",document.body.appendChild(t._context.canvas)}).catch(function(t){console.error("Unable to init WebVR 1.1 display",t)})}},{key:"_stop",value:function(){!1!==this.running&&(this.running=!1,this._reality._stop())}},{key:"_handleNewFrame",value:function(t){this._vrDisplay.isPresenting&&this._updateFromVRFrameData()}},{key:"_handleAfterFrame",value:function(t){this._vrDisplay.isPresenting&&this._vrDisplay.submitFrame()}},{key:"_supportedCreationParameters",value:function(t){return t.type===y.default.REALITY&&!0===t.exclusive}},{key:"_updateFromVRFrameData",value:function(){if(this._vrDisplay.getFrameData(this._vrFrameData),this._leftView.setProjectionMatrix(this._vrFrameData.leftProjectionMatrix),this._rightView.setProjectionMatrix(this._vrFrameData.rightProjectionMatrix),this._vrFrameData.pose){if(this._vrFrameData.pose.orientation){var t;(t=this._deviceOrientation).set.apply(t,a(this._vrFrameData.pose.orientation))}if(this._vrFrameData.pose.position){var e;(e=this._devicePosition).set.apply(e,a(this._vrFrameData.pose.position))}M.default.mat4_fromRotationTranslation(this._deviceWorldMatrix,this._deviceOrientation.toArray(),this._devicePosition.toArray()),this._vrDisplay.stageParameters&&this._vrDisplay.stageParameters.sittingToStandingTransform&&M.default.mat4_multiply(this._deviceWorldMatrix,this._vrDisplay.stageParameters.sittingToStandingTransform,this._deviceWorldMatrix),this._headPose._setPoseModelMatrix(this._deviceWorldMatrix),this._eyeLevelPose.position=this._devicePosition.toArray()}}}]),e}(h.default));e.default=x},function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":r(e))&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":r(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),l=n(6),c=i(l),h=n(4),d=i(h),f=n(9),_=i(f),y=n(12),p=i(y),v=n(0),M=i(v),m=n(1),b=i(m),w=n(11),E=i(w),g=n(37),T=i(g),x=function(t){function e(t){a(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,"Camera",!0,!0));return n._initialized=!1,n._running=!1,n._arKitWrapper=null,n._mediaStream=null,n._videoEl=null,n._arCoreCameraRenderer=null,n._arCoreCanvas=null,n._elContext=null,n._vrDisplay=null,n._vrFrameData=null,"function"==typeof navigator.getVRDisplays&&navigator.getVRDisplays().then(function(t){var e=!0,r=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){var s=a.value;if(null!==s&&s.capabilities.hasPassThroughCamera){if(n._vrDisplay=s,n._vrFrameData=new VRFrameData,!window.WebARonARKitSetData&&(n._arCoreCanvas=document.createElement("canvas"),n._xr._realityEls.appendChild(n._arCoreCanvas),n._arCoreCanvas.width=window.innerWidth,n._arCoreCanvas.height=window.innerHeight,n._elContext=n._arCoreCanvas.getContext("webgl"),null===n._elContext))throw"Could not create CameraReality GL context";break}}}catch(t){r=!0,i=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw i}}}),window.addEventListener("resize",function(){n._arCoreCanvas&&(n._arCoreCanvas.width=window.innerWidth,n._arCoreCanvas.height=window.innerHeight)},!1),n}return s(e,t),u(e,[{key:"_handleNewFrame",value:function(t){this._vrDisplay&&(this._arCoreCameraRenderer&&this._arCoreCameraRenderer.render(),this._vrDisplay.getFrameData(this._vrFrameData))}},{key:"_start",value:function(){var t=this;this._running||(this._running=!0,null!==this._vrDisplay?(window.WebARonARKitSetData||(this._arCoreCameraRenderer=new T.default(this._vrDisplay,this._elContext)),this._initialized=!0):E.default.HasARKit()?!1===this._initialized?(this._initialized=!0,this._arKitWrapper=E.default.GetOrCreate(),this._arKitWrapper.addEventListener(E.default.WATCH_EVENT,this._handleARKitWatch.bind(this)),this._arKitWrapper.waitForInit().then(function(){t._arKitWrapper.watch()})):this._arKitWrapper.watch():!1===this._initialized?(this._initialized=!0,navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment"}}).then(function(e){t._videoEl=document.createElement("video"),t._xr._realityEls.appendChild(t._videoEl),t._videoEl.setAttribute("class","camera-reality-video"),t._videoEl.setAttribute("playsinline",!0),t._videoEl.style.width="100%",t._videoEl.style.height="100%",t._videoEl.srcObject=e,t._videoEl.play()}).catch(function(e){console.error("Could not set up video stream",e),t._initialized=!1,t._running=!1})):(this._xr._realityEls.appendChild(this._videoEl),this._videoEl.play()))}},{key:"_stop",value:function(){if(!1!==this._running)if(this._running=!1,E.default.HasARKit()){if(null===this._arKitWrapper)return;this._arKitWrapper.stop()}else this._arCoreCanvas?(this._xr._realityEls.removeChild(this._arCoreCanvas),this._arCoreCanvas=null):null!==this._videoEl&&(this._videoEl.pause(),this._xr._realityEls.removeChild(this._videoEl))}},{key:"_handleARKitWatch",value:function(t){if(t.detail&&t.detail.objects){var e=!0,n=!1,r=void 0;try{for(var i,a=t.detail.objects[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value;this._updateAnchorFromARKitUpdate(o.uuid,o)}}catch(t){n=!0,r=t}finally{try{!e&&a.return&&a.return()}finally{if(n)throw r}}}}},{key:"_handleARKitAddObject",value:function(t){this._updateAnchorFromARKitUpdate(t.uuid,t)}},{key:"_updateAnchorFromARKitUpdate",value:function(t,e){var n=this._anchors.get(t)||null;null!==n&&(n.coordinateSystem._relativeMatrix=e.transform)}},{key:"_addAnchor",value:function(t,e){var n=this;return null!==this._arKitWrapper&&this._arKitWrapper.addAnchor(t.uid,t.coordinateSystem._poseModelMatrix).then(function(t){return n._handleARKitAddObject(t)}),this._anchors.set(t.uid,t),t.uid}},{key:"_findAnchor",value:function(t,e,n){var r=this;return new Promise(function(i,a){if(null!==r._arKitWrapper)r._arKitWrapper.hitTest(t,e,E.default.HIT_TEST_TYPE_EXISTING_PLANES).then(function(t){if(0===t.length)return void i(null);var e=r._pickARKitHit(t);e.anchor_transform[13]+=_.default.SITTING_EYE_HEIGHT,e.world_transform[13]+=_.default.SITTING_EYE_HEIGHT;var a=r._getAnchor(e.uuid);if(null===a){var o=new XRCoordinateSystem(n,XRCoordinateSystem.TRACKER);o._relativeMatrix=e.anchor_transform,a=new d.default(o,e.uuid),r._anchors.set(a.uid,a)}var s=[e.world_transform[12]-e.anchor_transform[12],e.world_transform[13]-e.anchor_transform[13],e.world_transform[14]-e.anchor_transform[14]],u=(new b.default).setFromRotationMatrix(e.world_transform),l=(new b.default).setFromRotationMatrix(e.anchor_transform).inverse(),c=(new b.default).multiplyQuaternions(u,l),h=new p.default(a.uid);h.poseMatrix=M.default.mat4_fromRotationTranslation(new Float32Array(16),c.toArray(),s),i(h)});else if(null!==r._vrDisplay){var o=r._vrDisplay.hitTest(t,e);if(0==o.length)return void i(null);o.sort(function(t,e){return t.distance-e.distance});var s=r._getAnchor(o[0].uuid);if(null===s){var u=new XRCoordinateSystem(n,XRCoordinateSystem.TRACKER);u._relativeMatrix=o[0].modelMatrix,u._relativeMatrix[13]+=_.default.SITTING_EYE_HEIGHT,s=new d.default(u),r._anchors.set(s.uid,s)}i(new p.default(s.uid))}else i(null)})}},{key:"_removeAnchor",value:function(t){this._anchors.delete(t)}},{key:"_pickARKitHit",value:function(t){if(0===t.length)return null;var e=null,n=t.filter(function(t){return t.type!=E.default.HIT_TEST_TYPE_FEATURE_POINT}),r=n.filter(function(t){return t.type==E.default.HIT_TEST_TYPE_EXISTING_PLANE_USING_EXTENT}),i=n.filter(function(t){return t.type==E.default.HIT_TEST_TYPE_EXISTING_PLANE});return r.length?(r=r.sort(function(t,e){return t.distance-e.distance}),e=r[0]):i.length?(i=i.sort(function(t,e){return t.distance-e.distance}),e=i[0]):n.length?(n=n.sort(function(t,e){return t.distance-e.distance}),e=n[0]):e=t[0],e}},{key:"_hitTestNoAnchor",value:function(t,e,n){if(null!==this._arKitWrapper){for(var r=this._arKitWrapper.hitTestNoAnchor(t,e),i=0;i<r.length;i++)r[i].modelMatrix[13]+=_.default.SITTING_EYE_HEIGHT;return 0==r.length?null:r}if(null!==this._vrDisplay){for(var a=this._vrDisplay.hitTest(t,e),o=0;o<a.length;o++)a[o].modelMatrix[13]+=_.default.SITTING_EYE_HEIGHT;return 0==a.length?null:a}return null}}]),e}(c.default);e.default=x},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e,n){if("fragment"==n)var r=t.createShader(t.FRAGMENT_SHADER);else{if("vertex"!=n)return null;var r=t.createShader(t.VERTEX_SHADER)}return t.shaderSource(r,e),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(console.error(t.getShaderInfoLog(r)),null)}function a(t,e,n){var r=i(t,e,"vertex"),a=i(t,n,"fragment");if(!a)return null;var o=t.createProgram();return t.attachShader(o,r),t.attachShader(o,a),t.linkProgram(o),t.getProgramParameter(o,t.LINK_STATUS)||console.error("Could not initialise arview shaders"),o}function o(t,e){var n=0;switch(e){case 90:n=1;break;case 180:n=2;break;case 270:n=3;break;default:n=0}var r=0;switch(t){case 90:r=1;break;case 180:r=2;break;case 270:r=3;break;default:r=0}var i=r-n;return i<0&&(i+=4),i%4}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u="#extension GL_OES_EGL_image_external : require\n\nprecision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform samplerExternalOES uSampler;\n\nvoid main(void) {\n  gl_FragColor = texture2D(uSampler, vTextureCoord);\n}",l="attribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void) {\n  gl_Position = vec4(aVertexPosition, 1.0);\n  vTextureCoord = aTextureCoord;\n}",c=function(){function t(e,n){r(this,t),this.vrDisplay=e,this.gl=n,this.passThroughCamera=e.getPassThroughCamera(),this.program=a(n,l,u),n.useProgram(this.program),this.vertexPositionAttribute=n.getAttribLocation(this.program,"aVertexPosition"),this.textureCoordAttribute=n.getAttribLocation(this.program,"aTextureCoord"),this.samplerUniform=n.getUniformLocation(this.program,"uSampler"),this.vertexPositionBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.vertexPositionBuffer);var i=[-1,1,0,-1,-1,0,1,1,0,1,-1,0],s=new Float32Array(i);n.bufferData(n.ARRAY_BUFFER,s,n.STATIC_DRAW),this.vertexPositionBuffer.itemSize=3,this.vertexPositionBuffer.numItems=12,this.textureCoordBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.textureCoordBuffer);var c=null;if(this.vrDisplay){var h=this.passThroughCamera.width/this.passThroughCamera.textureWidth,d=this.passThroughCamera.height/this.passThroughCamera.textureHeight;c=[[0,0,0,d,h,0,h,d],[h,0,0,0,h,d,0,d],[h,d,h,0,0,d,0,0],[0,d,h,d,0,0,h,0]]}else c=[[0,0,0,1,1,0,1,1],[1,0,0,0,1,1,0,1],[1,1,1,0,0,1,0,0],[0,1,1,1,0,0,1,0]];this.f32TextureCoords=[];for(var f=0;f<c.length;f++)this.f32TextureCoords.push(new Float32Array(c[f]));this.combinedOrientation=o(screen.orientation.angle,this.passThroughCamera.orientation),n.bufferData(n.ARRAY_BUFFER,this.f32TextureCoords[this.combinedOrientation],n.STATIC_DRAW),this.textureCoordBuffer.itemSize=2,this.textureCoordBuffer.numItems=8,n.bindBuffer(n.ARRAY_BUFFER,null),this.indexBuffer=n.createBuffer(),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var _=[0,1,2,2,1,3],y=new Uint16Array(_);return n.bufferData(n.ELEMENT_ARRAY_BUFFER,y,n.STATIC_DRAW),this.indexBuffer.itemSize=1,this.indexBuffer.numItems=6,n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),this.texture=n.createTexture(),n.useProgram(null),this.projectionMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.mvMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this}return s(t,[{key:"render",value:function(){var t=this.gl;t.useProgram(this.program),t.bindBuffer(t.ARRAY_BUFFER,this.vertexPositionBuffer),t.enableVertexAttribArray(this.vertexPositionAttribute),t.vertexAttribPointer(this.vertexPositionAttribute,this.vertexPositionBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this.textureCoordBuffer);var e=o(screen.orientation.angle,this.passThroughCamera.orientation);e!==this.combinedOrientation&&(this.combinedOrientation=e,t.bufferData(t.ARRAY_BUFFER,this.f32TextureCoords[this.combinedOrientation],t.STATIC_DRAW)),t.enableVertexAttribArray(this.textureCoordAttribute),t.vertexAttribPointer(this.textureCoordAttribute,this.textureCoordBuffer.itemSize,t.FLOAT,!1,0,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_EXTERNAL_OES,this.texture),t.texImage2D(t.TEXTURE_EXTERNAL_OES,0,t.RGB,t.RGB,t.UNSIGNED_BYTE,this.passThroughCamera),t.uniform1i(this.samplerUniform,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.drawElements(t.TRIANGLES,this.indexBuffer.numItems,t.UNSIGNED_SHORT,0),t.bindTexture(t.TEXTURE_EXTERNAL_OES,null),t.disableVertexAttribArray(this.vertexPositionAttribute),t.disableVertexAttribArray(this.textureCoordAttribute),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.useProgram(null)}}]),t}(),h=function(){function t(e,n){r(this,t),this.vrDisplay=e,this.gl=n,this.videoRenderer=new c(e,this.gl),this.width=window.innerWidth,this.height=window.innerHeight,window.addEventListener("resize",this.onWindowResize.bind(this),!1)}return s(t,[{key:"onWindowResize",value:function(){this.width=window.innerWidth,this.height=window.innerHeight}},{key:"render",value:function(){var t=this.gl,e=1*this.width,n=1*this.height;t.viewportWidth!==e&&(t.viewportWidth=e),t.viewportHeight!==n&&(t.viewportHeight=n),this.gl.viewport(0,0,t.viewportWidth,t.viewportHeight),this.videoRenderer.render()}}]),t}();e.default=h}])}])},function(t,e,n){"use strict";AFRAME.registerSystem("xr",{schema:{AR_AUTOSTART:{default:!0}},init:function(){this.sceneEl.setAttribute("vr-mode-ui",{enabled:!1}),this.bindMethods(),this.sceneEl.addEventListener("loaded",this.wrapSceneMethods)},bindMethods:function(){this.updateFrame=this.updateFrame.bind(this),this.sessionStarted=this.sessionStarted.bind(this),this.sessionEnded=this.sessionEnded.bind(this),this.poseLost=this.poseLost.bind(this),this.poseFound=this.poseFound.bind(this),this.wrapSceneMethods=this.wrapSceneMethods.bind(this)},wrapSceneMethods:function(){var t=this.sceneEl;t._enterVR=t.enterVR,t._exitVR=t.exitVR,t._resize=t.resize,t._render=t.render;var e=this;t.enterAR=function(){this.renderer.xr.startSession(e.lastARDisplay,"ar")},t.exitAR=function(){this.renderer.xr.endSession()},t.enterVR=function(n){!this.renderer.xr.sessionActive&&e.lastVRDisplay?this.renderer.xr.startSession(e.lastVRDisplay,"vr"):t._enterVR(n)},t.exitVR=function(){this.renderer.xr.sessionActive?this.renderer.xr.endSession():t._exitVR()},t.resize=function(){if(this.renderer.xr&&!this.renderer.xr.sessionActive){var t=this.camera,e={width:window.innerWidth,height:window.innerHeight};t.aspect=e.width/e.height,t.updateProjectionMatrix()}},t.render=function(){var t=1e3*this.clock.getDelta(),e=this.renderer;this.time=1e3*this.clock.elapsedTime,this.isPlaying&&this.tick(this.time,t),e.animate(this.render.bind(this)),this.renderer.xr&&(!this.renderer.xr.session||this.renderer.xr.session&&!this.renderer.xr.sessionActive)&&(e.setSize(window.innerWidth,window.innerHeight),e.render(this.object3D,this.camera,this.renderTarget)),this.isPlaying&&this.tock(this.time,t)},this.posePosition=new THREE.Vector3,this.poseQuaternion=new THREE.Quaternion,this.poseEuler=new THREE.Euler(0,0,0,"YXZ"),this.poseRotation=new THREE.Vector3,this.poseIsLost=!0,this.activeRealityType="magicWindow",this.el.camera?this.cameraActivated():this.el.addEventListener("camera-set-active",function(t){e.cameraActivated()})},cameraActivated:function(){this.defaultPosition=new THREE.Vector3(0,1.6,.1),this.el.camera.el.setAttribute("position",this.defaultPosition);var t=this;this.el.emit("realityChanged","magicWindow"),THREE.WebXRUtils.getDisplays().then(t.initXR.bind(t))},initXR:function(t){var e=this.sceneEl;e.renderer.autoClear=!1,this.supportAR=!1;for(var n=0;n<t.length;n++){t[n].supportedRealities.ar&&(this.supportAR=!0)}this.el.emit("xrInitialized"),document.documentElement.style.backgroundColor="transparent",document.body.style.backgroundColor="transparent";var r={AR_AUTOSTART:this.data.AR_AUTOSTART};e.renderer.xr=new THREE.WebXRManager(r,t,e.renderer,e.camera,e.object3D,this.updateFrame),e.renderer.xr.addEventListener("sessionStarted",this.sessionStarted),e.renderer.xr.addEventListener("sessionEnded",this.sessionEnded),e.renderer.xr.addEventListener("poseLost",this.poseLost),e.renderer.xr.addEventListener("poseFound",this.poseFound),0===e.renderer.xr.totalSupportedDisplays?this.sceneEl.setAttribute("vr-mode-ui",{enabled:!0}):e.renderer.xr.autoStarted||this.addEnterButtons(t)},addEnterButtons:function(t){for(var e=0;e<t.length;e++){var n=t[e];n.supportedRealities.vr&&(this.lastVRDisplay=n,this.sceneEl.setAttribute("vr-mode-ui",{enabled:!0})),n.supportedRealities.ar&&(this.lastARDisplay=n,this.sceneEl.setAttribute("ar-mode-ui",{enabled:!0}))}},sessionStarted:function(t){this.activeRealityType=t.session.realityType,this.el.emit("realityChanged",this.activeRealityType)},sessionEnded:function(t){this.activeRealityType="magicWindow",this.el.emit("realityChanged",this.activeRealityType)},poseLost:function(){this.el.emit("poseLost")},poseFound:function(){this.el.emit("poseFound")},updateFrame:function(t){this.el.emit("updateFrame",t)}})},function(t,e,n){"use strict";function r(t){var e;return e=document.createElement("button"),e.className=a,e.setAttribute("title","Enter AR mode."),e.setAttribute("aframe-injected",""),e.addEventListener("click",function(e){document.getElementsByClassName(a)[0].style.display="none",document.getElementsByClassName(o)[0].style.display="inline-block",t()}),e}function i(t){var e;return e=document.createElement("button"),e.className=o,e.setAttribute("title","Exit AR mode."),e.setAttribute("aframe-injected",""),e.addEventListener("click",function(e){document.getElementsByClassName(a)[0].style.display="inline-block",document.getElementsByClassName(o)[0].style.display="none",t()}),e}var a="a-enter-ar-button",o="a-exit-ar-button";AFRAME.registerComponent("ar-mode-ui",{dependencies:["canvas"],schema:{enabled:{default:!0}},init:function(){var t=this,e=this.el;if("false"!==AFRAME.utils.getUrlParameter("ui")){var n=document.createElement("style");n.innerHTML=".a-enter-vr {text-align: center;right: 10px;}",n.innerHTML+=".a-enter-vr-button {background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkNhcGFfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHdpZHRoPSIyMDQ4cHgiIGhlaWdodD0iMjA0OHB4IiB2aWV3Qm94PSIwIDAgMjA0OCAyMDQ4IiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAyMDQ4IDIwNDgiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPHRpdGxlPm1hc2s8L3RpdGxlPg0KPGc+DQoJPHJlY3QgeD0iMTQ0LjIzMiIgeT0iNTg3LjI3NiIgZmlsbD0ibm9uZSIgd2lkdGg9IjE4NjYuMTg3IiBoZWlnaHQ9IjEzNDEuMTM0Ii8+DQoJPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTc4MS42NjksNTg2LjU4OWgxOTguNzk3bC0zMTQuMTI1LDkyMUg0ODUuNzAxbC0zMTEuODEyLTkyMWgyMDUuNjU2bDIwMC4xODgsNjk5LjE4OEw3ODEuNjY5LDU4Ni41ODl6Ii8+DQoJPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTE2ODYuMjc5LDYxMC4zMjRjMzMuOTM4LDE0LjU3OCw2Mi43MDMsMzYuMDMxLDg2LjI4MSw2NC4zNDRjMTkuNTE2LDIzLjMyOCwzNC45NjksNDkuMTU2LDQ2LjM0NCw3Ny40NjkNCgkJczE3LjA3OCw2MC41OTQsMTcuMDc4LDk2LjgxMmMwLDQzLjcxOS0xMS4wNDcsODYuNzE5LTMzLjE0MSwxMjguOTg0Yy0yMi4wOTQsNDIuMjgxLTU4LjU0Nyw3Mi4xNTctMTA5LjM5MSw4OS42NDENCgkJYzQyLjM3NSwxNy4xMjUsNzIuMzkxLDQxLjQzOCw5MC4wNDcsNzIuOTUzYzE3LjY1NiwzMS41MzEsMjYuNDg0LDc5LjU2MiwyNi40ODQsMTQ0LjA5NHY2MS44MjgNCgkJYzAsNDIuMDYyLDEuNzAzLDcwLjU3OCw1LjEyNSw4NS41NjJjNS4xMjUsMjMuNzUsMTcuMDc4LDQxLjIzNCwzNS44NzUsNTIuNDY5djIzLjEwOWgtMjEyLjMyOA0KCQljLTUuNzgxLTIwLjQwNi05LjkwNi0zNi44NDQtMTIuMzc1LTQ5LjM0NGMtNC45NjktMjUuODEyLTcuNjU2LTUyLjI1LTguMDYyLTc5LjMxMmwtMS4yMzQtODUuNTc4DQoJCWMtMC43OTctNTguNzAzLTEwLjk2OS05Ny44NDQtMzAuNTMxLTExNy40MDZzLTU2LjIxOS0yOS4zNTktMTA5Ljk1My0yOS4zNTloLTE4OC41MTZ2MzYxaC0xODh2LTkyMWg0NDAuODc1DQoJCUMxNjAzLjg1Nyw1ODcuODM5LDE2NTIuMzQyLDU5NS43NjEsMTY4Ni4yNzksNjEwLjMyNHogTTEyODcuOTgyLDc0NS41ODl2MjQ4aDIwNy41MzFjNDEuMjE5LDAsNzIuMTQxLTUsOTIuNzY2LTE1LjAzMQ0KCQljMzYuNDY5LTE3LjUzMSw1NC43MDMtNTIuMTcyLDU0LjcwMy0xMDMuOTUzYzAtNTUuOTM4LTE3LjY0MS05My41MTYtNTIuOTIyLTExMi43MzRjLTE5LjgyOC0xMC44NDQtNDkuNTYyLTE2LjI4MS04OS4yMDMtMTYuMjgxDQoJCUgxMjg3Ljk4MnoiLz4NCjwvZz4NCjwvc3ZnPg0K) 50% 50%/70% 70% no-repeat rgba(0,0,0,.35);",n.innerHTML+="position: relative;",n.innerHTML+="margin-right: 10px;",n.innerHTML+="}",n.innerHTML+=".a-enter-ar-button {background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkNhcGFfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHdpZHRoPSIyMDQ4cHgiIGhlaWdodD0iMjA0OHB4IiB2aWV3Qm94PSIwIDAgMjA0OCAyMDQ4IiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAyMDQ4IDIwNDgiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPHRpdGxlPm1hc2s8L3RpdGxlPg0KPGc+DQoJPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTQzOS45NzIsNTg0LjgzNWgyMTcuNjI1bDMyNS4zNDUsOTIxaC0yMDguNzJsLTYwLjU3Ny0xODloLTMzOS4yNWwtNjIuNDIzLDE4OWgtMjAxLjExTDQzOS45NzIsNTg0LjgzNXoNCgkJIE00MjYuODc4LDExNTcuODM1aDIzNS44MTJMNTQ2LjU1LDc5NS4zOTZMNDI2Ljg3OCwxMTU3LjgzNXoiLz4NCgk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMTY5MC43MjMsNjA4LjU2OWMzMy45MzgsMTQuNTc3LDYyLjcwMiwzNi4wMyw4Ni4yOCw2NC4zNDRjMTkuNTE3LDIzLjMyOCwzNC45Nyw0OS4xNTYsNDYuMzQ1LDc3LjQ2OQ0KCQljMTEuMzc1LDI4LjMxMywxNy4wNzcsNjAuNTk0LDE3LjA3Nyw5Ni44MTJjMCw0My43MTktMTEuMDQ3LDg2LjcxOS0zMy4xNDEsMTI4Ljk4M2MtMjIuMDk1LDQyLjI4MS01OC41NDcsNzIuMTU2LTEwOS4zOTIsODkuNjQyDQoJCWM0Mi4zNzUsMTcuMTI1LDcyLjM5Miw0MS40MzgsOTAuMDQ3LDcyLjk1MmMxNy42NTYsMzEuNTMxLDI2LjQ4NCw3OS41NjIsMjYuNDg0LDE0NC4wOTV2NjEuODI4DQoJCWMwLDQyLjA2MiwxLjcwMyw3MC41NzcsNS4xMjUsODUuNTYyYzUuMTI1LDIzLjc1LDE3LjA3OCw0MS4yMzQsMzUuODc1LDUyLjQ2OXYyMy4xMDloLTIxMi4zMjgNCgkJYy01Ljc4MS0yMC40MDYtOS45MDYtMzYuODQ0LTEyLjM3NS00OS4zNDRjLTQuOTY5LTI1LjgxMi03LjY1Ni01Mi4yNS04LjA2Mi03OS4zMTJsLTEuMjM0LTg1LjU3OA0KCQljLTAuNzk3LTU4LjcwMy0xMC45NjktOTcuODQ0LTMwLjUzLTExNy40MDVjLTE5LjU2Mi0xOS41NjItNTYuMjItMjkuMzU5LTEwOS45NTMtMjkuMzU5aC0xODguNTE3djM2MWgtMTg4di05MjFIMTU0NS4zDQoJCUMxNjA4LjMsNTg2LjA4NSwxNjU2Ljc4NCw1OTQuMDA3LDE2OTAuNzIzLDYwOC41Njl6IE0xMjkyLjQyNSw3NDMuODM1djI0OGgyMDcuNTMxYzQxLjIxOSwwLDcyLjE0Mi01LDkyLjc2Ny0xNS4wMzENCgkJYzM2LjQ2OS0xNy41Myw1NC43MDItNTIuMTcyLDU0LjcwMi0xMDMuOTUzYzAtNTUuOTM4LTE3LjY0MS05My41MTYtNTIuOTIyLTExMi43MzNjLTE5LjgyOC0xMC44NDQtNDkuNTYyLTE2LjI4MS04OS4yMDMtMTYuMjgxDQoJCUwxMjkyLjQyNSw3NDMuODM1TDEyOTIuNDI1LDc0My44MzV6Ii8+DQo8L2c+DQo8L3N2Zz4NCg==) 50% 50%/70% 70% no-repeat rgba(0,0,0,.35);",n.innerHTML+="border: 0;",n.innerHTML+="bottom: 0;",n.innerHTML+="cursor: pointer;",n.innerHTML+="min-width: 50px;",n.innerHTML+="min-height: 30px;",n.innerHTML+="padding-right: 5%;",n.innerHTML+="padding-top: 4%;",n.innerHTML+="transition: background-color .05s ease;",n.innerHTML+="-webkit-transition: background-color .05s ease;",n.innerHTML+="z-index: 9999;",n.innerHTML+="margin-right: 10px;}",n.innerHTML+=".a-enter-ar-button:active,.a-enter-ar-button:hover { background-color: #666;",n.innerHTML+="}",n.innerHTML+=".a-exit-ar-button {background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkNhcGFfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHdpZHRoPSIyMDQ4cHgiIGhlaWdodD0iMjA0OHB4IiB2aWV3Qm94PSIwIDAgMjA0OCAyMDQ4IiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAyMDQ4IDIwNDgiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPHRpdGxlPm1hc2s8L3RpdGxlPg0KPHJlY3QgeD0iNTYxLjI3MyIgeT0iNTg0LjgzNiIgZmlsbD0ibm9uZSIgd2lkdGg9IjEzODMuMTM5IiBoZWlnaHQ9IjEzODMuMTM5Ii8+DQo8ZyBlbmFibGUtYmFja2dyb3VuZD0ibmV3ICAgICI+DQoJPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTgwNi41MDgsMTUwNS4xNDhINTgyLjc3NGwyOTYuMDE2LTQ2OS4yNWwtMjgyLjAxNi00NTEuNzVoMjMwLjA0N2wxNjQuNDM4LDMwMC4wMTZsMTY4Ljk2OC0zMDAuMDE2DQoJCWgyMjIuNTQ3bC0yODIuMDE2LDQ0NC4yNWwzMDAuMDE2LDQ3Ni43NWgtMjMzLjg5MWwtMTc1LjUzMS0zMTQuMTU2TDgwNi41MDgsMTUwNS4xNDh6Ii8+DQo8L2c+DQo8L3N2Zz4NCg==) 50% 50%/70% 70% no-repeat rgba(0,0,0,.35);",n.innerHTML+="border: 0;",n.innerHTML+="bottom: 0;",n.innerHTML+="cursor: pointer;",n.innerHTML+="min-width: 30px;",n.innerHTML+="min-height: 30px;",n.innerHTML+="padding-right: 5%;",n.innerHTML+="padding-top: 4%;",n.innerHTML+="transition: background-color .05s ease;",n.innerHTML+="-webkit-transition: background-color .05s ease;",n.innerHTML+="z-index: 9999;",n.innerHTML+="display: none;",n.innerHTML+="margin-right: 10px;}",n.innerHTML+=".a-exit-ar-button:active,.a-exit-ar-button:hover { background-color: #666;",n.innerHTML+="}",document.body.appendChild(n),this.enterAR=e.enterAR.bind(e),this.exitAR=e.exitAR.bind(e),this.insideLoader=!1,this.enterAREl=null,e.addEventListener("enter-vr",this.updateEnterARInterface.bind(this)),e.addEventListener("exit-vr",this.updateEnterARInterface.bind(this)),window.addEventListener("message",function(e){"loaderReady"===e.data.type&&(t.insideLoader=!0,t.remove())})}},update:function(){var t=this.el;if(!this.data.enabled||this.insideLoader||"false"===AFRAME.utils.getUrlParameter("ui"))return this.remove();if(!this.enterAREl){if(this.enterAREl=r(this.enterAR),this.exitAREl=i(this.exitAR),!document.getElementsByClassName("a-enter-vr")[0]){var e=document.createElement("div");e.classList.add("a-enter-vr"),e.setAttribute("aframe-injected",""),t.appendChild(e)}document.getElementsByClassName("a-enter-vr")[0].appendChild(this.enterAREl),document.getElementsByClassName("a-enter-vr")[0].appendChild(this.exitAREl),this.updateEnterARInterface()}},remove:function(){[this.enterAREl].forEach(function(t){t&&t.parentNode.removeChild(t)})},updateEnterARInterface:function(){this.toggleEnterARButtonIfNeeded()},toggleEnterARButtonIfNeeded:function(){var t=this.el;this.enterAREl&&(t.is("vr-mode")?(this.enterAREl.classList.add("a-hidden"),this.exitAREl.classList.add("a-hidden")):(this.enterAREl.classList.remove("a-hidden"),this.exitAREl.classList.remove("a-hidden")))}})},function(t,e,n){"use strict";AFRAME.registerComponent("xr",{schema:{vr:{default:!0},ar:{default:!0},magicWindow:{default:!0}},init:function(){this.realityChanged=this.realityChanged.bind(this),this.el.sceneEl.addEventListener("realityChanged",this.realityChanged),this.originalVisibility=this.el.getAttribute("visible")},update:function(){this.originalVisibility=this.el.getAttribute("visible"),this.el.setAttribute("visible",this.newVisibility)},realityChanged:function(t){void 0!==this.data[t.detail]&&(this.data[t.detail]?this.newVisibility=this.originalVisibility:this.newVisibility=!1,this.el.setAttribute("visible",this.newVisibility))}})},function(t,e,n){"use strict";AFRAME.registerComponent("xranchor",{init:function(){this.anchorMatrix=new THREE.Matrix4,this.positionVec3=new THREE.Vector3,this.rotationQuat=new THREE.Quaternion,this.rotationVec3=new THREE.Vector3,this.el.sceneEl.addEventListener("updateFrame",this.updateFrame.bind(this))},updateFrame:function(t){var e=t.detail,n=this.anchorOffset;if(n){var r=e.getAnchor(n.anchorUID);if(null!==r){var i=this.anchorMatrix.fromArray(n.getOffsetTransform(r.coordinateSystem)),a=this.positionVec3.setFromMatrixPosition(i);this.el.setAttribute("position",{x:a.x,y:a.y,z:a.z});var o=this.rotationQuat.setFromRotationMatrix(i),s=this.rotationVec3.applyQuaternion(o);this.el.setAttribute("rotation",{x:s.x,y:s.y,z:s.z})}}}})},function(t,e,n){"use strict";AFRAME.registerComponent("reticle",{init:function(){this.el.sceneEl.addEventListener("updateFrame",this.updateFrame.bind(this)),this.el.setAttribute("rotation",{x:-90})},updateFrame:function(t){var e=t.detail,n=e.hitTestNoAnchor(.5,.5),r=new THREE.Matrix4,i=new THREE.Vector3,a=new THREE.Quaternion,o=new THREE.Vector3;n&&n.length>0&&(r.fromArray(n[0].modelMatrix),r.decompose(i,a,o),this.el.setAttribute("position",{x:i.x,y:i.y,z:i.z}))}})}]);